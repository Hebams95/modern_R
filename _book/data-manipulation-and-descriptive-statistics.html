<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2018-11-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="reading-and-writing-data.html">
<link rel="next" href="graphs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Learn modern R with the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is RStudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-book"><i class="fa fa-check"></i>What to expect from this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins</a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>2</b> Packages</a></li>
<li class="chapter" data-level="3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html"><i class="fa fa-check"></i><b>3</b> Data types and objects</a><ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-numeric-class"><i class="fa fa-check"></i><b>3.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-character-class"><i class="fa fa-check"></i><b>3.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-factor-class"><i class="fa fa-check"></i><b>3.3</b> The <code>factor</code> class</a></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#vectors-and-matrices"><i class="fa fa-check"></i><b>3.4</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-c-function"><i class="fa fa-check"></i><b>3.4.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#cbind-and-rbind"><i class="fa fa-check"></i><b>3.4.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-matrix-class"><i class="fa fa-check"></i><b>3.4.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-logical-class"><i class="fa fa-check"></i><b>3.5</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="3.6" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-list-class"><i class="fa fa-check"></i><b>3.6</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="3.7" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>3.7</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="3.8" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#formulas"><i class="fa fa-check"></i><b>3.8</b> Formulas</a></li>
<li class="chapter" data-level="3.9" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercises-1"><i class="fa fa-check"></i><b>3.9</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="data-types-and-objects.html"><a href="data-types-and-objects.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>4</b> Reading and writing data</a><ul>
<li class="chapter" data-level="4.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>4.1</b> The swiss army knife of data import and export: <code>rio</code></a></li>
<li class="chapter" data-level="4.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>4.2</b> Writing any object to disk</a></li>
<li class="chapter" data-level="4.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>4.3</b> Using RStudio projects to manage paths</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html"><i class="fa fa-check"></i><b>5</b> Data manipulation and descriptive statistics</a><ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>5.1</b> Smoking is bad for you, but pipes are your friend</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>5.2</b> The <code>{tidyverse}</code>’s <em>enfant prodige</em>: <code>{dplyr}</code></a><ul>
<li class="chapter" data-level="5.2.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>5.2.1</b> A first taste of data manipulation with <code>{dplyr}</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>5.2.2</b> Filter the rows of a dataset with <code>filter()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#select-columns-with-select"><i class="fa fa-check"></i><b>5.2.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>5.2.4</b> Group the observations of your dataset with <code>group_by()</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>5.2.5</b> Get summary statistics with <code>summarise()</code></a></li>
<li class="chapter" data-level="5.2.6" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>5.2.6</b> Adding columns with <code>mutate()</code> and <code>transmute()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>5.3</b> Reshaping data with <code>tidyr</code></a></li>
<li class="chapter" data-level="5.4" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-factor-variables"><i class="fa fa-check"></i><b>5.4</b> Getting to know <code>factor</code> variables</a></li>
<li class="chapter" data-level="5.5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#scoped-tidyverse-verbs"><i class="fa fa-check"></i><b>5.5</b> Scoped <code>{tidyverse}</code> verbs</a><ul>
<li class="chapter" data-level="5.5.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#filter_"><i class="fa fa-check"></i><b>5.5.1</b> filter_()</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#select_"><i class="fa fa-check"></i><b>5.5.2</b> select_()</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#group_by_"><i class="fa fa-check"></i><b>5.5.3</b> group_by_()</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#summarise_"><i class="fa fa-check"></i><b>5.5.4</b> summarise_()</a></li>
<li class="chapter" data-level="5.5.5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#mutate_"><i class="fa fa-check"></i><b>5.5.5</b> mutate_()</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>5.6</b> Other useful <code>{tidyverse}</code> functions</a><ul>
<li class="chapter" data-level="5.6.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>5.6.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></a></li>
<li class="chapter" data-level="5.6.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#lead-and-lag"><i class="fa fa-check"></i><b>5.6.2</b> <code>lead()</code> and <code>lag()</code></a></li>
<li class="chapter" data-level="5.6.3" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#ntile"><i class="fa fa-check"></i><b>5.6.3</b> <code>ntile()</code></a></li>
<li class="chapter" data-level="5.6.4" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#arrange"><i class="fa fa-check"></i><b>5.6.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="5.6.5" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#tally-and-count"><i class="fa fa-check"></i><b>5.6.5</b> <code>tally()</code> and <code>count()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>5.7</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</a></li>
<li class="chapter" data-level="5.8" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#working-with-a-list-of-datasets"><i class="fa fa-check"></i><b>5.8</b> Working with a list of datasets</a><ul>
<li class="chapter" data-level="5.8.1" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-map"><i class="fa fa-check"></i><b>5.8.1</b> Getting to know <code>map()</code></a></li>
<li class="chapter" data-level="5.8.2" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#getting-to-know-reduce"><i class="fa fa-check"></i><b>5.8.2</b> Getting to know <code>reduce()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#list-columns"><i class="fa fa-check"></i><b>5.9</b> List-columns</a></li>
<li class="chapter" data-level="5.10" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#exercises-2"><i class="fa fa-check"></i><b>5.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="data-manipulation-and-descriptive-statistics.html"><a href="data-manipulation-and-descriptive-statistics.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a><ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>6.1</b> Resources</a></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a><ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>6.2.1</b> Barplots</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>6.2.2</b> Density</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>6.2.3</b> Line plots</a></li>
<li class="chapter" data-level="6.2.4" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>6.2.4</b> Facets</a></li>
<li class="chapter" data-level="6.2.5" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>6.2.5</b> Pie Charts</a></li>
<li class="chapter" data-level="6.2.6" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>6.2.6</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>6.3</b> Customization</a><ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#titles-axes-names-and-more"><i class="fa fa-check"></i><b>6.3.1</b> Titles, axes names and more</a></li>
<li class="chapter" data-level="6.3.2" data-path="graphs.html"><a href="graphs.html#themes"><i class="fa fa-check"></i><b>6.3.2</b> Themes</a></li>
<li class="chapter" data-level="6.3.3" data-path="graphs.html"><a href="graphs.html#colour-schemes-from-ggthemes"><i class="fa fa-check"></i><b>6.3.3</b> Colour schemes from <code>ggthemes</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="graphs.html"><a href="graphs.html#using-your-own-colours"><i class="fa fa-check"></i><b>6.3.4</b> Using your own colours</a></li>
<li class="chapter" data-level="6.3.5" data-path="graphs.html"><a href="graphs.html#saving-plots-on-disk"><i class="fa fa-check"></i><b>6.3.5</b> Saving plots on disk</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#many-plots"><i class="fa fa-check"></i><b>6.4</b> Many plots</a></li>
<li class="chapter" data-level="6.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>6.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="graphs.html"><a href="graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>7</b> Statistical models</a><ul>
<li class="chapter" data-level="7.1" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>7.1</b> Fitting a model to data</a></li>
<li class="chapter" data-level="7.2" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>7.2</b> Diagnostics</a></li>
<li class="chapter" data-level="7.3" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>7.3</b> Interpreting models</a></li>
<li class="chapter" data-level="7.4" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>7.4</b> Comparing models</a></li>
<li class="chapter" data-level="7.5" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>7.5</b> Using a model for prediction</a></li>
<li class="chapter" data-level="7.6" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>7.6</b> Beyond linear regression</a></li>
<li class="chapter" data-level="7.7" data-path="statistical-models.html"><a href="statistical-models.html#advanced-topics"><i class="fa fa-check"></i><b>7.7</b> Advanced topics</a><ul>
<li class="chapter" data-level="7.7.1" data-path="statistical-models.html"><a href="statistical-models.html#bootstrapping"><i class="fa fa-check"></i><b>7.7.1</b> Bootstrapping</a></li>
<li class="chapter" data-level="7.7.2" data-path="statistical-models.html"><a href="statistical-models.html#cross-validation"><i class="fa fa-check"></i><b>7.7.2</b> Cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html"><i class="fa fa-check"></i><b>8</b> Functional programming and other advanced topics</a><ul>
<li class="chapter" data-level="8.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#control-flow"><i class="fa fa-check"></i><b>8.1</b> Control flow</a><ul>
<li class="chapter" data-level="8.1.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#if-else"><i class="fa fa-check"></i><b>8.1.1</b> If-else</a></li>
<li class="chapter" data-level="8.1.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#for-loops"><i class="fa fa-check"></i><b>8.1.2</b> For loops</a></li>
<li class="chapter" data-level="8.1.3" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#while-loops"><i class="fa fa-check"></i><b>8.1.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#programming-your-own-functions"><i class="fa fa-check"></i><b>8.2</b> Programming your own functions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>8.2.1</b> Declaring functions in R</a></li>
<li class="chapter" data-level="8.2.2" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#fibonacci-numbers"><i class="fa fa-check"></i><b>8.2.2</b> Fibonacci numbers</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercises-4"><i class="fa fa-check"></i><b>8.3</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-take-functions-as-arguments"><i class="fa fa-check"></i><b>8.4</b> Functions that take functions as arguments</a></li>
<li class="chapter" data-level="8.5" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>8.5</b> Functions that take columns of data as arguments</a></li>
<li class="chapter" data-level="8.6" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#functions-that-use-loops"><i class="fa fa-check"></i><b>8.6</b> Functions that use loops</a></li>
<li class="chapter" data-level="8.7" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#anonymous-functions"><i class="fa fa-check"></i><b>8.7</b> Anonymous functions</a></li>
<li class="chapter" data-level="8.8" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#using-your-functions-inside-mutate"><i class="fa fa-check"></i><b>8.8</b> Using your functions inside <code>mutate()</code></a></li>
<li class="chapter" data-level="8.9" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#mapping-your-homebrewed-functions-to-lists-of-datasets"><i class="fa fa-check"></i><b>8.9</b> Mapping your homebrewed functions to lists of datasets</a></li>
<li class="chapter" data-level="8.10" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>8.10</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="8.11" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>8.11</b> Scraping the internet</a></li>
<li class="chapter" data-level="8.12" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#writing-your-own-package"><i class="fa fa-check"></i><b>8.12</b> Writing your own package</a></li>
<li class="chapter" data-level="8.13" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#random-tips-and-tricks"><i class="fa fa-check"></i><b>8.13</b> Random tips and tricks</a><ul>
<li class="chapter" data-level="8.13.1" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#creating-a-log-file"><i class="fa fa-check"></i><b>8.13.1</b> Creating a log file</a></li>
</ul></li>
<li class="chapter" data-level="8.14" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercises-5"><i class="fa fa-check"></i><b>8.14</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="functional-programming-and-other-advanced-topics.html"><a href="functional-programming-and-other-advanced-topics.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-and-descriptive-statistics" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Data manipulation and descriptive statistics</h1>
<p>Now that we are familiar with some R objects and know how to import data, it is time to write some
code. In this chapter, we are going to compute descriptive statistics for a single dataset, but
also for a list of datasets. However, I will not give a list of functions to compute descriptive
statistics; if you need a specific function you can find easily in the <em>Help</em> pane in Rstudio or
using any modern internet search engine. What I will do is show you a workflow that allows you to
compute the statisics you need fast.
R has a lot of built-in functions for descriptive statistics; however, if you want to compute
statistics by, say, gender, some more complex manipulations are needed. At least this was true in
the past. Nowadays, thanks to the packages from the <code>tidyverse</code>, it is very easy and fast to
compute descriptive statistics by any stratifying variable(s). The packages we are going to use for
this are called <code>dplyr</code> and <code>tidyr</code>. <code>dplyr</code> contains a lot of functions that make manipulating
data and computing descriptive statistics very easy. To make things easier for now, we are going to
use example data included with <code>dplyr</code>. So no need to import an external dataset; this does not
change anything to the example that we are going to study here; the source of the data does not
matter for this. <code>tidyr</code> is very useful to reshape data. We are going to focus on two functions
from <code>tidyr</code>, <code>gather()</code> and <code>spread()</code>. But first, let’s learn about pipes.</p>
<div id="smoking-is-bad-for-you-but-pipes-are-your-friend" class="section level2">
<h2><span class="header-section-number">5.1</span> Smoking is bad for you, but pipes are your friend</h2>
<p>The title of this section might sound weird at first, but by the end of it, you’ll get this
(terrible) pun.</p>
<p>You probably know the following painting by René Magritte, <em>La trahison des images</em>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;assets/pas_une_pipe.png&quot;</span>)</a></code></pre></div>
<p><img src="assets/pas_une_pipe.png" width="350" /></p>
<p>It turns out there’s an R package from the <code>tidyverse</code> that is called <code>magrittr</code>. What does this
package do? It brings <em>pipes</em> to R. Pipes are a concept from the Unix operating system; if you’re
using a GNU+Linux distribution or macOS, you’re basically using a <em>modern</em> unix (that’s an
oversimplification, but I’m an economist by training, and outrageously oversimplifying things is
what we do, deal with it).</p>
<p>The idea of pipes is to take the output of a command, and <em>feed</em> it as the input of another
command. The <code>magrittr</code> package brings pipes to R, by using the weird looking <code>%&gt;%</code>. Try the
following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(magrittr)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span>sqrt</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Super weird right? But you probably understand what happened; <code>16</code> got <em>fed</em> as the first argument of
the function <code>sqrt()</code>. You can chain multiple functions:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="dv">16</span> <span class="op">%&gt;%</span><span class="st"> </span>sqrt <span class="op">%&gt;%</span><span class="st"> `</span><span class="dt">+</span><span class="st">`</span>(<span class="dv">18</span>)</a></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>The output of <code>16</code> (<code>16</code>) got fed to <code>sqrt()</code>, and the output of <code>sqrt(16)</code> (4) got fed to <code>+(18)</code>
(22). Without <code>%&gt;%</code> you’d write the line just above like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">sqrt</span>(<span class="dv">16</span>) <span class="op">+</span><span class="st"> </span><span class="dv">18</span></a></code></pre></div>
<pre><code>## [1] 22</code></pre>
<p>It might not be very clear right now why this is useful, but the <code>%&gt;%</code> is probably one of the infix
operators, because when using packages from the <code>tidyverse</code>, you will naturally want to
chain a lot of functions together. Without the <code>%&gt;%</code> it would become messy very fast.</p>
<p><code>%&gt;%</code> is not the only pipe operator in <code>magrittr</code>. There’s <code>%T%</code>, <code>%&lt;&gt;%</code> and <code>%$%</code>. All have their
uses, but are basically shortcuts to some common tasks with <code>%&gt;%</code> plus another function. Which
means that you can live without them, and because of this, I will only discuss them briefly once
we’ll have learned about the other <code>tidyverse</code> packages.</p>
</div>
<div id="the-tidyverses-enfant-prodige-dplyr" class="section level2">
<h2><span class="header-section-number">5.2</span> The <code>{tidyverse}</code>’s <em>enfant prodige</em>: <code>{dplyr}</code></h2>
<div id="a-first-taste-of-data-manipulation-with-dplyr" class="section level3">
<h3><span class="header-section-number">5.2.1</span> A first taste of data manipulation with <code>{dplyr}</code></h3>
<p>First, let’s load <code>dplyr</code> and the included <code>starwars</code> dataset. Let’s also take a look at the first 5
lines of the dataset:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">data</span>(starwars)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">head</span>(starwars)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   name  height  mass hair_color skin_color eye_color birth_year gender
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 Luke…    172    77 blond      fair       blue            19   male  
## 2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  
## 3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  
## 4 Dart…    202   136 none       white      yellow          41.9 male  
## 5 Leia…    150    49 brown      light      brown           19   female
## 6 Owen…    178   120 brown, gr… light      blue            52   male  
## # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p><code>data(starwars)</code> loads the example dataset called <code>starwars</code> that is included in the package <code>dplyr</code>.
As I said earlier, this is just an example; you could have loaded an external dataset, from a
<code>.csv</code> file for instance. This does not matter for what comes next.</p>
<p>R includes a lot of functions for descriptive statistics, such as <code>mean()</code>, <code>sd()</code>, <code>cov()</code>, and many
more. What <code>dplyr</code> brings to the table (among other niceties) is the possibility to apply these
functions to the dataset easily. For example, imagine you want the average height of everyone in
the dataset. Using the basic R functions, you could write this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">mean</span>(starwars<span class="op">$</span>height)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p><code>starwars$height</code> means that the user wants to access the column called <code>height</code> from the dataset
<code>starwars</code>. Remember that the <code>$</code> symbol is how you access elements of a named list. This is the
same for columns of datasets as you can see. This is then given as an argument to the function
<code>mean()</code>. But what if the user wants the average height by species? Before <code>dplyr</code>, a solution to
this simple problem would have required more than a single command. Now this is as easy as:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))</a></code></pre></div>
<pre><code>## # A tibble: 38 x 2
##    species   `mean(height)`
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 Aleena               79 
##  2 Besalisk            198 
##  3 Cerean              198 
##  4 Chagrian            196 
##  5 Clawdite            168 
##  6 Droid                NA 
##  7 Dug                 112 
##  8 Ewok                 88 
##  9 Geonosian           183 
## 10 Gungan              209.
## # ... with 28 more rows</code></pre>
<p>The usefulness of the <code>%&gt;%</code> (pipe operator) becomes apparent now. Without it, one would write
instead:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">summarise</span>(<span class="kw">group_by</span>(starwars, species), <span class="kw">mean</span>(height))</a></code></pre></div>
<pre><code>## # A tibble: 38 x 2
##    species   `mean(height)`
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 Aleena               79 
##  2 Besalisk            198 
##  3 Cerean              198 
##  4 Chagrian            196 
##  5 Clawdite            168 
##  6 Droid                NA 
##  7 Dug                 112 
##  8 Ewok                 88 
##  9 Geonosian           183 
## 10 Gungan              209.
## # ... with 28 more rows</code></pre>
<p>as you can clearly see, it is much more difficult to read. Imagine now that I want the average height
by species, but only for males. Again, this is very easy using <code>%&gt;%</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))</a></code></pre></div>
<pre><code>## # A tibble: 32 x 2
##    species   `mean(height)`
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 Aleena               79 
##  2 Besalisk            198 
##  3 Cerean              198 
##  4 Chagrian            196 
##  5 Dug                 112 
##  6 Ewok                 88 
##  7 Geonosian           183 
##  8 Gungan              209.
##  9 Human                NA 
## 10 Iktotchi            188 
## # ... with 22 more rows</code></pre>
<p>Again, the <code>%&gt;%</code> makes the above lines of code very easy to read. Without it, one would need to write:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">summarise</span>(<span class="kw">group_by</span>(<span class="kw">filter</span>(starwars, gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>), species), <span class="kw">mean</span>(height))</a></code></pre></div>
<pre><code>## # A tibble: 32 x 2
##    species   `mean(height)`
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 Aleena               79 
##  2 Besalisk            198 
##  3 Cerean              198 
##  4 Chagrian            196 
##  5 Dug                 112 
##  6 Ewok                 88 
##  7 Geonosian           183 
##  8 Gungan              209.
##  9 Human                NA 
## 10 Iktotchi            188 
## # ... with 22 more rows</code></pre>
<p>I think you agree with me that this is not very readable. Once you’re used to <code>%&gt;%</code>, you won’t go
back to not use it.</p>
<p>To make things clearer; <code>filter()</code>, <code>group_by()</code> and <code>summarise()</code> are functions that are included
in <code>dplyr</code>. <code>%&gt;%</code> is actually a function from <code>magrittr</code>, but this package gets loaded on the fly
when you load <code>dplyr</code>, so you do not need to worry about it. <code>mean()</code> is a function <em>native</em>
to R.</p>
<p>The result of all these operations that use <code>dplyr</code> functions are actually other datasets, or
<code>tibbles</code>. This means that you can save them in variable, and then work with these as any other
datasets.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">mean_height =<span class="st"> </span>starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height))</a>
<a class="sourceLine" id="cb21-4" title="4"></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="kw">class</span>(mean_height)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">head</span>(mean_height)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   species  `mean(height)`
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 Aleena               79
## 2 Besalisk            198
## 3 Cerean              198
## 4 Chagrian            196
## 5 Clawdite            168
## 6 Droid                NA</code></pre>
<p>You could then write this data to disk using <code>rio::export()</code> for instance. If you need more than the
mean of the height, you can keep adding as many functions as needed:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">summary_table =<span class="st"> </span>starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height), <span class="dt">var_height =</span> <span class="kw">var</span>(height), <span class="dt">n_obs =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb25-4" title="4"></a>
<a class="sourceLine" id="cb25-5" title="5"><span class="kw">print</span>(summary_table)</a></code></pre></div>
<pre><code>## # A tibble: 38 x 4
##    species   ave_height var_height n_obs
##    &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
##  1 Aleena           79         NA      1
##  2 Besalisk        198         NA      1
##  3 Cerean          198         NA      1
##  4 Chagrian        196         NA      1
##  5 Clawdite        168         NA      1
##  6 Droid            NA         NA      5
##  7 Dug             112         NA      1
##  8 Ewok             88         NA      1
##  9 Geonosian       183         NA      1
## 10 Gungan          209.       201.     3
## # ... with 28 more rows</code></pre>
<p>I’ve added more functions, namely <code>var()</code>, to get the variance of height, and <code>n()</code>, which
is a function from <code>dplyr</code>, not base R, to get the number of observations. This is quite useful,
because we see that for a lot of species we only have one single individual! Let’s focus on the
species for which we have more than 1 individual. Since we save all the previous operations (which
produce a <code>tibble</code>) in a variable, we can keep going from there:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">summary_table2 =<span class="st"> </span>summary_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb27-3" title="3"></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="kw">print</span>(summary_table2)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   species  ave_height var_height n_obs
##   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 Droid           NA         NA      5
## 2 Gungan         209.       201.     3
## 3 Human           NA         NA     35
## 4 Kaminoan       221        128      2
## 5 Mirialan       168          8      2
## 6 Twi&#39;lek        179          2      2
## 7 Wookiee        231         18      2
## 8 Zabrak         173          8      2
## 9 &lt;NA&gt;            NA         NA      5</code></pre>
<p>There’s a lot of <code>NA</code>s; this is because by default, <code>mean()</code> and <code>var()</code> return <code>NA</code> if even one
single observation is <code>NA</code>. This is good, because it forces you to look at the data
to see what is going on. If you would get a number, even if there were <code>NA</code>s you could very easily
miss these missing values. It is better for functions to fail early and often than the opposite.
<code>mean()</code> and <code>var()</code> have a <code>na.rm</code> option that the user can set to <code>TRUE</code> to get the result by
ignoring the <code>NA</code>s:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">var_height =</span> <span class="kw">var</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   species  ave_height var_height n_obs
##   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 Droid          140       2705.     5
## 2 Gungan         209.       201.     3
## 3 Human          177.       157.    35
## 4 Kaminoan       221        128      2
## 5 Mirialan       168          8      2
## 6 Twi&#39;lek        179          2      2
## 7 Wookiee        231         18      2
## 8 Zabrak         173          8      2
## 9 &lt;NA&gt;           160       1826      5</code></pre>
<p>In the code above, I have combined the two previous steps to get the result I’m interested in. There’s
a line in the final output that says <code>NA</code> for the species. Let’s go back to the raw data and find
these lines:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(species))</a></code></pre></div>
<pre><code>## # A tibble: 5 x 13
##   name  height  mass hair_color skin_color eye_color birth_year gender
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 Ric …    183    NA brown      fair       blue              NA male  
## 2 Quar…    183    NA black      dark       brown             62 male  
## 3 R4-P…     96    NA none       silver, r… red, blue         NA female
## 4 Sly …    178    48 none       pale       white             NA female
## 5 Capt…     NA    NA unknown    unknown    unknown           NA female
## # ... with 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>To test for <code>NA</code>, one uses the function <code>is.na()</code> not something like <code>species == &quot;NA&quot;</code> or anything
like that.<code>!is.na()</code> does the opposite:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(species))</a></code></pre></div>
<pre><code>## # A tibble: 82 x 13
##    name  height  mass hair_color skin_color eye_color birth_year gender
##    &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
##  1 Luke…    172    77 blond      fair       blue            19   male  
##  2 C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  
##  3 R2-D2     96    32 &lt;NA&gt;       white, bl… red             33   &lt;NA&gt;  
##  4 Dart…    202   136 none       white      yellow          41.9 male  
##  5 Leia…    150    49 brown      light      brown           19   female
##  6 Owen…    178   120 brown, gr… light      blue            52   male  
##  7 Beru…    165    75 brown      light      blue            47   female
##  8 R5-D4     97    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;  
##  9 Bigg…    183    84 black      light      brown           24   male  
## 10 Obi-…    182    77 auburn, w… fair       blue-gray       57   male  
## # ... with 72 more rows, and 5 more variables: homeworld &lt;chr&gt;,
## #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>The <code>!</code> function negates a predicate function (a predicate function is a function that returns
<code>TRUE</code> or <code>FALSE</code>). We can then rerun our analysis from before:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(species)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">var_height =</span> <span class="kw">var</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   species  ave_height var_height n_obs
##   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 Droid          140       2705.     5
## 2 Gungan         209.       201.     3
## 3 Human          177.       157.    35
## 4 Kaminoan       221        128      2
## 5 Mirialan       168          8      2
## 6 Twi&#39;lek        179          2      2
## 7 Wookiee        231         18      2
## 8 Zabrak         173          8      2</code></pre>
<p>And why not compute the same table, but first add another stratifying variable?</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(species)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(species, gender) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ave_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">var_height =</span> <span class="kw">var</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-5" title="5"><span class="st">  </span><span class="kw">filter</span>(n_obs <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 5
## # Groups:   species [6]
##   species  gender ave_height var_height n_obs
##   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
## 1 Droid    none         200        NA       2
## 2 Droid    &lt;NA&gt;         120      1657       3
## 3 Gungan   male         209.      201.      3
## 4 Human    female       160.       48.8     9
## 5 Human    male         182.       67.1    26
## 6 Mirialan female       168         8       2
## 7 Wookiee  male         231        18       2
## 8 Zabrak   male         173         8       2</code></pre>
<p>Ok, that’s it for a first taste. We have already discovered some very useful <code>{dplyr}</code> functions,
<code>filter()</code>, <code>group_by()</code> and summarise <code>summarise()</code>.</p>
<p>Now, we are going to learn more about these functions in more detail.</p>
</div>
<div id="filter-the-rows-of-a-dataset-with-filter" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Filter the rows of a dataset with <code>filter()</code></h3>
<p>We’re going to use the <code>Gasoline</code> dataset from the <code>plm</code> package, so install that first:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;plm&quot;</span>)</a></code></pre></div>
<p>Then load the required data:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="kw">data</span>(Gasoline, <span class="dt">package =</span> <span class="st">&quot;plm&quot;</span>)</a></code></pre></div>
<p>and load dplyr:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<p>This dataset gives the consumption of gasoline for 18 countries from 1960 to 1978. When
you load the data like this, it is a standard <code>data.frame</code>. <code>dplyr</code> functions can be used on
standard <code>data.frame</code> objects, but just because we learned about <code>tibble</code>’s, let’s convert the data
to a <code>tibble</code> and change its name:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">gasoline &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Gasoline)</a></code></pre></div>
<p><code>filter()</code> is pretty straightforward. What if you would like to subset the data to focus on the
year 1969? Simple:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">filter</span>(gasoline, year <span class="op">==</span><span class="st"> </span><span class="dv">1969</span>)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 6
##    country   year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA   1969     4.05    -6.15 -0.559    -8.79
##  2 BELGIUM   1969     3.85    -5.86 -0.355    -8.52
##  3 CANADA    1969     4.86    -5.56 -1.04     -8.10
##  4 DENMARK   1969     4.17    -5.72 -0.407    -8.47
##  5 FRANCE    1969     3.77    -5.84 -0.315    -8.37
##  6 GERMANY   1969     3.90    -5.83 -0.589    -8.44
##  7 GREECE    1969     4.89    -6.59 -0.180   -10.7 
##  8 IRELAND   1969     4.21    -6.38 -0.272    -8.95
##  9 ITALY     1969     3.74    -6.28 -0.248    -8.67
## 10 JAPAN     1969     4.52    -6.16 -0.417    -9.61
## 11 NETHERLA  1969     3.99    -5.88 -0.417    -8.63
## 12 NORWAY    1969     4.09    -5.74 -0.338    -8.69
## 13 SPAIN     1969     3.99    -5.60  0.669    -9.72
## 14 SWEDEN    1969     3.99    -7.77 -2.73     -8.20
## 15 SWITZERL  1969     4.21    -5.91 -0.918    -8.47
## 16 TURKEY    1969     5.72    -7.39 -0.298   -12.5 
## 17 U.K.      1969     3.95    -6.03 -0.383    -8.47
## 18 U.S.A.    1969     4.84    -5.41 -1.22     -7.79</code></pre>
<p>Remember the pipe operator, <code>%&gt;%</code> from the start of this chapter? Here’s how this would work with
it:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1969</span>)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 6
##    country   year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA   1969     4.05    -6.15 -0.559    -8.79
##  2 BELGIUM   1969     3.85    -5.86 -0.355    -8.52
##  3 CANADA    1969     4.86    -5.56 -1.04     -8.10
##  4 DENMARK   1969     4.17    -5.72 -0.407    -8.47
##  5 FRANCE    1969     3.77    -5.84 -0.315    -8.37
##  6 GERMANY   1969     3.90    -5.83 -0.589    -8.44
##  7 GREECE    1969     4.89    -6.59 -0.180   -10.7 
##  8 IRELAND   1969     4.21    -6.38 -0.272    -8.95
##  9 ITALY     1969     3.74    -6.28 -0.248    -8.67
## 10 JAPAN     1969     4.52    -6.16 -0.417    -9.61
## 11 NETHERLA  1969     3.99    -5.88 -0.417    -8.63
## 12 NORWAY    1969     4.09    -5.74 -0.338    -8.69
## 13 SPAIN     1969     3.99    -5.60  0.669    -9.72
## 14 SWEDEN    1969     3.99    -7.77 -2.73     -8.20
## 15 SWITZERL  1969     4.21    -5.91 -0.918    -8.47
## 16 TURKEY    1969     5.72    -7.39 -0.298   -12.5 
## 17 U.K.      1969     3.95    -6.03 -0.383    -8.47
## 18 U.S.A.    1969     4.84    -5.41 -1.22     -7.79</code></pre>
<p>So <code>gasoline</code>, which is a <code>tibble</code> object, is passed as the first argument of the <code>filter()</code>
function. Starting now, we’re only going to use these pipes. You will see why soon enough, so bear
with me.</p>
<p>You can also filter more than just one year, by using the <code>%in%</code> operator:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1969</span>, <span class="dv">1973</span>))</a></code></pre></div>
<pre><code>## # A tibble: 90 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
##  2 AUSTRIA  1970     4.08    -6.08 -0.597    -8.73
##  3 AUSTRIA  1971     4.11    -6.04 -0.654    -8.64
##  4 AUSTRIA  1972     4.13    -5.98 -0.596    -8.54
##  5 AUSTRIA  1973     4.20    -5.90 -0.594    -8.49
##  6 BELGIUM  1969     3.85    -5.86 -0.355    -8.52
##  7 BELGIUM  1970     3.87    -5.80 -0.378    -8.45
##  8 BELGIUM  1971     3.87    -5.76 -0.399    -8.41
##  9 BELGIUM  1972     3.91    -5.71 -0.311    -8.36
## 10 BELGIUM  1973     3.90    -5.64 -0.373    -8.31
## # ... with 80 more rows</code></pre>
<p>or even non-consecutive years:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1969</span>, <span class="dv">1973</span>, <span class="dv">1977</span>))</a></code></pre></div>
<pre><code>## # A tibble: 54 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
##  2 AUSTRIA  1973     4.20    -5.90 -0.594    -8.49
##  3 AUSTRIA  1977     3.93    -5.83 -0.422    -8.25
##  4 BELGIUM  1969     3.85    -5.86 -0.355    -8.52
##  5 BELGIUM  1973     3.90    -5.64 -0.373    -8.31
##  6 BELGIUM  1977     3.85    -5.56 -0.432    -8.14
##  7 CANADA   1969     4.86    -5.56 -1.04     -8.10
##  8 CANADA   1973     4.90    -5.41 -1.13     -7.94
##  9 CANADA   1977     4.81    -5.34 -1.07     -7.77
## 10 DENMARK  1969     4.17    -5.72 -0.407    -8.47
## # ... with 44 more rows</code></pre>
<p><code>%in%</code> tests if an object is part of a set.</p>
</div>
<div id="select-columns-with-select" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Select columns with <code>select()</code></h3>
<p>While <code>filter()</code> and its scoped versions allow you to keep or discard rows of data, <code>select()</code> (and
its scoped versions) allow you to keep or discard entire columns. To keep columns:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(country, year, lrpmg)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 3
##    country  year  lrpmg
##  * &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 AUSTRIA  1960 -0.335
##  2 AUSTRIA  1961 -0.351
##  3 AUSTRIA  1962 -0.380
##  4 AUSTRIA  1963 -0.414
##  5 AUSTRIA  1964 -0.445
##  6 AUSTRIA  1965 -0.497
##  7 AUSTRIA  1966 -0.467
##  8 AUSTRIA  1967 -0.506
##  9 AUSTRIA  1968 -0.522
## 10 AUSTRIA  1969 -0.559
## # ... with 332 more rows</code></pre>
<p>To discard them:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>country, <span class="op">-</span>year, <span class="op">-</span>lrpmg)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 3
##    lgaspcar lincomep lcarpcap
##  *    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47    -9.77
##  2     4.10    -6.43    -9.61
##  3     4.07    -6.41    -9.46
##  4     4.06    -6.37    -9.34
##  5     4.04    -6.32    -9.24
##  6     4.03    -6.29    -9.12
##  7     4.05    -6.25    -9.02
##  8     4.05    -6.23    -8.93
##  9     4.05    -6.21    -8.85
## 10     4.05    -6.15    -8.79
## # ... with 332 more rows</code></pre>
<p>To rename them:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(country, <span class="dt">date =</span> year, lrpmg)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 3
##    country  date  lrpmg
##  * &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 AUSTRIA  1960 -0.335
##  2 AUSTRIA  1961 -0.351
##  3 AUSTRIA  1962 -0.380
##  4 AUSTRIA  1963 -0.414
##  5 AUSTRIA  1964 -0.445
##  6 AUSTRIA  1965 -0.497
##  7 AUSTRIA  1966 -0.467
##  8 AUSTRIA  1967 -0.506
##  9 AUSTRIA  1968 -0.522
## 10 AUSTRIA  1969 -0.559
## # ... with 332 more rows</code></pre>
<p>There’s also <code>rename()</code>, but it works a bit differently:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">date =</span> year)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  date lgaspcar lincomep  lrpmg lcarpcap
##  * &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p><code>rename()</code> does not do any kind of selection, but just renames.</p>
<p>To re-order them:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(year, country, lrpmg, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##     year country  lrpmg lgaspcar lincomep lcarpcap
##  * &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960 AUSTRIA -0.335     4.17    -6.47    -9.77
##  2  1961 AUSTRIA -0.351     4.10    -6.43    -9.61
##  3  1962 AUSTRIA -0.380     4.07    -6.41    -9.46
##  4  1963 AUSTRIA -0.414     4.06    -6.37    -9.34
##  5  1964 AUSTRIA -0.445     4.04    -6.32    -9.24
##  6  1965 AUSTRIA -0.497     4.03    -6.29    -9.12
##  7  1966 AUSTRIA -0.467     4.05    -6.25    -9.02
##  8  1967 AUSTRIA -0.506     4.05    -6.23    -8.93
##  9  1968 AUSTRIA -0.522     4.05    -6.21    -8.85
## 10  1969 AUSTRIA -0.559     4.05    -6.15    -8.79
## # ... with 332 more rows</code></pre>
<p><code>everything()</code> is another of those helper functions (like <code>starts_with()</code>, and <code>ends_with()</code>). For
example, what if we are only interested in columns whose name start with “l”?</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 4
##    lgaspcar lincomep  lrpmg lcarpcap
##  *    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47 -0.335    -9.77
##  2     4.10    -6.43 -0.351    -9.61
##  3     4.07    -6.41 -0.380    -9.46
##  4     4.06    -6.37 -0.414    -9.34
##  5     4.04    -6.32 -0.445    -9.24
##  6     4.03    -6.29 -0.497    -9.12
##  7     4.05    -6.25 -0.467    -9.02
##  8     4.05    -6.23 -0.506    -8.93
##  9     4.05    -6.21 -0.522    -8.85
## 10     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p>Another verb, similar to <code>select()</code>, is <code>pull()</code>. Let’s compare the two:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lrpmg)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 1
##     lrpmg
##  *  &lt;dbl&gt;
##  1 -0.335
##  2 -0.351
##  3 -0.380
##  4 -0.414
##  5 -0.445
##  6 -0.497
##  7 -0.467
##  8 -0.506
##  9 -0.522
## 10 -0.559
## # ... with 332 more rows</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(lrpmg)</a></code></pre></div>
<pre><code>##   [1] -0.33454761 -0.35132761 -0.37951769 -0.41425139 -0.44533536
##   [6] -0.49706066 -0.46683773 -0.50588340 -0.52241255 -0.55911051
##  [11] -0.59656122 -0.65445914 -0.59633184 -0.59444681 -0.46602693
##  [16] -0.45414221 -0.50008372 -0.42191563 -0.46960312 -0.16570961
##  [21] -0.17173098 -0.22229138 -0.25046225 -0.27591057 -0.34493695
##  [26] -0.23639770 -0.26699499 -0.31116076 -0.35480852 -0.37794044
##  [31] -0.39922992 -0.31064584 -0.37309192 -0.36223563 -0.36430848
##  [36] -0.37896584 -0.43164133 -0.59094964 -0.97210650 -0.97229024
##  [41] -0.97860756 -1.01904791 -1.00285696 -1.01712549 -1.01694436
##  [46] -1.02359713 -1.01984524 -1.03686389 -1.06733308 -1.05803676
##  [51] -1.09966703 -1.13316142 -1.12379997 -1.18568427 -1.06179659
##  [56] -1.07084448 -1.07495073 -0.19570260 -0.25361844 -0.21875400
##  [61] -0.24800936 -0.30654923 -0.32701542 -0.39618846 -0.44257369
##  [66] -0.35204752 -0.40687922 -0.44046082 -0.45473954 -0.49918863
##  [71] -0.43257185 -0.42517720 -0.39395431 -0.35361534 -0.35690917
##  [76] -0.29068135 -0.01959833 -0.02386000 -0.06892022 -0.13792900
##  [81] -0.19784646 -0.23365325 -0.26427164 -0.29405795 -0.32316179
##  [86] -0.31519087 -0.33384616 -0.37945667 -0.40781642 -0.47503429
##  [91] -0.21698191 -0.25838174 -0.24651309 -0.22550681 -0.38075942
##  [96] -0.18591078 -0.23095384 -0.34384171 -0.37464672 -0.39965256
## [101] -0.43987825 -0.54000197 -0.54998139 -0.43824222 -0.58923137
## [106] -0.63329520 -0.67176311 -0.71797458 -0.72587521 -0.56982876
## [111] -0.56482380 -0.62481298 -0.59761210 -0.62817279 -0.08354740
## [116] -0.10421997 -0.13320751 -0.15653576 -0.18051772 -0.07793999
## [121] -0.11491900 -0.13775849 -0.15375883 -0.17986997 -0.20252426
## [126] -0.06761078 -0.11973059 -0.05191029  0.31625351  0.20631574
## [131]  0.19319312  0.23502961  0.16896037 -0.07648118 -0.12040874
## [136] -0.14160039 -0.15232915 -0.24428212 -0.16899366 -0.21071901
## [141] -0.17383533 -0.21339314 -0.27162842 -0.32069023 -0.36041067
## [146] -0.42393131 -0.64567297 -0.55343875 -0.64126416 -0.66134256
## [151] -0.56011483 -0.66277808  0.16507708 -0.08559038 -0.18351291
## [156] -0.26541405 -0.42609643 -0.32712637 -0.24887418 -0.19160048
## [161] -0.20616656 -0.24756681 -0.23271512 -0.14822267 -0.21508857
## [166] -0.32508487 -0.22290860 -0.03270913  0.10292798  0.16418805
## [171]  0.03482212 -0.14532271 -0.14874940 -0.18731459 -0.19996473
## [176] -0.20386433 -0.23786571 -0.27411537 -0.33167240 -0.35126918
## [181] -0.41685019 -0.46203546 -0.43941354 -0.52100094 -0.46270739
## [186] -0.19090636 -0.15948473 -0.20726559 -0.21904447 -0.28707638
## [191] -0.20148480 -0.21599265 -0.25968008 -0.29718661 -0.36929389
## [196] -0.34197503 -0.34809007 -0.31232019 -0.44450431 -0.41694955
## [201] -0.39954544 -0.43393029 -0.31903240 -0.42728193 -0.35253685
## [206] -0.43426178 -0.42908393 -0.46474195 -0.55791459 -0.13968957
## [211] -0.15790514 -0.19908809 -0.23263318 -0.26374731 -0.31593124
## [216] -0.25011726 -0.26555763 -0.30036775 -0.33823045 -0.39072560
## [221] -0.30127223 -0.26023925 -0.33880765 -0.15100924 -0.32726757
## [226] -0.35308752 -0.38255762 -0.30765935  1.12531070  1.10956235
## [231]  1.05700394  0.97683534  0.91532254  0.81666055  0.75671751
## [236]  0.74130811  0.70386453  0.66948950  0.61217208  0.60699563
## [241]  0.53716844  0.43377166  0.52492096  0.62955545  0.68385409
## [246]  0.52627167  0.62141374 -2.52041588 -2.57148340 -2.53448158
## [251] -2.60511224 -2.65801626 -2.64476790 -2.63901460 -2.65609762
## [256] -2.67918662 -2.73190414 -2.73359211 -2.77884554 -2.77467537
## [261] -2.84142900 -2.79840677 -2.76731461 -2.82294480 -2.82005896
## [266] -2.89649671 -0.82321833 -0.86558473 -0.82218510 -0.86012004
## [271] -0.86767682 -0.90528668 -0.85956665 -0.90656671 -0.87232520
## [276] -0.91812162 -0.96344188 -1.03746081 -0.94015345 -0.86722756
## [281] -0.88692306 -0.88475790 -0.90736205 -0.91147285 -1.03208811
## [286] -0.25340821 -0.34252375 -0.40820484 -0.22499174 -0.25219448
## [291] -0.29347614 -0.35640491 -0.33515022 -0.36507386 -0.29845417
## [296] -0.39882648 -0.30461880 -0.54637424 -0.69162023 -0.33965308
## [301] -0.53794675 -0.75141027 -0.95552413 -0.35290961 -0.39108581
## [306] -0.45185308 -0.42287690 -0.46335147 -0.49577430 -0.42654915
## [311] -0.47068145 -0.44118786 -0.46245080 -0.38332457 -0.41899030
## [316] -0.46135978 -0.52777246 -0.56529718 -0.56641296 -0.20867428
## [321] -0.27354010 -0.50886285 -0.78652911 -1.12111489 -1.14624034
## [326] -1.16187449 -1.17991524 -1.20026222 -1.19428750 -1.19026054
## [331] -1.18991215 -1.20730059 -1.22314272 -1.25176347 -1.28131560
## [336] -1.33116930 -1.29066967 -1.23146686 -1.20037697 -1.15468197
## [341] -1.17590974 -1.21206183</code></pre>
<p><code>pull()</code>, unlike <code>select()</code>, does not return a <code>tibble</code>, but only the atomic vector.</p>
</div>
<div id="group-the-observations-of-your-dataset-with-group_by" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Group the observations of your dataset with <code>group_by()</code></h3>
<p><code>group_by()</code> is a very useful verb; as the name implies, it allows you to create groups and then,
for example, compute descriptive statistics by groups. For example, let’s group our data by
country:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(country)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##  * &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p>It looks like nothing much happened, but if you look at the second line of the output you can read
the following:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="co">## # Groups:   country [18]</span></a></code></pre></div>
<p>this means that the data is grouped, and every computation you will do now will take these groups
into account. This will be clearer in the next subsection.</p>
<p>It is also possible to group according to various variables:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(country, year)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
## # Groups:   country, year [342]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##  * &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p>and so on. You can then also ungroup:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##  * &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
</div>
<div id="get-summary-statistics-with-summarise" class="section level3">
<h3><span class="header-section-number">5.2.5</span> Get summary statistics with <code>summarise()</code></h3>
<p>Ok, now that we have learned the basic verbs, we can start to do more interesting stuff. For
example, one might want to compute the average gasoline consumption in each country, for
the whole period:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(lgaspcar))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##    country  `mean(lgaspcar)`
##    &lt;fct&gt;               &lt;dbl&gt;
##  1 AUSTRIA              4.06
##  2 BELGIUM              3.92
##  3 CANADA               4.86
##  4 DENMARK              4.19
##  5 FRANCE               3.82
##  6 GERMANY              3.89
##  7 GREECE               4.88
##  8 IRELAND              4.23
##  9 ITALY                3.73
## 10 JAPAN                4.70
## 11 NETHERLA             4.08
## 12 NORWAY               4.11
## 13 SPAIN                4.06
## 14 SWEDEN               4.01
## 15 SWITZERL             4.24
## 16 TURKEY               5.77
## 17 U.K.                 3.98
## 18 U.S.A.               4.82</code></pre>
<p><code>mean()</code> was given as an argument to <code>summarise()</code>, which is a <code>dplyr</code> verb. What we get is another
tibble, that contains the variable we used to group, as well as the average per country. We can
also rename this column:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb76-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb76-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_gaspcar =</span> <span class="kw">mean</span>(lgaspcar))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##    country  mean_gaspcar
##    &lt;fct&gt;           &lt;dbl&gt;
##  1 AUSTRIA          4.06
##  2 BELGIUM          3.92
##  3 CANADA           4.86
##  4 DENMARK          4.19
##  5 FRANCE           3.82
##  6 GERMANY          3.89
##  7 GREECE           4.88
##  8 IRELAND          4.23
##  9 ITALY            3.73
## 10 JAPAN            4.70
## 11 NETHERLA         4.08
## 12 NORWAY           4.11
## 13 SPAIN            4.06
## 14 SWEDEN           4.01
## 15 SWITZERL         4.24
## 16 TURKEY           5.77
## 17 U.K.             3.98
## 18 U.S.A.           4.82</code></pre>
<p>and because the output is a <code>tibble</code>, we can continue to use <code>dplyr</code> verbs on it:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_gaspcar =</span> <span class="kw">mean</span>(lgaspcar)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb78-4" title="4"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;FRANCE&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   country mean_gaspcar
##   &lt;fct&gt;          &lt;dbl&gt;
## 1 FRANCE          3.82</code></pre>
<p>Ok, let’s pause here. See what I did in the last example? I chained 3 <code>dplyr</code> verbs together with
<code>%&gt;%</code>. Without using <code>%&gt;%</code> I would have written:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1"><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb80-2" title="2">  <span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb80-3" title="3">    <span class="kw">group_by</span>(gasoline, country),</a>
<a class="sourceLine" id="cb80-4" title="4">    <span class="dt">mean_gaspcar =</span> <span class="kw">mean</span>(lgaspcar)),</a>
<a class="sourceLine" id="cb80-5" title="5">  country <span class="op">==</span><span class="st"> &quot;FRANCE&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   country mean_gaspcar
##   &lt;fct&gt;          &lt;dbl&gt;
## 1 FRANCE          3.82</code></pre>
<p>I don’t know about you, but this is much more difficult to read than the version with <code>%&gt;%</code>. It is
possible to work like that, of course, but personally, I would advise you bite the bullet and learn
to love the pipe. It won’t give you cancer.</p>
<p>Ok, back to <code>summarise()</code>. We can really do a lot of stuff with this verb. For example, we can
compute several descriptive statistics at once:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb82-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_gaspcar =</span> <span class="kw">mean</span>(lgaspcar),</a>
<a class="sourceLine" id="cb82-4" title="4">            <span class="dt">sd_gaspcar =</span> <span class="kw">sd</span>(lgaspcar),</a>
<a class="sourceLine" id="cb82-5" title="5">            <span class="dt">max_gaspcar =</span> <span class="kw">max</span>(lgaspcar),</a>
<a class="sourceLine" id="cb82-6" title="6">            <span class="dt">min_gaspcar =</span> <span class="kw">min</span>(lgaspcar))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 5
##    country  mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##    &lt;fct&gt;           &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 AUSTRIA          4.06     0.0693        4.20        3.92
##  2 BELGIUM          3.92     0.103         4.16        3.82
##  3 CANADA           4.86     0.0262        4.90        4.81
##  4 DENMARK          4.19     0.158         4.50        4.00
##  5 FRANCE           3.82     0.0499        3.91        3.75
##  6 GERMANY          3.89     0.0239        3.93        3.85
##  7 GREECE           4.88     0.255         5.38        4.48
##  8 IRELAND          4.23     0.0437        4.33        4.16
##  9 ITALY            3.73     0.220         4.05        3.38
## 10 JAPAN            4.70     0.684         6.00        3.95
## 11 NETHERLA         4.08     0.286         4.65        3.71
## 12 NORWAY           4.11     0.123         4.44        3.96
## 13 SPAIN            4.06     0.317         4.75        3.62
## 14 SWEDEN           4.01     0.0364        4.07        3.91
## 15 SWITZERL         4.24     0.102         4.44        4.05
## 16 TURKEY           5.77     0.329         6.16        5.14
## 17 U.K.             3.98     0.0479        4.10        3.91
## 18 U.S.A.           4.82     0.0219        4.86        4.79</code></pre>
<p>Because the output is a <code>tibble</code>, you can save it in a variable of course:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">desc_gasoline &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb84-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_gaspcar =</span> <span class="kw">mean</span>(lgaspcar),</a>
<a class="sourceLine" id="cb84-4" title="4">            <span class="dt">sd_gaspcar =</span> <span class="kw">sd</span>(lgaspcar),</a>
<a class="sourceLine" id="cb84-5" title="5">            <span class="dt">max_gaspcar =</span> <span class="kw">max</span>(lgaspcar),</a>
<a class="sourceLine" id="cb84-6" title="6">            <span class="dt">min_gaspcar =</span> <span class="kw">min</span>(lgaspcar))</a></code></pre></div>
<p>And then you can answer questions such as, <em>which country has the maximum average gasoline
consumption?</em>:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">desc_gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">max</span>(mean_gaspcar) <span class="op">==</span><span class="st"> </span>mean_gaspcar)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   country mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##   &lt;fct&gt;          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 TURKEY          5.77      0.329        6.16        5.14</code></pre>
<p>Turns out it’s Turkey. What about the minimum consumption?</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">desc_gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">min</span>(mean_gaspcar) <span class="op">==</span><span class="st"> </span>mean_gaspcar)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   country mean_gaspcar sd_gaspcar max_gaspcar min_gaspcar
##   &lt;fct&gt;          &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 ITALY           3.73      0.220        4.05        3.38</code></pre>
</div>
<div id="adding-columns-with-mutate-and-transmute" class="section level3">
<h3><span class="header-section-number">5.2.6</span> Adding columns with <code>mutate()</code> and <code>transmute()</code></h3>
<p><code>mutate()</code> adds a column to the <code>tibble</code>, which can contain any transformation of any other
variable:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap `n()`
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77    19
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61    19
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46    19
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34    19
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24    19
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12    19
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02    19
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93    19
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85    19
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79    19
## # ... with 332 more rows</code></pre>
<p>Using <code>mutate()</code> I’ve added a column that counts how many times the country appears in the <code>tibble</code>,
using <code>n()</code>, another <code>dplyr</code> function. There’s also <code>count()</code> and <code>tally()</code>, which we are going to
see further down. It is also possible to rename the column on the fly:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">freq =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap  freq
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77    19
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61    19
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46    19
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34    19
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24    19
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12    19
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02    19
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93    19
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85    19
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79    19
## # ... with 332 more rows</code></pre>
<p>It is possible to do any arbitrary operation:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spam =</span> <span class="kw">exp</span>(lgaspcar <span class="op">+</span><span class="st"> </span>lincomep))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap   spam
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 AUSTRIA  1960     4.17    -6.47 -0.335    -9.77 0.100 
##  2 AUSTRIA  1961     4.10    -6.43 -0.351    -9.61 0.0978
##  3 AUSTRIA  1962     4.07    -6.41 -0.380    -9.46 0.0969
##  4 AUSTRIA  1963     4.06    -6.37 -0.414    -9.34 0.0991
##  5 AUSTRIA  1964     4.04    -6.32 -0.445    -9.24 0.102 
##  6 AUSTRIA  1965     4.03    -6.29 -0.497    -9.12 0.104 
##  7 AUSTRIA  1966     4.05    -6.25 -0.467    -9.02 0.110 
##  8 AUSTRIA  1967     4.05    -6.23 -0.506    -8.93 0.113 
##  9 AUSTRIA  1968     4.05    -6.21 -0.522    -8.85 0.115 
## 10 AUSTRIA  1969     4.05    -6.15 -0.559    -8.79 0.122 
## # ... with 332 more rows</code></pre>
<p><code>transmute()</code> is the same as <code>mutate()</code>, but only returns the created variable:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-3" title="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">spam =</span> <span class="kw">exp</span>(lgaspcar <span class="op">+</span><span class="st"> </span>lincomep))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 2
## # Groups:   country [18]
##    country   spam
##    &lt;fct&gt;    &lt;dbl&gt;
##  1 AUSTRIA 0.100 
##  2 AUSTRIA 0.0978
##  3 AUSTRIA 0.0969
##  4 AUSTRIA 0.0991
##  5 AUSTRIA 0.102 
##  6 AUSTRIA 0.104 
##  7 AUSTRIA 0.110 
##  8 AUSTRIA 0.113 
##  9 AUSTRIA 0.115 
## 10 AUSTRIA 0.122 
## # ... with 332 more rows</code></pre>
</div>
</div>
<div id="reshaping-data-with-tidyr" class="section level2">
<h2><span class="header-section-number">5.3</span> Reshaping data with <code>tidyr</code></h2>
<p>Another important package from the <code>tidyverse</code> that goes hand in hand with <code>dplyr</code> is <code>tidyr</code>. <code>tidyr</code>
is the package you need when it’s time to reshape data. The basic functions from <code>tidyr</code>, <code>spread()</code>
and <code>gather()</code> make it possible to go from long to wide datasets respectively.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="kw">library</span>(tidyr)</a></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1">survey_data =<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb98-2" title="2">  <span class="op">~</span>id, <span class="op">~</span>variable, <span class="op">~</span>value,</a>
<a class="sourceLine" id="cb98-3" title="3">  <span class="dv">1</span>, <span class="st">&quot;var1&quot;</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb98-4" title="4">  <span class="dv">1</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb98-5" title="5">  <span class="dv">2</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.4</span>,</a>
<a class="sourceLine" id="cb98-6" title="6">  <span class="dv">2</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span>,</a>
<a class="sourceLine" id="cb98-7" title="7">  <span class="dv">3</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb98-8" title="8">  <span class="dv">3</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">2.8</span>,</a>
<a class="sourceLine" id="cb98-9" title="9">  <span class="dv">4</span>, <span class="st">&quot;var1&quot;</span>, <span class="fl">1.7</span>,</a>
<a class="sourceLine" id="cb98-10" title="10">  <span class="dv">4</span>, <span class="st">&quot;var2&quot;</span>, <span class="fl">1.9</span></a>
<a class="sourceLine" id="cb98-11" title="11">)</a>
<a class="sourceLine" id="cb98-12" title="12"></a>
<a class="sourceLine" id="cb98-13" title="13"><span class="kw">head</span>(survey_data)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##      id variable value
##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1     1 var1       1  
## 2     1 var2       0.2
## 3     2 var1       1.4
## 4     2 var2       1.9
## 5     3 var1       0.1
## 6     3 var2       2.8</code></pre>
<p>This above is a long dataset. We can reshape it to be wide using the <code>spread()</code> function:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1">wide_data =<span class="st"> </span>survey_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb100-2" title="2"><span class="st">  </span><span class="kw">spread</span>(variable, value)</a>
<a class="sourceLine" id="cb100-3" title="3"></a>
<a class="sourceLine" id="cb100-4" title="4"><span class="kw">head</span>(wide_data)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##      id  var1  var2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1   1     0.2
## 2     2   1.4   1.9
## 3     3   0.1   2.8
## 4     4   1.7   1.9</code></pre>
<p>This means that we spread the column called “variable”, which will produce one column per category
of “variable”. Then we fill in the rows with the data contained in the column “value”.</p>
<p>To go from a wide dataset to a long one, we use <code>gather()</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">long_data =<span class="st"> </span>wide_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-2" title="2"><span class="st">  </span><span class="kw">gather</span>(variable, value, var1, var2)</a>
<a class="sourceLine" id="cb102-3" title="3"></a>
<a class="sourceLine" id="cb102-4" title="4"><span class="kw">print</span>(long_data)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##      id variable value
##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1     1 var1       1  
## 2     2 var1       1.4
## 3     3 var1       0.1
## 4     4 var1       1.7
## 5     1 var2       0.2
## 6     2 var2       1.9
## 7     3 var2       2.8
## 8     4 var2       1.9</code></pre>
<p><code>long_data</code> and <code>survey_data</code> are the same datasets, but in a different order.</p>
<p>In the <code>wide_data</code> <code>tibble</code>, we had 3 columns: <code>id</code>, <code>var1</code> and <code>var2</code>. We want to stack ‘var1’ and
‘var2’ in a new column, that we chose to call “variable”. This is the “key”. For the value, we are
using the values contained in <code>var1</code> and <code>var2</code>. Sometimes using <code>spread()</code> or <code>gather()</code> requires
some trial and error. I advise you play around with the examples above to really grasp how these
powerful functions work.</p>
<p>The last function from <code>tidyr</code> that we are going to discuss is <code>nest()</code>, but we will keep it for
later, in the section about so-called <em>list-columns</em>.</p>
</div>
<div id="getting-to-know-factor-variables" class="section level2">
<h2><span class="header-section-number">5.4</span> Getting to know <code>factor</code> variables</h2>
<p>Remember in chapter 3 when I very quickly explained what were <code>factor</code> variables? In this section,
we are going to work a little bit with these type of variable. <code>factor</code>s are very useful, and the
<code>forcats</code> package includes some handy functions to work with them. First, let’s load the <code>forcats</code> package:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="kw">library</span>(forcats)</a></code></pre></div>
<p>as an example, we are going to work with the <code>gss_cat</code> dataset that is included in <code>forcats</code>. Let’s
load that:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1"><span class="kw">data</span>(gss_cat)</a>
<a class="sourceLine" id="cb105-2" title="2"></a>
<a class="sourceLine" id="cb105-3" title="3"><span class="kw">head</span>(gss_cat)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##    year marital     age race  rincome   partyid    relig   denom   tvhours
##   &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;
## 1  2000 Never ma…    26 White $8000 to… Ind,near … Protes… Southe…      12
## 2  2000 Divorced     48 White $8000 to… Not str r… Protes… Baptis…      NA
## 3  2000 Widowed      67 White Not appl… Independe… Protes… No den…       2
## 4  2000 Never ma…    39 White Not appl… Ind,near … Orthod… Not ap…       4
## 5  2000 Divorced     25 White Not appl… Not str d… None    Not ap…       1
## 6  2000 Married      25 White $20000 -… Strong de… Protes… Southe…      NA</code></pre>
<p>as you can see, <code>marital</code>, <code>race</code>, <code>rincome</code> and <code>partyid</code> are all factor variables. Let’s take a closer
look at <code>marital</code>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1"><span class="kw">str</span>(gss_cat<span class="op">$</span>marital)</a></code></pre></div>
<pre><code>##  Factor w/ 6 levels &quot;No answer&quot;,&quot;Never married&quot;,..: 2 4 5 2 4 6 2 4 6 6 ...</code></pre>
<p>and let’s see <code>rincome</code>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="kw">str</span>(gss_cat<span class="op">$</span>rincome)</a></code></pre></div>
<pre><code>##  Factor w/ 16 levels &quot;No answer&quot;,&quot;Don&#39;t know&quot;,..: 8 8 16 16 16 5 4 9 4 4 ...</code></pre>
<p><code>factor</code> variables have different levels and the <code>forcats</code> package includes functions that allow
you to recode, collapse and do all sorts of things on these levels. For example , using
<code>forcats::fct_recode()</code> you can recode levels:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1">gss_cat =<span class="st"> </span>gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marital =</span> <span class="kw">fct_recode</span>(marital,</a>
<a class="sourceLine" id="cb111-3" title="3">                              <span class="dt">refuse =</span> <span class="st">&quot;No answer&quot;</span>,</a>
<a class="sourceLine" id="cb111-4" title="4">                              <span class="dt">never_married =</span> <span class="st">&quot;Never married&quot;</span>,</a>
<a class="sourceLine" id="cb111-5" title="5">                              <span class="dt">divorced =</span> <span class="st">&quot;Separated&quot;</span>,</a>
<a class="sourceLine" id="cb111-6" title="6">                              <span class="dt">divorced =</span> <span class="st">&quot;Divorced&quot;</span>,</a>
<a class="sourceLine" id="cb111-7" title="7">                              <span class="dt">widowed =</span> <span class="st">&quot;Widowed&quot;</span>,</a>
<a class="sourceLine" id="cb111-8" title="8">                              <span class="dt">married =</span> <span class="st">&quot;Married&quot;</span>))</a>
<a class="sourceLine" id="cb111-9" title="9"></a>
<a class="sourceLine" id="cb111-10" title="10">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-11" title="11"><span class="st">  </span><span class="kw">tabyl</span>(marital)</a></code></pre></div>
<pre><code>##        marital     n      percent
##         refuse    17 0.0007913234
##  never_married  5416 0.2521063166
##       divorced  4126 0.1920588372
##        widowed  1807 0.0841130196
##        married 10117 0.4709305032</code></pre>
<p>Using <code>fct_recode()</code>, I was able to recode the levels and collapse <code>Separated</code> and <code>Divorced</code> to
a single category called <code>divorced</code>. As you can see, <code>refuse</code> and <code>widowed</code> are less than 10%, so
maybe you’d want to lump these categories together:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1">gss_cat =<span class="st"> </span>gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marital =</span> <span class="kw">fct_lump</span>(marital, <span class="dt">prop =</span> <span class="fl">0.10</span>, <span class="dt">other_level =</span> <span class="st">&quot;other&quot;</span>))</a>
<a class="sourceLine" id="cb113-3" title="3"></a>
<a class="sourceLine" id="cb113-4" title="4">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-5" title="5"><span class="st">  </span><span class="kw">tabyl</span>(marital)</a></code></pre></div>
<pre><code>##        marital     n    percent
##  never_married  5416 0.25210632
##       divorced  4126 0.19205884
##        married 10117 0.47093050
##          other  1824 0.08490434</code></pre>
<p>I suggest you read <code>forcats</code>’ help page and discover the other functions it contains.</p>
</div>
<div id="scoped-tidyverse-verbs" class="section level2">
<h2><span class="header-section-number">5.5</span> Scoped <code>{tidyverse}</code> verbs</h2>
<p>Scoped verbs are …</p>
<div id="filter_" class="section level3">
<h3><span class="header-section-number">5.5.1</span> filter_()</h3>
<p><code>filter()</code> is not the only <em>filtering</em> verb there is. Suppose that we have a condition that we want
to use to filter out a lot of columns at once. For example, for every column that is of type
<code>numeric</code>, keep only the lines where the condition <em>value &gt; -8</em> is satisfied. The next line does
that:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter_if</span>( <span class="op">~</span><span class="kw">all</span>(<span class="kw">is.numeric</span>(.)), <span class="kw">all_vars</span>(. <span class="op">&gt;</span><span class="st"> </span><span class="dv">-8</span>))</a></code></pre></div>
<pre><code>## # A tibble: 30 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 CANADA   1972     4.89    -5.44 -1.10     -7.99
##  2 CANADA   1973     4.90    -5.41 -1.13     -7.94
##  3 CANADA   1974     4.89    -5.42 -1.12     -7.90
##  4 CANADA   1975     4.89    -5.38 -1.19     -7.87
##  5 CANADA   1976     4.84    -5.36 -1.06     -7.81
##  6 CANADA   1977     4.81    -5.34 -1.07     -7.77
##  7 CANADA   1978     4.86    -5.31 -1.07     -7.79
##  8 GERMANY  1978     3.88    -5.56 -0.628    -7.95
##  9 SWEDEN   1975     3.97    -7.68 -2.77     -7.99
## 10 SWEDEN   1976     3.98    -7.67 -2.82     -7.96
## # ... with 20 more rows</code></pre>
<p>It’s a bit more complicated than before. <code>filter_if()</code> needs 3 arguments to work; the data, a
predicate function (a function that returns <code>TRUE</code>, or <code>FALSE</code>) which will select the columns we
want to work on, and then the condition. The condition can be applied to <em>all</em> the columns that
were selected by the predicate function (hence the <code>all_vars()</code>) or only to at least one (you’d use
<code>any_vars()</code> then). Try to change the condition, or the predicate function, to figure out how
<code>filter_if()</code> works. The dot is a placeholder that stands for whatever columns where selected.</p>
<p><code>filter_at()</code> works differently; it allows the user to filter columns by position:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter_at</span>(<span class="kw">vars</span>(<span class="kw">ends_with</span>(<span class="st">&quot;p&quot;</span>)), <span class="kw">all_vars</span>(. <span class="op">&gt;</span><span class="st"> </span><span class="dv">-8</span>))</a></code></pre></div>
<pre><code>## # A tibble: 30 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 CANADA   1972     4.89    -5.44 -1.10     -7.99
##  2 CANADA   1973     4.90    -5.41 -1.13     -7.94
##  3 CANADA   1974     4.89    -5.42 -1.12     -7.90
##  4 CANADA   1975     4.89    -5.38 -1.19     -7.87
##  5 CANADA   1976     4.84    -5.36 -1.06     -7.81
##  6 CANADA   1977     4.81    -5.34 -1.07     -7.77
##  7 CANADA   1978     4.86    -5.31 -1.07     -7.79
##  8 GERMANY  1978     3.88    -5.56 -0.628    -7.95
##  9 SWEDEN   1975     3.97    -7.68 -2.77     -7.99
## 10 SWEDEN   1976     3.98    -7.67 -2.82     -7.96
## # ... with 20 more rows</code></pre>
<p><code>end_with()</code> is a helper function that we are going to use a lot (as well as <code>starts_with()</code> and
some others, you’ll see..). So the above line means “for the columns whose name end with a ‘p’ only
keep the lines where, for all the selected columns, the values are strictly superior to <code>-8</code>”.
Again, this is not very easy the first time you deal with that, so play around with it for a bit.</p>
<p><code>filter_all()</code>, as the name implies, considers all variables for the filtering step.</p>
<p><code>filter_if()</code> and <code>filter_at()</code> are very useful when you have very large datasets with a lot of
variables and you want to apply a filtering function only to a subset of them. <code>filter_all()</code> is
useful if, for example, you only want to keep the positive values for all the columns.</p>
</div>
<div id="select_" class="section level3">
<h3><span class="header-section-number">5.5.2</span> select_()</h3>
<p>The same can be achieved with <code>select_at()</code>:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 4
##    lgaspcar lincomep  lrpmg lcarpcap
##  *    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1     4.17    -6.47 -0.335    -9.77
##  2     4.10    -6.43 -0.351    -9.61
##  3     4.07    -6.41 -0.380    -9.46
##  4     4.06    -6.37 -0.414    -9.34
##  5     4.04    -6.32 -0.445    -9.24
##  6     4.03    -6.29 -0.497    -9.12
##  7     4.05    -6.25 -0.467    -9.02
##  8     4.05    -6.23 -0.506    -8.93
##  9     4.05    -6.21 -0.522    -8.85
## 10     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p><code>select_at()</code> can be quite useful if you know the position of the columns you’re interested in:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_at</span>(<span class="kw">vars</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 3
##    country  year  lrpmg
##  * &lt;fct&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1 AUSTRIA  1960 -0.335
##  2 AUSTRIA  1961 -0.351
##  3 AUSTRIA  1962 -0.380
##  4 AUSTRIA  1963 -0.414
##  5 AUSTRIA  1964 -0.445
##  6 AUSTRIA  1965 -0.497
##  7 AUSTRIA  1966 -0.467
##  8 AUSTRIA  1967 -0.506
##  9 AUSTRIA  1968 -0.522
## 10 AUSTRIA  1969 -0.559
## # ... with 332 more rows</code></pre>
<p>This also works with <code>filter_at()</code> by the way.</p>
<p><code>select_if()</code> makes it easy to select columns that satisfy a criterium:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_if</span>(is.numeric)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 5
##     year lgaspcar lincomep  lrpmg lcarpcap
##  * &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960     4.17    -6.47 -0.335    -9.77
##  2  1961     4.10    -6.43 -0.351    -9.61
##  3  1962     4.07    -6.41 -0.380    -9.46
##  4  1963     4.06    -6.37 -0.414    -9.34
##  5  1964     4.04    -6.32 -0.445    -9.24
##  6  1965     4.03    -6.29 -0.497    -9.12
##  7  1966     4.05    -6.25 -0.467    -9.02
##  8  1967     4.05    -6.23 -0.506    -8.93
##  9  1968     4.05    -6.21 -0.522    -8.85
## 10  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
<p>You can even pass a further function to <code>select_if()</code> that will be applied to the selected columns:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">gasoline <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_if</span>(is.numeric, toupper)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 5
##     YEAR LGASPCAR LINCOMEP  LRPMG LCARPCAP
##  * &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1  1960     4.17    -6.47 -0.335    -9.77
##  2  1961     4.10    -6.43 -0.351    -9.61
##  3  1962     4.07    -6.41 -0.380    -9.46
##  4  1963     4.06    -6.37 -0.414    -9.34
##  5  1964     4.04    -6.32 -0.445    -9.24
##  6  1965     4.03    -6.29 -0.497    -9.12
##  7  1966     4.05    -6.25 -0.467    -9.02
##  8  1967     4.05    -6.23 -0.506    -8.93
##  9  1968     4.05    -6.21 -0.522    -8.85
## 10  1969     4.05    -6.15 -0.559    -8.79
## # ... with 332 more rows</code></pre>
</div>
<div id="group_by_" class="section level3">
<h3><span class="header-section-number">5.5.3</span> group_by_()</h3>
</div>
<div id="summarise_" class="section level3">
<h3><span class="header-section-number">5.5.4</span> summarise_()</h3>
<p>Just like for <code>filter()</code> and <code>select()</code>, <code>summarise()</code> comes with scoped versions:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-3" title="3"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>)), mean)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 5
##    country  lgaspcar lincomep   lrpmg lcarpcap
##    &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 AUSTRIA      4.06    -6.12 -0.486     -8.85
##  2 BELGIUM      3.92    -5.85 -0.326     -8.63
##  3 CANADA       4.86    -5.58 -1.05      -8.08
##  4 DENMARK      4.19    -5.76 -0.358     -8.58
##  5 FRANCE       3.82    -5.87 -0.253     -8.45
##  6 GERMANY      3.89    -5.85 -0.517     -8.51
##  7 GREECE       4.88    -6.61 -0.0339   -10.8 
##  8 IRELAND      4.23    -6.44 -0.348     -9.04
##  9 ITALY        3.73    -6.35 -0.152     -8.83
## 10 JAPAN        4.70    -6.25 -0.287     -9.95
## 11 NETHERLA     4.08    -5.92 -0.370     -8.82
## 12 NORWAY       4.11    -5.75 -0.278     -8.77
## 13 SPAIN        4.06    -5.63  0.739     -9.90
## 14 SWEDEN       4.01    -7.82 -2.71      -8.25
## 15 SWITZERL     4.24    -5.93 -0.902     -8.54
## 16 TURKEY       5.77    -7.34 -0.422    -12.5 
## 17 U.K.         3.98    -6.02 -0.459     -8.55
## 18 U.S.A.       4.82    -5.45 -1.21      -7.78</code></pre>
<p>See how I managed to summarise every variable in one simple call to <code>summarise_at()</code>? Simply by
using <code>vars()</code> and specifying that I was interested in the ones that started with “l” and then I
specified the function I wanted. But what if I wanted to use more than one function to summarise
the data? Very easy:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb129-3" title="3"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>)), <span class="kw">funs</span>(mean, sd, max, min))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 17
##    country lgaspcar_mean lincomep_mean lrpmg_mean lcarpcap_mean lgaspcar_sd
##    &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1 AUSTRIA          4.06         -6.12    -0.486          -8.85      0.0693
##  2 BELGIUM          3.92         -5.85    -0.326          -8.63      0.103 
##  3 CANADA           4.86         -5.58    -1.05           -8.08      0.0262
##  4 DENMARK          4.19         -5.76    -0.358          -8.58      0.158 
##  5 FRANCE           3.82         -5.87    -0.253          -8.45      0.0499
##  6 GERMANY          3.89         -5.85    -0.517          -8.51      0.0239
##  7 GREECE           4.88         -6.61    -0.0339        -10.8       0.255 
##  8 IRELAND          4.23         -6.44    -0.348          -9.04      0.0437
##  9 ITALY            3.73         -6.35    -0.152          -8.83      0.220 
## 10 JAPAN            4.70         -6.25    -0.287          -9.95      0.684 
## 11 NETHER…          4.08         -5.92    -0.370          -8.82      0.286 
## 12 NORWAY           4.11         -5.75    -0.278          -8.77      0.123 
## 13 SPAIN            4.06         -5.63     0.739          -9.90      0.317 
## 14 SWEDEN           4.01         -7.82    -2.71           -8.25      0.0364
## 15 SWITZE…          4.24         -5.93    -0.902          -8.54      0.102 
## 16 TURKEY           5.77         -7.34    -0.422         -12.5       0.329 
## 17 U.K.             3.98         -6.02    -0.459          -8.55      0.0479
## 18 U.S.A.           4.82         -5.45    -1.21           -7.78      0.0219
## # ... with 11 more variables: lincomep_sd &lt;dbl&gt;, lrpmg_sd &lt;dbl&gt;,
## #   lcarpcap_sd &lt;dbl&gt;, lgaspcar_max &lt;dbl&gt;, lincomep_max &lt;dbl&gt;,
## #   lrpmg_max &lt;dbl&gt;, lcarpcap_max &lt;dbl&gt;, lgaspcar_min &lt;dbl&gt;,
## #   lincomep_min &lt;dbl&gt;, lrpmg_min &lt;dbl&gt;, lcarpcap_min &lt;dbl&gt;</code></pre>
<p>But maybe you’re just interested in descriptive statistics for some variables, but not all those
that start with “l”? What if you want to use another pattern? Easy to do with the <code>contains()</code>
helper:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" title="3"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(dplyr<span class="op">::</span><span class="kw">contains</span>(<span class="st">&quot;car&quot;</span>)), <span class="kw">funs</span>(mean, sd, max, min))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 9
##    country lgaspcar_mean lcarpcap_mean lgaspcar_sd lcarpcap_sd lgaspcar_max
##    &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 AUSTRIA          4.06         -8.85      0.0693       0.473         4.20
##  2 BELGIUM          3.92         -8.63      0.103        0.417         4.16
##  3 CANADA           4.86         -8.08      0.0262       0.195         4.90
##  4 DENMARK          4.19         -8.58      0.158        0.349         4.50
##  5 FRANCE           3.82         -8.45      0.0499       0.344         3.91
##  6 GERMANY          3.89         -8.51      0.0239       0.406         3.93
##  7 GREECE           4.88        -10.8       0.255        0.839         5.38
##  8 IRELAND          4.23         -9.04      0.0437       0.345         4.33
##  9 ITALY            3.73         -8.83      0.220        0.639         4.05
## 10 JAPAN            4.70         -9.95      0.684        1.20          6.00
## 11 NETHER…          4.08         -8.82      0.286        0.617         4.65
## 12 NORWAY           4.11         -8.77      0.123        0.438         4.44
## 13 SPAIN            4.06         -9.90      0.317        0.960         4.75
## 14 SWEDEN           4.01         -8.25      0.0364       0.242         4.07
## 15 SWITZE…          4.24         -8.54      0.102        0.378         4.44
## 16 TURKEY           5.77        -12.5       0.329        0.751         6.16
## 17 U.K.             3.98         -8.55      0.0479       0.281         4.10
## 18 U.S.A.           4.82         -7.78      0.0219       0.162         4.86
## # ... with 3 more variables: lcarpcap_max &lt;dbl&gt;, lgaspcar_min &lt;dbl&gt;,
## #   lcarpcap_min &lt;dbl&gt;</code></pre>
<p>I used <code>dplyr::contains()</code> instead of simply <code>contains()</code> because there’s also a
<code>purrr::contains()</code>. If you load <code>purrr</code> after <code>dplyr</code>, <code>contains()</code> will actually be
<code>purrr::contains()</code> and not <code>dplyr::contains()</code> which causes the above code to fail.</p>
<p>There’s also <code>summarise_if()</code>:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-3" title="3"><span class="st">  </span><span class="kw">summarise_if</span>(is.double, <span class="kw">funs</span>(mean, sd, min, max))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 17
##    country lgaspcar_mean lincomep_mean lrpmg_mean lcarpcap_mean lgaspcar_sd
##    &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1 AUSTRIA          4.06         -6.12    -0.486          -8.85      0.0693
##  2 BELGIUM          3.92         -5.85    -0.326          -8.63      0.103 
##  3 CANADA           4.86         -5.58    -1.05           -8.08      0.0262
##  4 DENMARK          4.19         -5.76    -0.358          -8.58      0.158 
##  5 FRANCE           3.82         -5.87    -0.253          -8.45      0.0499
##  6 GERMANY          3.89         -5.85    -0.517          -8.51      0.0239
##  7 GREECE           4.88         -6.61    -0.0339        -10.8       0.255 
##  8 IRELAND          4.23         -6.44    -0.348          -9.04      0.0437
##  9 ITALY            3.73         -6.35    -0.152          -8.83      0.220 
## 10 JAPAN            4.70         -6.25    -0.287          -9.95      0.684 
## 11 NETHER…          4.08         -5.92    -0.370          -8.82      0.286 
## 12 NORWAY           4.11         -5.75    -0.278          -8.77      0.123 
## 13 SPAIN            4.06         -5.63     0.739          -9.90      0.317 
## 14 SWEDEN           4.01         -7.82    -2.71           -8.25      0.0364
## 15 SWITZE…          4.24         -5.93    -0.902          -8.54      0.102 
## 16 TURKEY           5.77         -7.34    -0.422         -12.5       0.329 
## 17 U.K.             3.98         -6.02    -0.459          -8.55      0.0479
## 18 U.S.A.           4.82         -5.45    -1.21           -7.78      0.0219
## # ... with 11 more variables: lincomep_sd &lt;dbl&gt;, lrpmg_sd &lt;dbl&gt;,
## #   lcarpcap_sd &lt;dbl&gt;, lgaspcar_min &lt;dbl&gt;, lincomep_min &lt;dbl&gt;,
## #   lrpmg_min &lt;dbl&gt;, lcarpcap_min &lt;dbl&gt;, lgaspcar_max &lt;dbl&gt;,
## #   lincomep_max &lt;dbl&gt;, lrpmg_max &lt;dbl&gt;, lcarpcap_max &lt;dbl&gt;</code></pre>
<p>This allows you to summarise every column that contain real numbers (if you use <code>is.numeric()</code>
instead, <code>year</code> will also be summarised, which is not really interesting).</p>
<p>To go faster, you can also use <code>summarise_all()</code>:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-2" title="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-4" title="4"><span class="st">  </span><span class="kw">summarise_all</span>(<span class="kw">funs</span>(mean, sd, min, max))</a></code></pre></div>
<pre><code>## # A tibble: 18 x 17
##    country lgaspcar_mean lincomep_mean lrpmg_mean lcarpcap_mean lgaspcar_sd
##    &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1 AUSTRIA          4.06         -6.12    -0.486          -8.85      0.0693
##  2 BELGIUM          3.92         -5.85    -0.326          -8.63      0.103 
##  3 CANADA           4.86         -5.58    -1.05           -8.08      0.0262
##  4 DENMARK          4.19         -5.76    -0.358          -8.58      0.158 
##  5 FRANCE           3.82         -5.87    -0.253          -8.45      0.0499
##  6 GERMANY          3.89         -5.85    -0.517          -8.51      0.0239
##  7 GREECE           4.88         -6.61    -0.0339        -10.8       0.255 
##  8 IRELAND          4.23         -6.44    -0.348          -9.04      0.0437
##  9 ITALY            3.73         -6.35    -0.152          -8.83      0.220 
## 10 JAPAN            4.70         -6.25    -0.287          -9.95      0.684 
## 11 NETHER…          4.08         -5.92    -0.370          -8.82      0.286 
## 12 NORWAY           4.11         -5.75    -0.278          -8.77      0.123 
## 13 SPAIN            4.06         -5.63     0.739          -9.90      0.317 
## 14 SWEDEN           4.01         -7.82    -2.71           -8.25      0.0364
## 15 SWITZE…          4.24         -5.93    -0.902          -8.54      0.102 
## 16 TURKEY           5.77         -7.34    -0.422         -12.5       0.329 
## 17 U.K.             3.98         -6.02    -0.459          -8.55      0.0479
## 18 U.S.A.           4.82         -5.45    -1.21           -7.78      0.0219
## # ... with 11 more variables: lincomep_sd &lt;dbl&gt;, lrpmg_sd &lt;dbl&gt;,
## #   lcarpcap_sd &lt;dbl&gt;, lgaspcar_min &lt;dbl&gt;, lincomep_min &lt;dbl&gt;,
## #   lrpmg_min &lt;dbl&gt;, lcarpcap_min &lt;dbl&gt;, lgaspcar_max &lt;dbl&gt;,
## #   lincomep_max &lt;dbl&gt;, lrpmg_max &lt;dbl&gt;, lcarpcap_max &lt;dbl&gt;</code></pre>
<p>I removed the <code>year</code> variable because it’s not a variable for which we want to have descriptive
statistics.</p>
</div>
<div id="mutate_" class="section level3">
<h3><span class="header-section-number">5.5.5</span> mutate_()</h3>
<p><code>mutate()</code> and <code>transmute()</code> also come with scoped version:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-2" title="2"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, exp)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  year lgaspcar lincomep lrpmg  lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 AUSTRIA  1960     64.9  0.00154 0.716 0.0000573
##  2 AUSTRIA  1961     60.4  0.00162 0.704 0.0000671
##  3 AUSTRIA  1962     58.7  0.00165 0.684 0.0000781
##  4 AUSTRIA  1963     57.9  0.00171 0.661 0.0000876
##  5 AUSTRIA  1964     56.7  0.00180 0.641 0.0000973
##  6 AUSTRIA  1965     56.5  0.00185 0.608 0.000109 
##  7 AUSTRIA  1966     57.3  0.00193 0.627 0.000121 
##  8 AUSTRIA  1967     57.6  0.00196 0.603 0.000132 
##  9 AUSTRIA  1968     57.1  0.00202 0.593 0.000144 
## 10 AUSTRIA  1969     57.2  0.00213 0.572 0.000152 
## # ... with 332 more rows</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-2" title="2"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>)), exp)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  year lgaspcar lincomep lrpmg  lcarpcap
##    &lt;fct&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 AUSTRIA  1960     64.9  0.00154 0.716 0.0000573
##  2 AUSTRIA  1961     60.4  0.00162 0.704 0.0000671
##  3 AUSTRIA  1962     58.7  0.00165 0.684 0.0000781
##  4 AUSTRIA  1963     57.9  0.00171 0.661 0.0000876
##  5 AUSTRIA  1964     56.7  0.00180 0.641 0.0000973
##  6 AUSTRIA  1965     56.5  0.00185 0.608 0.000109 
##  7 AUSTRIA  1966     57.3  0.00193 0.627 0.000121 
##  8 AUSTRIA  1967     57.6  0.00196 0.603 0.000132 
##  9 AUSTRIA  1968     57.1  0.00202 0.593 0.000144 
## 10 AUSTRIA  1969     57.2  0.00213 0.572 0.000152 
## # ... with 332 more rows</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-2" title="2"><span class="st">  </span><span class="kw">mutate_all</span>(as.character)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country year  lgaspcar     lincomep     lrpmg        lcarpcap    
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;       
##  1 AUSTRIA 1960  4.173244195  -6.474277179 -0.334547613 -9.766839569
##  2 AUSTRIA 1961  4.1009891049 -6.426005835 -0.351327614 -9.608621845
##  3 AUSTRIA 1962  4.0731765511 -6.407308295 -0.379517692 -9.457256552
##  4 AUSTRIA 1963  4.0595091239 -6.370678539 -0.414251392 -9.343154947
##  5 AUSTRIA 1964  4.037688787  -6.322246805 -0.445335362 -9.237739346
##  6 AUSTRIA 1965  4.033983285  -6.294667914 -0.497060662 -9.123903477
##  7 AUSTRIA 1966  4.0475365589 -6.252545451 -0.466837731 -9.019822048
##  8 AUSTRIA 1967  4.0529106939 -6.234580709 -0.505883405 -8.934402537
##  9 AUSTRIA 1968  4.045507048  -6.206894403 -0.522412545 -8.847967407
## 10 AUSTRIA 1969  4.0463547891 -6.153139668 -0.559110514 -8.788686207
## # ... with 332 more rows</code></pre>
</div>
</div>
<div id="other-useful-tidyverse-functions" class="section level2">
<h2><span class="header-section-number">5.6</span> Other useful <code>{tidyverse}</code> functions</h2>
<div id="if_else-case_when-and-recode" class="section level3">
<h3><span class="header-section-number">5.6.1</span> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></h3>
<p>The two helper functions I use the most are probably <code>if_else()</code> and <code>case_when</code>. These two
functions, combined with <code>mutate()</code> make it easy to create a new variable conditonally on the
values of other variables. For instance, we might want to have a dummy that equals <code>1</code> if a country
in the European Union (to simplify, say as of 2017) and <code>0</code> if not. First let’s create a list of
countries that are in the EU:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1">eu_countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;austria&quot;</span>, <span class="st">&quot;belgium&quot;</span>, <span class="st">&quot;bulgaria&quot;</span>, <span class="st">&quot;croatia&quot;</span>, <span class="st">&quot;republic of cyprus&quot;</span>,</a>
<a class="sourceLine" id="cb143-2" title="2">                  <span class="st">&quot;czech republic&quot;</span>, <span class="st">&quot;denmark&quot;</span>, <span class="st">&quot;estonia&quot;</span>, <span class="st">&quot;finland&quot;</span>, <span class="st">&quot;france&quot;</span>, <span class="st">&quot;germany&quot;</span>,</a>
<a class="sourceLine" id="cb143-3" title="3">                  <span class="st">&quot;greece&quot;</span>, <span class="st">&quot;hungary&quot;</span>, <span class="st">&quot;ireland&quot;</span>, <span class="st">&quot;italy&quot;</span>, <span class="st">&quot;latvia&quot;</span>, <span class="st">&quot;lithuania&quot;</span>, <span class="st">&quot;luxembourg&quot;</span>,</a>
<a class="sourceLine" id="cb143-4" title="4">                  <span class="st">&quot;malta&quot;</span>, <span class="st">&quot;netherla&quot;</span>, <span class="st">&quot;poland&quot;</span>, <span class="st">&quot;portugal&quot;</span>, <span class="st">&quot;romania&quot;</span>, <span class="st">&quot;slovakia&quot;</span>, <span class="st">&quot;slovenia&quot;</span>,</a>
<a class="sourceLine" id="cb143-5" title="5">                  <span class="st">&quot;spain&quot;</span>, <span class="st">&quot;sweden&quot;</span>, <span class="st">&quot;u.k.&quot;</span>)</a></code></pre></div>
<p>I’ve had to change “netherlands” to “netherla” because that’s how the country is called in the
data. Now let’s create a dummy variable that equals <code>1</code> for EU countries, ind <code>0</code> for the others:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">tolower</span>(country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">in_eu =</span> <span class="kw">if_else</span>(country <span class="op">%in%</span><span class="st"> </span>eu_countries, <span class="dv">1</span>, <span class="dv">0</span>))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
##    country  year lgaspcar lincomep  lrpmg lcarpcap in_eu
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77     1
##  2 austria  1961     4.10    -6.43 -0.351    -9.61     1
##  3 austria  1962     4.07    -6.41 -0.380    -9.46     1
##  4 austria  1963     4.06    -6.37 -0.414    -9.34     1
##  5 austria  1964     4.04    -6.32 -0.445    -9.24     1
##  6 austria  1965     4.03    -6.29 -0.497    -9.12     1
##  7 austria  1966     4.05    -6.25 -0.467    -9.02     1
##  8 austria  1967     4.05    -6.23 -0.506    -8.93     1
##  9 austria  1968     4.05    -6.21 -0.522    -8.85     1
## 10 austria  1969     4.05    -6.15 -0.559    -8.79     1
## # ... with 332 more rows</code></pre>
<p>Instead of <code>1</code> and <code>0</code>, we can of course use strings (I add <code>filter(year == 1960)</code> at the end to
have a better view of what happened):</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">tolower</span>(country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">in_eu =</span> <span class="kw">if_else</span>(country <span class="op">%in%</span><span class="st"> </span>eu_countries, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-4" title="4"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1960</span>)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 7
##    country   year lgaspcar lincomep   lrpmg lcarpcap in_eu
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
##  1 austria   1960     4.17    -6.47 -0.335     -9.77 yes  
##  2 belgium   1960     4.16    -6.22 -0.166     -9.41 yes  
##  3 canada    1960     4.86    -5.89 -0.972     -8.38 no   
##  4 denmark   1960     4.50    -6.06 -0.196     -9.33 yes  
##  5 france    1960     3.91    -6.26 -0.0196    -9.15 yes  
##  6 germany   1960     3.92    -6.16 -0.186     -9.34 yes  
##  7 greece    1960     5.04    -7.16 -0.0835   -12.2  yes  
##  8 ireland   1960     4.27    -6.72 -0.0765    -9.70 yes  
##  9 italy     1960     4.05    -6.73  0.165    -10.1  yes  
## 10 japan     1960     6.00    -6.99 -0.145    -12.2  no   
## 11 netherla  1960     4.65    -6.22 -0.201    -10.00 yes  
## 12 norway    1960     4.44    -6.09 -0.140     -9.68 no   
## 13 spain     1960     4.75    -6.17  1.13     -11.6  yes  
## 14 sweden    1960     4.06    -8.07 -2.52      -8.74 yes  
## 15 switzerl  1960     4.40    -6.16 -0.823     -9.26 no   
## 16 turkey    1960     6.13    -7.80 -0.253    -13.5  no   
## 17 u.k.      1960     4.10    -6.19 -0.391     -9.12 yes  
## 18 u.s.a.    1960     4.82    -5.70 -1.12      -8.02 no</code></pre>
<p>I think that <code>if_else()</code> is fairly straightforward, especially if you know <code>ifelse()</code> already. You
might be wondering what is the difference between these two. <code>if_else()</code> is stricter than
<code>ifelse()</code> and does not do type conversion. Compare the two next lines:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="kw">ifelse</span>(<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;0&quot;</span>, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="kw">if_else</span>(<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;0&quot;</span>, <span class="dv">1</span>)</a></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1">Error<span class="op">:</span><span class="st"> `</span><span class="dt">false</span><span class="st">`</span> must be type string, not double</a></code></pre></div>
<p>Type conversion, especially without a warning is very dangerous. <code>if_else()</code>’s behaviour which
consists in failing as soon as possble avoids a lot of pain and suffering, especially when
programming non-interactively.</p>
<p><code>if_else()</code> also accepts an optional argument, that allows you to specify what should be returned
in case of <code>NA</code>:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1"><span class="kw">if_else</span>(<span class="dv">1</span> <span class="op">&lt;=</span><span class="st"> </span><span class="ot">NA</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">999</span>)</a></code></pre></div>
<pre><code>## [1] 999</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="co"># Or</span></a>
<a class="sourceLine" id="cb154-2" title="2"><span class="kw">if_else</span>(<span class="dv">1</span> <span class="op">&lt;=</span><span class="st"> </span><span class="ot">NA</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="ot">NA_real_</span>)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p><code>case_when()</code> can be seen as a generalization of <code>if_else()</code>. Whenever you want to use multiple
<code>if_else()</code>s, that’s when you know you should use <code>case_when()</code> (I’m adding the filter at the end
for the same reason as before, to see the output better):</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">tolower</span>(country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb156-4" title="4">           country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;france&quot;</span>, <span class="st">&quot;italy&quot;</span>, <span class="st">&quot;turkey&quot;</span>, <span class="st">&quot;greece&quot;</span>, <span class="st">&quot;spain&quot;</span>) <span class="op">~</span><span class="st"> &quot;mediterranean&quot;</span>,</a>
<a class="sourceLine" id="cb156-5" title="5">           country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;germany&quot;</span>, <span class="st">&quot;austria&quot;</span>, <span class="st">&quot;switzerl&quot;</span>, <span class="st">&quot;belgium&quot;</span>, <span class="st">&quot;netherla&quot;</span>) <span class="op">~</span><span class="st"> &quot;central europe&quot;</span>,</a>
<a class="sourceLine" id="cb156-6" title="6">           country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;canada&quot;</span>, <span class="st">&quot;u.s.a.&quot;</span>, <span class="st">&quot;u.k.&quot;</span>, <span class="st">&quot;ireland&quot;</span>) <span class="op">~</span><span class="st"> &quot;anglosphere&quot;</span>,</a>
<a class="sourceLine" id="cb156-7" title="7">           country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;denmark&quot;</span>, <span class="st">&quot;norway&quot;</span>, <span class="st">&quot;sweden&quot;</span>) <span class="op">~</span><span class="st"> &quot;nordic&quot;</span>,</a>
<a class="sourceLine" id="cb156-8" title="8">           country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;japan&quot;</span>) <span class="op">~</span><span class="st"> &quot;asia&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-9" title="9"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1960</span>)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 7
##    country   year lgaspcar lincomep   lrpmg lcarpcap region        
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         
##  1 austria   1960     4.17    -6.47 -0.335     -9.77 central europe
##  2 belgium   1960     4.16    -6.22 -0.166     -9.41 central europe
##  3 canada    1960     4.86    -5.89 -0.972     -8.38 anglosphere   
##  4 denmark   1960     4.50    -6.06 -0.196     -9.33 nordic        
##  5 france    1960     3.91    -6.26 -0.0196    -9.15 mediterranean 
##  6 germany   1960     3.92    -6.16 -0.186     -9.34 central europe
##  7 greece    1960     5.04    -7.16 -0.0835   -12.2  mediterranean 
##  8 ireland   1960     4.27    -6.72 -0.0765    -9.70 anglosphere   
##  9 italy     1960     4.05    -6.73  0.165    -10.1  mediterranean 
## 10 japan     1960     6.00    -6.99 -0.145    -12.2  asia          
## 11 netherla  1960     4.65    -6.22 -0.201    -10.00 central europe
## 12 norway    1960     4.44    -6.09 -0.140     -9.68 nordic        
## 13 spain     1960     4.75    -6.17  1.13     -11.6  mediterranean 
## 14 sweden    1960     4.06    -8.07 -2.52      -8.74 nordic        
## 15 switzerl  1960     4.40    -6.16 -0.823     -9.26 central europe
## 16 turkey    1960     6.13    -7.80 -0.253    -13.5  mediterranean 
## 17 u.k.      1960     4.10    -6.19 -0.391     -9.12 anglosphere   
## 18 u.s.a.    1960     4.82    -5.70 -1.12      -8.02 anglosphere</code></pre>
<p>If all you want is to recode values, you can use <code>recode()</code>. For example, the Netherlands is written as
“NETHERLA” in the which is quite ugly. Same for Switzerland:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1">gasoline &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">tolower</span>(country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">recode</span>(country, <span class="st">&quot;netherla&quot;</span> =<span class="st"> &quot;netherlands&quot;</span>, <span class="st">&quot;switzerl&quot;</span> =<span class="st"> &quot;switzerland&quot;</span>))</a></code></pre></div>
<p>I saved the data with these changes as they will become useful in the future. Let’s take a look at
the data:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-2" title="2"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;netherlands&quot;</span>, <span class="st">&quot;switzerland&quot;</span>), year <span class="op">==</span><span class="st"> </span><span class="dv">1960</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   country      year lgaspcar lincomep  lrpmg lcarpcap
##   &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1 netherlands  1960     4.65    -6.22 -0.201   -10.00
## 2 switzerland  1960     4.40    -6.16 -0.823    -9.26</code></pre>
</div>
<div id="lead-and-lag" class="section level3">
<h3><span class="header-section-number">5.6.2</span> <code>lead()</code> and <code>lag()</code></h3>
<p><code>lead()</code> and <code>lag()</code> are especially useful in econometrics. When I was doing my masters, in 4 B.d.
(<em>Before dplyr</em>) lagging variables in panel data was quite tricky. Now, with <code>dplyr</code> it’s really
very easy:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_lgaspcar =</span> <span class="kw">lag</span>(lgaspcar)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lead_lgaspcar =</span> <span class="kw">lead</span>(lgaspcar)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-5" title="5"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>))</a></code></pre></div>
<pre><code>## # A tibble: 72 x 8
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap lag_lgaspcar
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77        NA   
##  2 austria  1961     4.10    -6.43 -0.351    -9.61         4.17
##  3 austria  1962     4.07    -6.41 -0.380    -9.46         4.10
##  4 austria  1963     4.06    -6.37 -0.414    -9.34         4.07
##  5 belgium  1960     4.16    -6.22 -0.166    -9.41        NA   
##  6 belgium  1961     4.12    -6.18 -0.172    -9.30         4.16
##  7 belgium  1962     4.08    -6.13 -0.222    -9.22         4.12
##  8 belgium  1963     4.00    -6.09 -0.250    -9.11         4.08
##  9 canada   1960     4.86    -5.89 -0.972    -8.38        NA   
## 10 canada   1961     4.83    -5.88 -0.972    -8.35         4.86
## # ... with 62 more rows, and 1 more variable: lead_lgaspcar &lt;dbl&gt;</code></pre>
<p>To lag every variable, remember that you can use <code>mutate_if()</code>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-3" title="3"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, lag) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-4" title="4"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>))</a></code></pre></div>
<pre><code>## # A tibble: 72 x 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep   lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960    NA       NA     NA        NA   
##  2 austria  1961     4.17    -6.47  -0.335    -9.77
##  3 austria  1962     4.10    -6.43  -0.351    -9.61
##  4 austria  1963     4.07    -6.41  -0.380    -9.46
##  5 belgium  1960    NA       NA     NA        NA   
##  6 belgium  1961     4.16    -6.22  -0.166    -9.41
##  7 belgium  1962     4.12    -6.18  -0.172    -9.30
##  8 belgium  1963     4.08    -6.13  -0.222    -9.22
##  9 canada   1960    NA       NA     NA        NA   
## 10 canada   1961     4.86    -5.89  -0.972    -8.38
## # ... with 62 more rows</code></pre>
<p>you can replace <code>lag()</code> with <code>lead()</code>, but just keep in mind that the columns get transformed in
place.</p>
</div>
<div id="ntile" class="section level3">
<h3><span class="header-section-number">5.6.3</span> <code>ntile()</code></h3>
<p>The last helper function I will discuss is <code>ntile()</code>. There are some other, so do read <code>mutate()</code>’s
documentation with <code>help(mutate)</code>!</p>
<p>If you need quantiles, you need <code>ntile()</code>. Let’s see how it works:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">quintile =</span> <span class="kw">ntile</span>(lgaspcar, <span class="dv">5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile =</span> <span class="kw">ntile</span>(lgaspcar, <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-4" title="4"><span class="st">  </span><span class="kw">select</span>(country, year, lgaspcar, quintile, decile)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 5
##    country  year lgaspcar quintile decile
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;  &lt;int&gt;
##  1 austria  1960     4.17        3      6
##  2 austria  1961     4.10        3      6
##  3 austria  1962     4.07        3      5
##  4 austria  1963     4.06        3      5
##  5 austria  1964     4.04        3      5
##  6 austria  1965     4.03        3      5
##  7 austria  1966     4.05        3      5
##  8 austria  1967     4.05        3      5
##  9 austria  1968     4.05        3      5
## 10 austria  1969     4.05        3      5
## # ... with 332 more rows</code></pre>
<p><code>quintile</code> and <code>decile</code> do not hold the values but the quantile the value lies in. If you want to
have a column that contains the median for instance, you can use good ol’ <code>quantile()</code>:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">median =</span> <span class="kw">quantile</span>(lgaspcar, <span class="fl">0.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># quantile(x, 0.5) is equivalent to median(x)</span></a>
<a class="sourceLine" id="cb167-4" title="4"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1960</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-5" title="5"><span class="st">  </span><span class="kw">select</span>(country, year, median)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 3
## # Groups:   country [18]
##    country      year median
##    &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt;
##  1 austria      1960   4.05
##  2 belgium      1960   3.88
##  3 canada       1960   4.86
##  4 denmark      1960   4.16
##  5 france       1960   3.81
##  6 germany      1960   3.89
##  7 greece       1960   4.89
##  8 ireland      1960   4.22
##  9 italy        1960   3.74
## 10 japan        1960   4.52
## 11 netherlands  1960   3.99
## 12 norway       1960   4.08
## 13 spain        1960   3.99
## 14 sweden       1960   4.00
## 15 switzerland  1960   4.26
## 16 turkey       1960   5.72
## 17 u.k.         1960   3.98
## 18 u.s.a.       1960   4.81</code></pre>
</div>
<div id="arrange" class="section level3">
<h3><span class="header-section-number">5.6.4</span> <code>arrange()</code></h3>
<p><code>arrange()</code> re-orders the whole <code>tibble</code> according to values of the supplied variable:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb169-2" title="2"><span class="st">  </span><span class="kw">arrange</span>(lgaspcar)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  year lgaspcar lincomep   lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 italy    1977     3.38    -6.10  0.164     -8.15
##  2 italy    1978     3.39    -6.08  0.0348    -8.11
##  3 italy    1976     3.43    -6.12  0.103     -8.17
##  4 italy    1974     3.50    -6.13 -0.223     -8.26
##  5 italy    1975     3.52    -6.17 -0.0327    -8.22
##  6 spain    1978     3.62    -5.29  0.621     -8.63
##  7 italy    1972     3.63    -6.21 -0.215     -8.38
##  8 italy    1971     3.65    -6.22 -0.148     -8.47
##  9 spain    1977     3.65    -5.30  0.526     -8.73
## 10 italy    1973     3.65    -6.16 -0.325     -8.32
## # ... with 332 more rows</code></pre>
<p>If you want to re-order the <code>tibble</code> in descending order of the variable:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb171-2" title="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lgaspcar))</a></code></pre></div>
<pre><code>## # A tibble: 342 x 6
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 turkey   1966     6.16    -7.51 -0.356    -13.0
##  2 turkey   1960     6.13    -7.80 -0.253    -13.5
##  3 turkey   1961     6.11    -7.79 -0.343    -13.4
##  4 turkey   1962     6.08    -7.84 -0.408    -13.2
##  5 turkey   1968     6.08    -7.42 -0.365    -12.8
##  6 turkey   1963     6.08    -7.63 -0.225    -13.3
##  7 turkey   1964     6.06    -7.63 -0.252    -13.2
##  8 turkey   1967     6.04    -7.46 -0.335    -12.8
##  9 japan    1960     6.00    -6.99 -0.145    -12.2
## 10 turkey   1965     5.82    -7.62 -0.293    -12.9
## # ... with 332 more rows</code></pre>
<p><code>arrange</code>’s documentation alerts the user that re-ording by group is only possible by explicitely
specifying an option:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-2" title="2"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">1960</span>, <span class="dv">1963</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lgaspcar), <span class="dt">.by_group =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 72 x 6
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77
##  2 austria  1961     4.10    -6.43 -0.351    -9.61
##  3 austria  1962     4.07    -6.41 -0.380    -9.46
##  4 austria  1963     4.06    -6.37 -0.414    -9.34
##  5 belgium  1960     4.16    -6.22 -0.166    -9.41
##  6 belgium  1961     4.12    -6.18 -0.172    -9.30
##  7 belgium  1962     4.08    -6.13 -0.222    -9.22
##  8 belgium  1963     4.00    -6.09 -0.250    -9.11
##  9 canada   1960     4.86    -5.89 -0.972    -8.38
## 10 canada   1962     4.85    -5.84 -0.979    -8.32
## # ... with 62 more rows</code></pre>
</div>
<div id="tally-and-count" class="section level3">
<h3><span class="header-section-number">5.6.5</span> <code>tally()</code> and <code>count()</code></h3>
<p><code>tally()</code> and <code>count()</code> count the number of observations in your data. I believe <code>count()</code> is the
more useful of the two, as it counts the number of observations within a group that you can provide:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb175-2" title="2"><span class="st">  </span><span class="kw">count</span>(country)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##    country         n
##    &lt;chr&gt;       &lt;int&gt;
##  1 austria        19
##  2 belgium        19
##  3 canada         19
##  4 denmark        19
##  5 france         19
##  6 germany        19
##  7 greece         19
##  8 ireland        19
##  9 italy          19
## 10 japan          19
## 11 netherlands    19
## 12 norway         19
## 13 spain          19
## 14 sweden         19
## 15 switzerland    19
## 16 turkey         19
## 17 u.k.           19
## 18 u.s.a.         19</code></pre>
<p>There’s also <code>add_count()</code> which adds the column to the data:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb177-2" title="2"><span class="st">  </span><span class="kw">add_count</span>(country)</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
##    country  year lgaspcar lincomep  lrpmg lcarpcap     n
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # ... with 332 more rows</code></pre>
<p><code>add_count()</code> is a shortcut for the following code:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1">gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb179-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb179-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 342 x 7
## # Groups:   country [18]
##    country  year lgaspcar lincomep  lrpmg lcarpcap     n
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 austria  1960     4.17    -6.47 -0.335    -9.77    19
##  2 austria  1961     4.10    -6.43 -0.351    -9.61    19
##  3 austria  1962     4.07    -6.41 -0.380    -9.46    19
##  4 austria  1963     4.06    -6.37 -0.414    -9.34    19
##  5 austria  1964     4.04    -6.32 -0.445    -9.24    19
##  6 austria  1965     4.03    -6.29 -0.497    -9.12    19
##  7 austria  1966     4.05    -6.25 -0.467    -9.02    19
##  8 austria  1967     4.05    -6.23 -0.506    -8.93    19
##  9 austria  1968     4.05    -6.21 -0.522    -8.85    19
## 10 austria  1969     4.05    -6.15 -0.559    -8.79    19
## # ... with 332 more rows</code></pre>
<p>where <code>n()</code> is a <code>dplyr</code> function that can only be used within <code>summarise()</code>, <code>mutate()</code> and
<code>filter()</code>.</p>
</div>
</div>
<div id="joining-tibbles-with-full_join-left_join-right_join-and-all-the-others" class="section level2">
<h2><span class="header-section-number">5.7</span> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</h2>
<p>I will end this section on <code>dplyr</code> with the very useful verbs: the <code>*_join()</code> verbs. Let’s first
start by loading another dataset from the <code>plm</code> package. <code>SumHes</code> and let’s convert it to <code>tibble</code>
and rename it:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" title="1"><span class="kw">data</span>(SumHes, <span class="dt">package =</span> <span class="st">&quot;plm&quot;</span>)</a>
<a class="sourceLine" id="cb181-2" title="2"></a>
<a class="sourceLine" id="cb181-3" title="3">pwt &lt;-<span class="st"> </span>SumHes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-4" title="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb181-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">tolower</span>(country))</a></code></pre></div>
<p>Let’s take a quick look at the data:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1"><span class="kw">glimpse</span>(pwt)</a></code></pre></div>
<pre><code>## Observations: 3,250
## Variables: 7
## $ year    &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, ...
## $ country &lt;chr&gt; &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;, &quot;algeria&quot;,...
## $ opec    &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ com     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ pop     &lt;int&gt; 10800, 11016, 11236, 11460, 11690, 11923, 12267, 12622...
## $ gdp     &lt;int&gt; 1723, 1599, 1275, 1517, 1589, 1584, 1548, 1600, 1758, ...
## $ sr      &lt;dbl&gt; 19.9, 21.1, 15.0, 13.9, 10.6, 11.0, 8.3, 11.3, 15.1, 1...</code></pre>
<p>We can merge both <code>gasoline</code> and <code>pwt</code> by country and year, as these two variables are common to
both datasets. There are more countries and years in the <code>pwt</code> dataset, so when merging both, and
depending on which function you use, you will either have <code>NA</code>’s for the variables where there is
no match, or rows that will be dropped. Let’s start with <code>full_join</code>:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1">gas_pwt_full &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-2" title="2"><span class="st">  </span><span class="kw">full_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a></code></pre></div>
<p>Let’s see which countries and years are included:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" title="1">gas_pwt_full <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb185-2" title="2"><span class="st">  </span><span class="kw">count</span>(country, year)</a></code></pre></div>
<pre><code>## # A tibble: 3,269 x 3
##    country  year     n
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt;
##  1 algeria  1960     1
##  2 algeria  1961     1
##  3 algeria  1962     1
##  4 algeria  1963     1
##  5 algeria  1964     1
##  6 algeria  1965     1
##  7 algeria  1966     1
##  8 algeria  1967     1
##  9 algeria  1968     1
## 10 algeria  1969     1
## # ... with 3,259 more rows</code></pre>
<p>As you see, every country and year was included, but what happened for, say, the U.S.S.R? This country
is in <code>pwt</code> but not in <code>gasoline</code> at all:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1">gas_pwt_full <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-2" title="2"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;u.s.s.r.&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 26 x 11
##    country  year lgaspcar lincomep lrpmg lcarpcap opec  com      pop   gdp
##    &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;int&gt; &lt;int&gt;
##  1 u.s.s.…  1960       NA       NA    NA       NA no    yes   214400  2397
##  2 u.s.s.…  1961       NA       NA    NA       NA no    yes   217896  2542
##  3 u.s.s.…  1962       NA       NA    NA       NA no    yes   221449  2656
##  4 u.s.s.…  1963       NA       NA    NA       NA no    yes   225060  2681
##  5 u.s.s.…  1964       NA       NA    NA       NA no    yes   227571  2854
##  6 u.s.s.…  1965       NA       NA    NA       NA no    yes   230109  3049
##  7 u.s.s.…  1966       NA       NA    NA       NA no    yes   232676  3247
##  8 u.s.s.…  1967       NA       NA    NA       NA no    yes   235272  3454
##  9 u.s.s.…  1968       NA       NA    NA       NA no    yes   237896  3730
## 10 u.s.s.…  1969       NA       NA    NA       NA no    yes   240550  3808
## # ... with 16 more rows, and 1 more variable: sr &lt;dbl&gt;</code></pre>
<p>As you probably guessed, the variables from <code>gasoline</code> that are not included in <code>pwt</code> are filled with
<code>NA</code>s. One could remove all these lines and only keep countries for which these variables are not
<code>NA</code> everywhere with <code>filter()</code>, but there is a simpler solution:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1">gas_pwt_inner &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-2" title="2"><span class="st">  </span><span class="kw">inner_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a></code></pre></div>
<p>Let’s use the <code>tabyl()</code> from the <code>janitor</code> packages which is a very nice alternative to the <code>table()</code>
function from base R:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb190-2" title="2"></a>
<a class="sourceLine" id="cb190-3" title="3">gas_pwt_inner <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-4" title="4"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##      country  n    percent
##      austria 19 0.05882353
##      belgium 19 0.05882353
##       canada 19 0.05882353
##      denmark 19 0.05882353
##       france 19 0.05882353
##       greece 19 0.05882353
##      ireland 19 0.05882353
##        italy 19 0.05882353
##        japan 19 0.05882353
##  netherlands 19 0.05882353
##       norway 19 0.05882353
##        spain 19 0.05882353
##       sweden 19 0.05882353
##  switzerland 19 0.05882353
##       turkey 19 0.05882353
##         u.k. 19 0.05882353
##       u.s.a. 19 0.05882353</code></pre>
<p>Only countries with values in both datasets were returned. It’s almost every country from <code>gasoline</code>,
apart from Germany (called “germany west” in <code>pwt</code> and “germany” in <code>gasoline</code>. I left it as is to
provide an example of a country not in <code>pwt</code>). Let’s also look at the variables:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" title="1"><span class="kw">glimpse</span>(gas_pwt_inner)</a></code></pre></div>
<pre><code>## Observations: 323
## Variables: 11
## $ country  &lt;chr&gt; &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;...
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968,...
## $ lgaspcar &lt;dbl&gt; 4.173244, 4.100989, 4.073177, 4.059509, 4.037689, 4.0...
## $ lincomep &lt;dbl&gt; -6.474277, -6.426006, -6.407308, -6.370679, -6.322247...
## $ lrpmg    &lt;dbl&gt; -0.3345476, -0.3513276, -0.3795177, -0.4142514, -0.44...
## $ lcarpcap &lt;dbl&gt; -9.766840, -9.608622, -9.457257, -9.343155, -9.237739...
## $ opec     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, n...
## $ com      &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, n...
## $ pop      &lt;int&gt; 7048, 7087, 7130, 7172, 7215, 7255, 7308, 7338, 7362,...
## $ gdp      &lt;int&gt; 5143, 5388, 5481, 5688, 5978, 6144, 6437, 6596, 6847,...
## $ sr       &lt;dbl&gt; 24.3, 24.5, 23.3, 22.9, 25.2, 25.2, 26.7, 25.6, 25.7,...</code></pre>
<p>The variables from both datasets are in the joined data.</p>
<p>Contrast this to <code>semi_join()</code>:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1">gas_pwt_semi &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-2" title="2"><span class="st">  </span><span class="kw">semi_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb194-3" title="3"></a>
<a class="sourceLine" id="cb194-4" title="4"><span class="kw">glimpse</span>(gas_pwt_semi)</a></code></pre></div>
<pre><code>## Observations: 323
## Variables: 6
## $ country  &lt;chr&gt; &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;, &quot;austria&quot;...
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968,...
## $ lgaspcar &lt;dbl&gt; 4.173244, 4.100989, 4.073177, 4.059509, 4.037689, 4.0...
## $ lincomep &lt;dbl&gt; -6.474277, -6.426006, -6.407308, -6.370679, -6.322247...
## $ lrpmg    &lt;dbl&gt; -0.3345476, -0.3513276, -0.3795177, -0.4142514, -0.44...
## $ lcarpcap &lt;dbl&gt; -9.766840, -9.608622, -9.457257, -9.343155, -9.237739...</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" title="1">gas_pwt_semi <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb196-2" title="2"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##      country  n    percent
##      austria 19 0.05882353
##      belgium 19 0.05882353
##       canada 19 0.05882353
##      denmark 19 0.05882353
##       france 19 0.05882353
##       greece 19 0.05882353
##      ireland 19 0.05882353
##        italy 19 0.05882353
##        japan 19 0.05882353
##  netherlands 19 0.05882353
##       norway 19 0.05882353
##        spain 19 0.05882353
##       sweden 19 0.05882353
##  switzerland 19 0.05882353
##       turkey 19 0.05882353
##         u.k. 19 0.05882353
##       u.s.a. 19 0.05882353</code></pre>
<p>Only columns of <code>gasoline</code> are returned, and only rows of <code>gasoline</code> that were matched with rows
from <code>pwt</code>. <code>semi_join()</code> is not a commutative operation:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1">pwt_gas_semi &lt;-<span class="st"> </span>pwt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-2" title="2"><span class="st">  </span><span class="kw">semi_join</span>(gasoline, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb198-3" title="3"></a>
<a class="sourceLine" id="cb198-4" title="4"><span class="kw">glimpse</span>(pwt_gas_semi)</a></code></pre></div>
<pre><code>## Observations: 323
## Variables: 7
## $ year    &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, ...
## $ country &lt;chr&gt; &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;canada&quot;, &quot;can...
## $ opec    &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ com     &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no...
## $ pop     &lt;int&gt; 17910, 18270, 18614, 18963, 19326, 19678, 20049, 20411...
## $ gdp     &lt;int&gt; 7258, 7261, 7605, 7876, 8244, 8664, 9093, 9231, 9582, ...
## $ sr      &lt;dbl&gt; 22.7, 21.5, 22.1, 21.9, 22.9, 24.8, 25.4, 23.1, 22.6, ...</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1">gas_pwt_semi <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-2" title="2"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##      country  n    percent
##      austria 19 0.05882353
##      belgium 19 0.05882353
##       canada 19 0.05882353
##      denmark 19 0.05882353
##       france 19 0.05882353
##       greece 19 0.05882353
##      ireland 19 0.05882353
##        italy 19 0.05882353
##        japan 19 0.05882353
##  netherlands 19 0.05882353
##       norway 19 0.05882353
##        spain 19 0.05882353
##       sweden 19 0.05882353
##  switzerland 19 0.05882353
##       turkey 19 0.05882353
##         u.k. 19 0.05882353
##       u.s.a. 19 0.05882353</code></pre>
<p>The rows are the same, but not the columns.</p>
<p><code>left_join()</code> and <code>right_join()</code> return
all the rows from either the dataset that is on the “left” (the first argument of the fonction)
or on the “right” (the second argument of the function) but all columns from both datasets. So
depending on which countries you’re interested in, you’re going to use either one of these functions:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1">gas_pwt_left &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-2" title="2"><span class="st">  </span><span class="kw">left_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb202-3" title="3"></a>
<a class="sourceLine" id="cb202-4" title="4">gas_pwt_left <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-5" title="5"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##      country  n    percent
##      austria 19 0.05555556
##      belgium 19 0.05555556
##       canada 19 0.05555556
##      denmark 19 0.05555556
##       france 19 0.05555556
##      germany 19 0.05555556
##       greece 19 0.05555556
##      ireland 19 0.05555556
##        italy 19 0.05555556
##        japan 19 0.05555556
##  netherlands 19 0.05555556
##       norway 19 0.05555556
##        spain 19 0.05555556
##       sweden 19 0.05555556
##  switzerland 19 0.05555556
##       turkey 19 0.05555556
##         u.k. 19 0.05555556
##       u.s.a. 19 0.05555556</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1">gas_pwt_right &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-2" title="2"><span class="st">  </span><span class="kw">right_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb204-3" title="3"></a>
<a class="sourceLine" id="cb204-4" title="4">gas_pwt_right <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-5" title="5"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##          country  n percent
##          algeria 26   0.008
##           angola 26   0.008
##        argentina 26   0.008
##        australia 26   0.008
##          austria 26   0.008
##       bangladesh 26   0.008
##         barbados 26   0.008
##          belgium 26   0.008
##            benin 26   0.008
##          bolivia 26   0.008
##         botswana 26   0.008
##           brazil 26   0.008
##     burkina faso 26   0.008
##          burundi 26   0.008
##         cameroon 26   0.008
##           canada 26   0.008
##   cape verde is. 26   0.008
##   central afr.r. 26   0.008
##             chad 26   0.008
##            chile 26   0.008
##            china 26   0.008
##         colombia 26   0.008
##          comoros 26   0.008
##            congo 26   0.008
##       costa rica 26   0.008
##           cyprus 26   0.008
##   czechoslovakia 26   0.008
##          denmark 26   0.008
##   dominican rep. 26   0.008
##          ecuador 26   0.008
##            egypt 26   0.008
##      el salvador 26   0.008
##         ethiopia 26   0.008
##             fiji 26   0.008
##          finland 26   0.008
##           france 26   0.008
##            gabon 26   0.008
##           gambia 26   0.008
##     germany west 26   0.008
##            ghana 26   0.008
##           greece 26   0.008
##        guatemala 26   0.008
##           guinea 26   0.008
##      guinea-biss 26   0.008
##           guyana 26   0.008
##            haiti 26   0.008
##         honduras 26   0.008
##        hong kong 26   0.008
##          iceland 26   0.008
##            india 26   0.008
##        indonesia 26   0.008
##             iran 26   0.008
##             iraq 26   0.008
##          ireland 26   0.008
##           israel 26   0.008
##            italy 26   0.008
##      ivory coast 26   0.008
##          jamaica 26   0.008
##            japan 26   0.008
##           jordan 26   0.008
##            kenya 26   0.008
##            korea 26   0.008
##          lesotho 26   0.008
##          liberia 26   0.008
##       luxembourg 26   0.008
##       madagascar 26   0.008
##           malawi 26   0.008
##         malaysia 26   0.008
##             mali 26   0.008
##            malta 26   0.008
##       mauritania 26   0.008
##        mauritius 26   0.008
##           mexico 26   0.008
##          morocco 26   0.008
##       mozambique 26   0.008
##          myanmar 26   0.008
##          namibia 26   0.008
##            nepal 26   0.008
##      netherlands 26   0.008
##      new zealand 26   0.008
##        nicaragua 26   0.008
##            niger 26   0.008
##          nigeria 26   0.008
##           norway 26   0.008
##         pakistan 26   0.008
##           panama 26   0.008
##  papua n.guinea  26   0.008
##         paraguay 26   0.008
##             peru 26   0.008
##      philippines 26   0.008
##         portugal 26   0.008
##      puerto rico 26   0.008
##          reunion 26   0.008
##          romania 26   0.008
##           rwanda 26   0.008
##     saudi arabia 26   0.008
##          senegal 26   0.008
##       seychelles 26   0.008
##        singapore 26   0.008
##          somalia 26   0.008
##     south africa 26   0.008
##            spain 26   0.008
##        sri lanka 26   0.008
##         suriname 26   0.008
##        swaziland 26   0.008
##           sweden 26   0.008
##      switzerland 26   0.008
##            syria 26   0.008
##           taiwan 26   0.008
##         tanzania 26   0.008
##         thailand 26   0.008
##             togo 26   0.008
##  trinidad&amp;tobago 26   0.008
##          tunisia 26   0.008
##           turkey 26   0.008
##             u.k. 26   0.008
##           u.s.a. 26   0.008
##         u.s.s.r. 26   0.008
##           uganda 26   0.008
##          uruguay 26   0.008
##        venezuela 26   0.008
##       yugoslavia 26   0.008
##            zaire 26   0.008
##           zambia 26   0.008
##         zimbabwe 26   0.008</code></pre>
<p>The last merge function is <code>anti_join()</code>:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1">gas_pwt_anti &lt;-<span class="st"> </span>gasoline <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb206-2" title="2"><span class="st">  </span><span class="kw">anti_join</span>(pwt, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb206-3" title="3"></a>
<a class="sourceLine" id="cb206-4" title="4"><span class="kw">glimpse</span>(gas_pwt_anti)</a></code></pre></div>
<pre><code>## Observations: 19
## Variables: 6
## $ country  &lt;chr&gt; &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;, &quot;germany&quot;...
## $ year     &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968,...
## $ lgaspcar &lt;dbl&gt; 3.916953, 3.885345, 3.871484, 3.848782, 3.868993, 3.8...
## $ lincomep &lt;dbl&gt; -6.159837, -6.120923, -6.094258, -6.068361, -6.013442...
## $ lrpmg    &lt;dbl&gt; -0.1859108, -0.2309538, -0.3438417, -0.3746467, -0.39...
## $ lcarpcap &lt;dbl&gt; -9.342481, -9.183841, -9.037280, -8.913630, -8.811013...</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">gas_pwt_anti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span><span class="kw">tabyl</span>(country)</a></code></pre></div>
<pre><code>##  country  n percent
##  germany 19       1</code></pre>
<p><code>gas_pwt_anti</code> has the columns the <code>gasoline</code> dataset as well as the only country from <code>gasoline</code>
that is not in <code>pwt</code>: “germany”.</p>
</div>
<div id="working-with-a-list-of-datasets" class="section level2">
<h2><span class="header-section-number">5.8</span> Working with a list of datasets</h2>
<div id="getting-to-know-map" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Getting to know <code>map()</code></h3>
<p>This is our first encouter with a typical functional programming function, <code>map()</code>.</p>
<p>Let’s read the list of datasets from the previous chapter:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">paths =<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="st">&quot;datasets/unemployment/*.csv&quot;</span>)</a>
<a class="sourceLine" id="cb210-2" title="2"></a>
<a class="sourceLine" id="cb210-3" title="3">all_datasets =<span class="st"> </span><span class="kw">import_list</span>(paths)</a>
<a class="sourceLine" id="cb210-4" title="4"></a>
<a class="sourceLine" id="cb210-5" title="5"><span class="kw">str</span>(all_datasets)</a></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of which: Wage-earners    : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of which: Non-wage-earners: int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ Unemployed                : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ Active population         : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ Year                      : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of which: Wage-earners    : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ Unemployed                : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ Active population         : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ Year                      : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of which: Wage-earners    : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ Active population         : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ Year                      : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of which: Wage-earners    : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ Active population         : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ Year                      : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>For working with lists, another package from the <code>tidyverse</code> is very useful, and that would be
<code>purrr</code>. <code>purrr</code> has functions to work with lists, and we are going to focus on two of them,
<code>map()</code> and <code>reduce()</code>. <code>map()</code>… maps a function to each element of a list. <code>reduce()</code> is a bit
more complicated so we’ll leave that for later. <code>map()</code> and <code>reduce()</code> are also called functionals;
functions that use functions as arguments.</p>
<p>The first thing we are going to do is use a function to clean the names of the datasets. These
names are not very easy to work with; there are spaces, and it would be better if the names of the
columns would be all lowercase. For this we are going to use the function <code>clean_names()</code> from the
<code>janitor</code> package. For a single dataset, I would write this:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb212-2" title="2"></a>
<a class="sourceLine" id="cb212-3" title="3">one_dataset =<span class="st"> </span>one_dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb212-4" title="4"><span class="st">  </span><span class="kw">clean_names</span>()</a></code></pre></div>
<p>and I would get a dataset with column names in lowercase and spaces replaced by <code>_</code> (and other
corrections). How can I apply, or map, this function to each dataset in the list? To do this I need
to use <code>purrr::map()</code>:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb213-2" title="2"></a>
<a class="sourceLine" id="cb213-3" title="3">all_datasets =<span class="st"> </span>all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-4" title="4"><span class="st">  </span><span class="kw">map</span>(clean_names)</a>
<a class="sourceLine" id="cb213-5" title="5"></a>
<a class="sourceLine" id="cb213-6" title="6">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-7" title="7"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of_which_wage_earners       : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ unemployed                  : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ active_population           : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ year                        : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of_which_wage_earners       : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ unemployed                  : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ active_population           : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ year                        : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of_which_wage_earners       : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ active_population           : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ year                        : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of_which_wage_earners       : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ active_population           : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ year                        : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>So now, what if I want to know, for each dataset, which <em>communes</em> have an unemployment rate that is
less than, say, 3%? For a single dataset I would do something like this:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" title="1">one_dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-2" title="2"><span class="st">  </span><span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>But for a list of datasets, <code>map()</code> is needed (and as you will see, that is not all that is needed):</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">filter</span>(., unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</a></code></pre></div>
<pre><code>## $unemp_2013
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       844                   750
## 2 Leudelange                      1064                   937
## 3       Bech                       526                   463
##   of_which_non_wage_earners unemployed active_population
## 1                        94         25               869
## 2                       127         32              1096
## 3                        63         16               542
##   unemployment_rate_in_percent year
## 1                     2.876870 2013
## 2                     2.919708 2013
## 3                     2.952030 2013
## 
## $unemp_2014
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       845                   757
## 2 Leudelange                      1102                   965
## 3       Bech                       543                   476
## 4 Flaxweiler                       879                   789
##   of_which_non_wage_earners unemployed active_population
## 1                        88         19               864
## 2                       137         34              1136
## 3                        67         15               558
## 4                        90         27               906
##   unemployment_rate_in_percent year
## 1                     2.199074 2014
## 2                     2.992958 2014
## 3                     2.688172 2014
## 4                     2.980132 2014
## 
## $unemp_2015
##   commune total_employed_population of_which_wage_earners
## 1    Bech                       520                   450
## 2    Bous                       750                   680
##   of_which_non_wage_earners unemployed active_population
## 1                        70         14               534
## 2                        70         22               772
##   unemployment_rate_in_percent year
## 1                     2.621723 2015
## 2                     2.849741 2015
## 
## $unemp_2016
##             commune total_employed_population of_which_wage_earners
## 1 Reckange-sur-Mess                       980                   850
## 2              Bech                       520                   450
## 3          Betzdorf                      1500                  1350
## 4        Flaxweiler                       910                   820
##   of_which_non_wage_earners unemployed active_population
## 1                       130         30              1010
## 2                        70         11               531
## 3                       150         45              1545
## 4                        90         24               934
##   unemployment_rate_in_percent year
## 1                     2.970297 2016
## 2                     2.071563 2016
## 3                     2.912621 2016
## 4                     2.569593 2016</code></pre>
<p>I know what you’re thinking… <em>what the hell?</em>. Let me explain: <code>map()</code> needs a function to map to
each element of the list. <code>all_datasets</code> is the list to which I want to map the function. But what
function? <code>filter()</code> is the function I need, so why doesn’t:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</a></code></pre></div>
<p>work? This is a bit complicated, and has to do with what is called environments. If you try to run
the code above, you will get this error message:</p>
<pre><code>Error in filter(unemployment_rate_in_percent &lt; 3) :
  object &#39;unemployment_rate_in_percent&#39; not found</code></pre>
<p>I won’t go into details, but by writing <code>~filter(., unemployment_rate_in_percent &lt; 3)</code>, which is a
formula (<code>~</code> is the symbol to define formulas, more on this in the later chapters), <code>map()</code>
converts it to a function that it can use. If you want to know more about this, you can read it in
<a href="http://adv-r.had.co.nz/Functional-programming.html#closures">Advanced R</a> by Hadley Wickham, but it
is an advanced topic.</p>
</div>
<div id="getting-to-know-reduce" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Getting to know <code>reduce()</code></h3>
<p>Using <code>map()</code> we now know how to apply a function to each dataset of a list. But maybe it would be
easier to merge all the datasets first, and then manipulate them? Before that though, I am going to
teach you how to use <code>purrr::reduce()</code>, another very powerful function that works on lists. This is
a function that you can find in other programming languages, but sometimes it is called fold.</p>
<p>I think that the following example illustrates the power of <code>reduce()</code> well:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1">numbers =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="co"># Create a vector with the numbers 1 to 5</span></a>
<a class="sourceLine" id="cb220-2" title="2"></a>
<a class="sourceLine" id="cb220-3" title="3"><span class="kw">reduce</span>(numbers, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p><code>reduce()</code> takes a function as an argument, here the function <code>+</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and then does the following
computation:</p>
<pre><code>0 + numbers[1] + numbers[2] + numbers[3]...</code></pre>
<p>It applies the user supplied function successively but has to start with something, so we give it
the argument <code>init</code> also. This argument is actually optional, but I show it here because in some
cases it might be useful to start the computations at another value than <code>0</code>.<code>reduce()</code>
generalizes functions that only take two arguments. If you were to write a function that returns
the minimum between two numbers:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1">my_min =<span class="st"> </span><span class="cf">function</span>(a, b){</a>
<a class="sourceLine" id="cb223-2" title="2">    <span class="cf">if</span>(a <span class="op">&lt;</span><span class="st"> </span>b){</a>
<a class="sourceLine" id="cb223-3" title="3">        <span class="kw">return</span>(a)</a>
<a class="sourceLine" id="cb223-4" title="4">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb223-5" title="5">        <span class="kw">return</span>(b)</a>
<a class="sourceLine" id="cb223-6" title="6">    }</a>
<a class="sourceLine" id="cb223-7" title="7">}</a></code></pre></div>
<p>You could use <code>reduce()</code> to get the minimum of a list of numbers:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">numbers2 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">-8</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb224-2" title="2"></a>
<a class="sourceLine" id="cb224-3" title="3"><span class="kw">reduce</span>(numbers2, my_min)</a></code></pre></div>
<pre><code>## [1] -8</code></pre>
<p>As long as you provide a function and a list of elements to <code>reduce()</code>, you will get a single
output. So how could <code>reduce()</code> help us with merging all the datasets that are in the list? <code>dplyr</code>
comes with a lot of function to merge <em>two</em> datasets. Remember that I said before that <code>reduce()</code>
allows you to generalize a function of two arguments? Let’s try it with our list of datasets:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">unemp_lux =<span class="st"> </span><span class="kw">reduce</span>(all_datasets, full_join)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1"><span class="kw">glimpse</span>(unemp_lux)</a></code></pre></div>
<pre><code>## Observations: 472
## Variables: 8
## $ commune                      &lt;chr&gt; &quot;Grand-Duche de Luxembourg&quot;, &quot;Can...
## $ total_employed_population    &lt;int&gt; 223407, 17802, 1703, 844, 1431, 4...
## $ of_which_wage_earners        &lt;int&gt; 203535, 15993, 1535, 750, 1315, 3...
## $ of_which_non_wage_earners    &lt;int&gt; 19872, 1809, 168, 94, 116, 294, 2...
## $ unemployed                   &lt;int&gt; 19287, 1071, 114, 25, 74, 261, 98...
## $ active_population            &lt;int&gt; 242694, 18873, 1817, 869, 1505, 4...
## $ unemployment_rate_in_percent &lt;dbl&gt; 7.947044, 5.674773, 6.274078, 2.8...
## $ year                         &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 201...</code></pre>
<p><code>full_join()</code> is one of the <code>dplyr</code> function that merges data. There are others that might be
useful depending on the kind of join operation you need. Let’s write this data to disk as we’re
going to keep using it for the next chapters:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1"><span class="kw">export</span>(unemp_lux, <span class="st">&quot;datasets/unemp_lux.csv&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="list-columns" class="section level2">
<h2><span class="header-section-number">5.9</span> List-columns</h2>
<p>To learn about list-columns, let’s first focus on a single character of the <code>starwars</code> dataset:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1"><span class="kw">data</span>(starwars)</a></code></pre></div>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-2" title="2"><span class="st">  </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Luke Skywalker&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" title="3"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 1
## Variables: 13
## $ name       &lt;chr&gt; &quot;Luke Skywalker&quot;
## $ height     &lt;int&gt; 172
## $ mass       &lt;dbl&gt; 77
## $ hair_color &lt;chr&gt; &quot;blond&quot;
## $ skin_color &lt;chr&gt; &quot;fair&quot;
## $ eye_color  &lt;chr&gt; &quot;blue&quot;
## $ birth_year &lt;dbl&gt; 19
## $ gender     &lt;chr&gt; &quot;male&quot;
## $ homeworld  &lt;chr&gt; &quot;Tatooine&quot;
## $ species    &lt;chr&gt; &quot;Human&quot;
## $ films      &lt;list&gt; [&lt;&quot;Revenge of the Sith&quot;, &quot;Return of the Jedi&quot;, &quot;Th...
## $ vehicles   &lt;list&gt; [&lt;&quot;Snowspeeder&quot;, &quot;Imperial Speeder Bike&quot;&gt;]
## $ starships  &lt;list&gt; [&lt;&quot;X-wing&quot;, &quot;Imperial shuttle&quot;&gt;]</code></pre>
<p>We see that the columns <code>films</code>, <code>vehicles</code> and <code>starships</code> are all lists, and in the case of
<code>films</code>, it lists all the films where Luke Skywalker has appeared. What if you want to take a closer look at this list?</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-2" title="2"><span class="st">  </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Luke Skywalker&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-3" title="3"><span class="st">  </span><span class="kw">pull</span>(films)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Revenge of the Sith&quot;     &quot;Return of the Jedi&quot;     
## [3] &quot;The Empire Strikes Back&quot; &quot;A New Hope&quot;             
## [5] &quot;The Force Awakens&quot;</code></pre>
<p><code>pull()</code> is a <code>dplyr</code> function that extract (pulls) the column you’re interested in. It is quite
useful when you want to inspect a column.</p>
<p>Suppose we want to create a categorical variable which counts the number of movies in which the
characters have appeared. For this we need to compute the length of the list, or count the number
of elements this list has. Let’s try with <code>length()</code> a base R function:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-2" title="2"><span class="st">  </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> &quot;Luke Skywalker&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-3" title="3"><span class="st">  </span><span class="kw">pull</span>(films) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-4" title="4"><span class="st">  </span><span class="kw">length</span>()</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>This might be surprising at first, because we know that Luke Skywalker has appeared in more than 1
movie… the problem here is that for each individual, <code>films</code> is a list, whose single element is
a vector of characters. This means that <code>length(films)</code> computes the length of the list, which is
one, and not the length of the vector contained in the list! How can we get the length of the
vector of characters contained in the list and for each character? For this we need to use
<code>dplyr::rowwise()</code> and remove the <code>filter()</code> function and use <code>mutate()</code> to add this column to the
dataset:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1">starwars =<span class="st"> </span>starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb238-2" title="2"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb238-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_films =</span> <span class="kw">length</span>(films))</a></code></pre></div>
<p><code>dplyr::rowwise()</code> is useful when working with list-columns: columns that have lists as elements.</p>
<p>Let’s take a look at the characters and the number of films they have appeared in:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1">starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-2" title="2"><span class="st">  </span><span class="kw">select</span>(name, n_films)</a></code></pre></div>
<pre><code>## Source: local data frame [87 x 2]
## Groups: &lt;by row&gt;
## 
## # A tibble: 87 x 2
##    name               n_films
##    &lt;chr&gt;                &lt;int&gt;
##  1 Luke Skywalker           5
##  2 C-3PO                    6
##  3 R2-D2                    7
##  4 Darth Vader              4
##  5 Leia Organa              5
##  6 Owen Lars                3
##  7 Beru Whitesun lars       3
##  8 R5-D4                    1
##  9 Biggs Darklighter        1
## 10 Obi-Wan Kenobi           6
## # ... with 77 more rows</code></pre>
<p>Now we can create a factor variable that groups characters by asking whether they appeared only in
1 movie, or more:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" title="1">starwars =<span class="st"> </span>starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">more_1 =</span> <span class="kw">case_when</span>(n_films <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;Exactly one movie&quot;</span>,</a>
<a class="sourceLine" id="cb241-3" title="3">                            n_films <span class="op">!=</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;More than 1 movie&quot;</span>))</a></code></pre></div>
<p><code>case_when()</code> is a <code>dplyr</code> function that works similarly to the standard <code>if..else..</code> construct of
many programming languages (R also has this, we are going to learn about it in later chapters).</p>
<p>You can also create list columns with your own datasets, by using <code>tidyr::nest()</code>. Remember the
fake <code>survey_data</code> I created to illustrate <code>spread()</code> and <code>gather()</code>? Let’s go back to that dataset
again:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1"><span class="kw">print</span>(survey_data)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##      id variable value
##   &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1     1 var1       1  
## 2     1 var2       0.2
## 3     2 var1       1.4
## 4     2 var2       1.9
## 5     3 var1       0.1
## 6     3 var2       2.8
## 7     4 var1       1.7
## 8     4 var2       1.9</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1">nested_data =<span class="st"> </span>survey_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-2" title="2"><span class="st">  </span><span class="kw">nest</span>(variable, value)</a>
<a class="sourceLine" id="cb244-3" title="3"></a>
<a class="sourceLine" id="cb244-4" title="4"><span class="kw">print</span>(nested_data)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##      id data            
##   &lt;dbl&gt; &lt;list&gt;          
## 1     1 &lt;tibble [2 × 2]&gt;
## 2     2 &lt;tibble [2 × 2]&gt;
## 3     3 &lt;tibble [2 × 2]&gt;
## 4     4 &lt;tibble [2 × 2]&gt;</code></pre>
<p>This creates a new tibble, with columns <code>id</code> and <code>data</code>. <code>data</code> is a list-column that contains
tibbles; each tibble is the <code>variable</code> and <code>value</code> for each individual:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1">nested_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-2" title="2"><span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;1&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-3" title="3"><span class="st">  </span><span class="kw">pull</span>(data)</a></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 2 x 2
##   variable value
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 var1       1  
## 2 var2       0.2</code></pre>
<p>As you can see, for individual 1, the column data contains a 2x2 tibble with columns <code>variable</code> and
<code>value</code>. You might be wondering why this is useful, because this seems to introduce an unnecessary
layer of complexity. The usefulness of list-columns will become apparent in the next chapters,
where we are going to learn how to repeat actions over, say, individuals.</p>
</div>
<div id="exercises-2" class="section level2">
<h2><span class="header-section-number">5.10</span> Exercises</h2>
<div id="exercise-1-2" class="section level3 unnumbered">
<h3>Exercise 1</h3>
<p>Load the <code>LaborSupply</code> dataset from the <code>Ecdat</code> package and answer the following questions:</p>
<ul>
<li>Compute the average annual hours worked by year (plus standard deviation)</li>
<li>What age group worked the most hours in the year 1982?</li>
<li>Create a variable, <code>n_years</code> that equals the number of years an individual stays in the panel. Is the panel balanced?</li>
<li>Which are the individuals that do not have any kids during the whole period? Create a variable, <code>no_kids</code>, that flags these individuals (1 = no kids, 0 = kids)</li>
<li>Using the <code>no_kids</code> variable from before compute the average wage, standard deviation and number of observations in each group for the year 1980 (no kids group vs kids group).</li>
<li>Create the lagged logarithm of hours worked and wages. Remember that this is a panel.</li>
</ul>
</div>
<div id="exercise-2-1" class="section level3 unnumbered">
<h3>Exercise 2</h3>
<ul>
<li>What does the following code do? Copy and paste it in an R interpreter to find out!</li>
</ul>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1">LaborSupply <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-3" title="3"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;l&quot;</span>)), <span class="kw">funs</span>(lag, lead))</a></code></pre></div>
<p><code>mutate_at()</code> is a scoped version of <code>mutate()</code> which allows you to specify a number of columns and
functions in one go. This also exists for <code>summarise()</code>.</p>
<ul>
<li>Using <code>summarise_at()</code>, compute the mean, standard deviation and number of individuals of <code>lnhr</code> and <code>lnwg</code> for each individual.</li>
</ul>
</div>
<div id="exercise-3-1" class="section level3 unnumbered">
<h3>Exercise 3</h3>
<ul>
<li><p>In the dataset folder you downloaded at the beginning of the chapter, there is a folder called
“unemployment”. I used the data in the section about working with lists of datasets. Using
<code>rio::import_list()</code>, read the 4 datasets into R.</p></li>
<li><p>Using <code>map()</code>, map the <code>janitor::clean_names()</code> function to each dataset (just like in the example
in the section on working with lists of datasets). Then, still with <code>map()</code> and <code>mutate()</code> convert
all commune names in the <code>commune</code> column with the function <code>tolower()</code>, in a new column called <code>lcommune</code>.
This is not an easy exercise; so here are some hints:</p>
<ul>
<li>Remember that <code>all_datasets</code> is a list of datasets. Which function do you use when you want to map a function to each element of a list?</li>
<li>Each element of <code>all_datasets</code> are <code>data.frame</code> objects. Which function do you use to add a column to a <code>data.frame</code>?</li>
<li>What symbol can you use to access a column of a <code>data.frame</code>?</li>
</ul></li>
</ul>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>This is simply the <code>+</code> operator
you’re used to. Try this out: <code>`+`(1, 5)</code> and you’ll see <code>+</code> is a function like any other. You
just have to write backticks around the plus symbol to make it work.<a href="data-manipulation-and-descriptive-statistics.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-and-writing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
