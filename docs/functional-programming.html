<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Modern R with the tidyverse</title>
  <meta name="description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Modern R with the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Modern R with the tidyverse" />
  
  <meta name="twitter:description" content="This book will teach you how to use R to solve you statistical, data science and machine learning problems. Importing data, computing descriptive statistics, running regressions (or more complex machine learning models) and generating reports are some of the topics covered. No previous experience with R is needed." />
  

<meta name="author" content="Bruno Rodrigues">


<meta name="date" content="2018-12-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="defining-your-own-functions.html">
<link rel="next" href="package-development.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Modern R with the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#note-to-the-reader"><i class="fa fa-check"></i>Note to the reader</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-is-this-book-for"><i class="fa fa-check"></i>Who is this book for?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-book"><i class="fa fa-check"></i>Why this book?</a></li>
<li><a href="index.html#why-modern-r">Why <em>modern</em> R?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-is-rstudio"><i class="fa fa-check"></i>What is RStudio?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-book"><i class="fa fa-check"></i>What to expect from this book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-are-packages"><i class="fa fa-check"></i>What are packages?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-author"><i class="fa fa-check"></i>The author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html"><i class="fa fa-check"></i><b>1</b> Getting to know RStudio</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#panes"><i class="fa fa-check"></i><b>1.1</b> Panes</a></li>
<li class="chapter" data-level="1.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#console"><i class="fa fa-check"></i><b>1.2</b> Console</a></li>
<li class="chapter" data-level="1.3" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#scripts"><i class="fa fa-check"></i><b>1.3</b> Scripts</a><ul>
<li class="chapter" data-level="1.3.1" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-help-pane"><i class="fa fa-check"></i><b>1.3.1</b> The help pane</a></li>
<li class="chapter" data-level="1.3.2" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#the-environment-pane"><i class="fa fa-check"></i><b>1.3.2</b> The Environment pane</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#options"><i class="fa fa-check"></i><b>1.4</b> Options</a></li>
<li class="chapter" data-level="1.5" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>1.5</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="1.6" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#projects"><i class="fa fa-check"></i><b>1.6</b> Projects</a></li>
<li class="chapter" data-level="1.7" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#history"><i class="fa fa-check"></i><b>1.7</b> History</a></li>
<li class="chapter" data-level="1.8" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#plots"><i class="fa fa-check"></i><b>1.8</b> Plots</a></li>
<li class="chapter" data-level="1.9" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#addins"><i class="fa fa-check"></i><b>1.9</b> Addins</a></li>
<li class="chapter" data-level="1.10" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#packages"><i class="fa fa-check"></i><b>1.10</b> Packages</a></li>
<li class="chapter" data-level="1.11" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercises"><i class="fa fa-check"></i><b>1.11</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="getting-to-know-rstudio.html"><a href="getting-to-know-rstudio.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html"><i class="fa fa-check"></i><b>2</b> Objects, types and useful R functions to get started</a><ul>
<li class="chapter" data-level="2.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-numeric-class"><i class="fa fa-check"></i><b>2.1</b> The <code>numeric</code> class</a></li>
<li class="chapter" data-level="2.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-character-class"><i class="fa fa-check"></i><b>2.2</b> The <code>character</code> class</a></li>
<li class="chapter" data-level="2.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-factor-class"><i class="fa fa-check"></i><b>2.3</b> The <code>factor</code> class</a></li>
<li class="chapter" data-level="2.4" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-date-class"><i class="fa fa-check"></i><b>2.4</b> The <code>Date</code> class</a></li>
<li class="chapter" data-level="2.5" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-logical-class"><i class="fa fa-check"></i><b>2.5</b> The <code>logical</code> class</a></li>
<li class="chapter" data-level="2.6" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#vectors-and-matrices"><i class="fa fa-check"></i><b>2.6</b> Vectors and matrices</a><ul>
<li class="chapter" data-level="2.6.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-c-function"><i class="fa fa-check"></i><b>2.6.1</b> The <code>c()</code> function</a></li>
<li class="chapter" data-level="2.6.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#cbind-and-rbind"><i class="fa fa-check"></i><b>2.6.2</b> <code>cbind()</code> and <code>rbind()</code></a></li>
<li class="chapter" data-level="2.6.3" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-matrix-class"><i class="fa fa-check"></i><b>2.6.3</b> The <code>matrix</code> class</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-list-class"><i class="fa fa-check"></i><b>2.7</b> The <code>list</code> class</a></li>
<li class="chapter" data-level="2.8" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#the-data.frame-and-tibble-classes"><i class="fa fa-check"></i><b>2.8</b> The <code>data.frame</code> and <code>tibble</code> classes</a></li>
<li class="chapter" data-level="2.9" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#formulas"><i class="fa fa-check"></i><b>2.9</b> Formulas</a></li>
<li class="chapter" data-level="2.10" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#models"><i class="fa fa-check"></i><b>2.10</b> Models</a></li>
<li class="chapter" data-level="2.11" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#null-na-and-nan"><i class="fa fa-check"></i><b>2.11</b> NULL, NA and NaN</a></li>
<li class="chapter" data-level="2.12" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#useful-functions-to-get-you-started"><i class="fa fa-check"></i><b>2.12</b> Useful functions to get you started</a><ul>
<li class="chapter" data-level="2.12.1" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#sequences"><i class="fa fa-check"></i><b>2.12.1</b> Sequences</a></li>
<li class="chapter" data-level="2.12.2" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#basic-string-manipulation"><i class="fa fa-check"></i><b>2.12.2</b> Basic string manipulation</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercises-1"><i class="fa fa-check"></i><b>2.13</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-6"><i class="fa fa-check"></i>Exercise 6</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-7"><i class="fa fa-check"></i>Exercise 7</a></li>
<li class="chapter" data-level="" data-path="objects-types-and-useful-r-functions-to-get-started.html"><a href="objects-types-and-useful-r-functions-to-get-started.html#exercise-8"><i class="fa fa-check"></i>Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html"><i class="fa fa-check"></i><b>3</b> Reading and writing data</a><ul>
<li class="chapter" data-level="3.1" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#the-swiss-army-knife-of-data-import-and-export-rio"><i class="fa fa-check"></i><b>3.1</b> The swiss army knife of data import and export: <code>{rio}</code></a></li>
<li class="chapter" data-level="3.2" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#writing-any-object-to-disk"><i class="fa fa-check"></i><b>3.2</b> Writing any object to disk</a></li>
<li class="chapter" data-level="3.3" data-path="reading-and-writing-data.html"><a href="reading-and-writing-data.html#using-rstudio-projects-to-manage-paths"><i class="fa fa-check"></i><b>3.3</b> Using RStudio projects to manage paths</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html"><i class="fa fa-check"></i><b>4</b> Descriptive statistics and data manipulation</a><ul>
<li class="chapter" data-level="4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-data-exploration-exercice-using-base-r"><i class="fa fa-check"></i><b>4.1</b> A data exploration exercice using <em>base</em> R</a></li>
<li class="chapter" data-level="4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#smoking-is-bad-for-you-but-pipes-are-your-friend"><i class="fa fa-check"></i><b>4.2</b> Smoking is bad for you, but pipes are your friend</a></li>
<li class="chapter" data-level="4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#the-tidyverses-enfant-prodige-dplyr"><i class="fa fa-check"></i><b>4.3</b> The <code>{tidyverse}</code>’s <em>enfant prodige</em>: <code>{dplyr}</code></a><ul>
<li class="chapter" data-level="4.3.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-first-taste-of-data-manipulation-with-dplyr"><i class="fa fa-check"></i><b>4.3.1</b> A first taste of data manipulation with <code>{dplyr}</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter-the-rows-of-a-dataset-with-filter"><i class="fa fa-check"></i><b>4.3.2</b> Filter the rows of a dataset with <code>filter()</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select-columns-with-select"><i class="fa fa-check"></i><b>4.3.3</b> Select columns with <code>select()</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group-the-observations-of-your-dataset-with-group_by"><i class="fa fa-check"></i><b>4.3.4</b> Group the observations of your dataset with <code>group_by()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-summary-statistics-with-summarise"><i class="fa fa-check"></i><b>4.3.5</b> Get summary statistics with <code>summarise()</code></a></li>
<li class="chapter" data-level="4.3.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#adding-columns-with-mutate-and-transmute"><i class="fa fa-check"></i><b>4.3.6</b> Adding columns with <code>mutate()</code> and <code>transmute()</code></a></li>
<li class="chapter" data-level="4.3.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#joining-tibbles-with-full_join-left_join-right_join-and-all-the-others"><i class="fa fa-check"></i><b>4.3.7</b> Joining <code>tibble</code>s with <code>full_join()</code>, <code>left_join()</code>, <code>right_join()</code> and all the others</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#reshaping-data-with-tidyr"><i class="fa fa-check"></i><b>4.4</b> Reshaping data with <code>tidyr</code></a><ul>
<li class="chapter" data-level="4.4.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#spread-and-gather"><i class="fa fa-check"></i><b>4.4.1</b> <code>spread()</code> and <code>gather()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#fill-and-full_seq"><i class="fa fa-check"></i><b>4.4.2</b> <code>fill()</code> and <code>full_seq()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#put-order-in-your-columns-with-separate-unite-and-in-your-rows-with-separate_rows"><i class="fa fa-check"></i><b>4.4.3</b> Put order in your columns with <code>separate()</code>, <code>unite()</code>, and in your rows with <code>separate_rows()</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#a-sneak-peek-to-chapter-8-nest"><i class="fa fa-check"></i><b>4.4.4</b> A sneak peek to Chapter 8; <code>nest()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#scoped-tidyverse-verbs"><i class="fa fa-check"></i><b>4.5</b> Scoped <code>{tidyverse}</code> verbs</a><ul>
<li class="chapter" data-level="4.5.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#filter_"><i class="fa fa-check"></i><b>4.5.1</b> filter_*()</a></li>
<li class="chapter" data-level="4.5.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#select_-and-rename_"><i class="fa fa-check"></i><b>4.5.2</b> select_*() and rename_*()</a></li>
<li class="chapter" data-level="4.5.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#group_by_"><i class="fa fa-check"></i><b>4.5.3</b> group_by_*()</a></li>
<li class="chapter" data-level="4.5.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#summarise_"><i class="fa fa-check"></i><b>4.5.4</b> summarise_()</a></li>
<li class="chapter" data-level="4.5.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#mutate_"><i class="fa fa-check"></i><b>4.5.5</b> mutate_*()</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#other-useful-tidyverse-functions"><i class="fa fa-check"></i><b>4.6</b> Other useful <code>{tidyverse}</code> functions</a><ul>
<li class="chapter" data-level="4.6.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#if_else-case_when-and-recode"><i class="fa fa-check"></i><b>4.6.1</b> <code>if_else()</code>, <code>case_when()</code> and <code>recode()</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#lead-and-lag"><i class="fa fa-check"></i><b>4.6.2</b> <code>lead()</code> and <code>lag()</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#ntile"><i class="fa fa-check"></i><b>4.6.3</b> <code>ntile()</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#arrange"><i class="fa fa-check"></i><b>4.6.4</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="4.6.5" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#tally-and-count"><i class="fa fa-check"></i><b>4.6.5</b> <code>tally()</code> and <code>count()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#special-packages-for-special-kinds-of-data-forcats-lubridate-and-stringr"><i class="fa fa-check"></i><b>4.7</b> Special packages for special kinds of data: <code>{forcats}</code>, <code>{lubridate}</code>, and <code>{stringr}</code></a><ul>
<li class="chapter" data-level="4.7.1" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#section"><i class="fa fa-check"></i><b>4.7.1</b> 🐈🐈🐈🐈</a></li>
<li class="chapter" data-level="4.7.2" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#get-your-dates-right-with-lubridate"><i class="fa fa-check"></i><b>4.7.2</b> Get your dates right with <code>{lubridate}</code></a></li>
<li class="chapter" data-level="4.7.3" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#manipulate-strings-with-stringr"><i class="fa fa-check"></i><b>4.7.3</b> Manipulate strings with <code>{stringr}</code></a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#list-columns"><i class="fa fa-check"></i><b>4.8</b> List-columns</a></li>
<li class="chapter" data-level="4.9" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#going-beyond-descriptive-statistics-and-data-manipulation"><i class="fa fa-check"></i><b>4.9</b> Going beyond descriptive statistics and data manipulation</a></li>
<li class="chapter" data-level="4.10" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercises-2"><i class="fa fa-check"></i><b>4.10</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="descriptive-statistics-and-data-manipulation.html"><a href="descriptive-statistics-and-data-manipulation.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs</a><ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#resources"><i class="fa fa-check"></i><b>5.1</b> Resources</a></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a><ul>
<li class="chapter" data-level="5.2.1" data-path="graphs.html"><a href="graphs.html#barplots"><i class="fa fa-check"></i><b>5.2.1</b> Barplots</a></li>
<li class="chapter" data-level="5.2.2" data-path="graphs.html"><a href="graphs.html#scatter-plots"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plots</a></li>
<li class="chapter" data-level="5.2.3" data-path="graphs.html"><a href="graphs.html#density"><i class="fa fa-check"></i><b>5.2.3</b> Density</a></li>
<li class="chapter" data-level="5.2.4" data-path="graphs.html"><a href="graphs.html#line-plots"><i class="fa fa-check"></i><b>5.2.4</b> Line plots</a></li>
<li class="chapter" data-level="5.2.5" data-path="graphs.html"><a href="graphs.html#facets"><i class="fa fa-check"></i><b>5.2.5</b> Facets</a></li>
<li class="chapter" data-level="5.2.6" data-path="graphs.html"><a href="graphs.html#pie-charts"><i class="fa fa-check"></i><b>5.2.6</b> Pie Charts</a></li>
<li class="chapter" data-level="5.2.7" data-path="graphs.html"><a href="graphs.html#adding-text-to-plots"><i class="fa fa-check"></i><b>5.2.7</b> Adding text to plots</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#customization"><i class="fa fa-check"></i><b>5.3</b> Customization</a><ul>
<li class="chapter" data-level="5.3.1" data-path="graphs.html"><a href="graphs.html#changing-titles-axes-labels-options-mixing-geoms-and-changing-themes"><i class="fa fa-check"></i><b>5.3.1</b> Changing titles, axes labels, options, mixing geoms and changing themes</a></li>
<li class="chapter" data-level="5.3.2" data-path="graphs.html"><a href="graphs.html#colour-schemes"><i class="fa fa-check"></i><b>5.3.2</b> Colour schemes</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphs.html"><a href="graphs.html#saving-plots-to-disk"><i class="fa fa-check"></i><b>5.4</b> Saving plots to disk</a></li>
<li class="chapter" data-level="5.5" data-path="graphs.html"><a href="graphs.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="graphs.html"><a href="graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-models.html"><a href="statistical-models.html"><i class="fa fa-check"></i><b>6</b> Statistical models</a><ul>
<li class="chapter" data-level="6.1" data-path="statistical-models.html"><a href="statistical-models.html#terminology"><i class="fa fa-check"></i><b>6.1</b> Terminology</a></li>
<li class="chapter" data-level="6.2" data-path="statistical-models.html"><a href="statistical-models.html#fitting-a-model-to-data"><i class="fa fa-check"></i><b>6.2</b> Fitting a model to data</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-models.html"><a href="statistical-models.html#diagnostics"><i class="fa fa-check"></i><b>6.3</b> Diagnostics</a></li>
<li class="chapter" data-level="6.4" data-path="statistical-models.html"><a href="statistical-models.html#interpreting-models"><i class="fa fa-check"></i><b>6.4</b> Interpreting models</a></li>
<li class="chapter" data-level="6.5" data-path="statistical-models.html"><a href="statistical-models.html#comparing-models"><i class="fa fa-check"></i><b>6.5</b> Comparing models</a></li>
<li class="chapter" data-level="6.6" data-path="statistical-models.html"><a href="statistical-models.html#using-a-model-for-prediction"><i class="fa fa-check"></i><b>6.6</b> Using a model for prediction</a></li>
<li class="chapter" data-level="6.7" data-path="statistical-models.html"><a href="statistical-models.html#beyond-linear-regression"><i class="fa fa-check"></i><b>6.7</b> Beyond linear regression</a></li>
<li class="chapter" data-level="6.8" data-path="statistical-models.html"><a href="statistical-models.html#hyper-parameters"><i class="fa fa-check"></i><b>6.8</b> Hyper-parameters</a><ul>
<li class="chapter" data-level="6.8.1" data-path="statistical-models.html"><a href="statistical-models.html#ridge-regression"><i class="fa fa-check"></i><b>6.8.1</b> Ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="statistical-models.html"><a href="statistical-models.html#training-validating-and-testing-models"><i class="fa fa-check"></i><b>6.9</b> Training, validating, and testing models</a><ul>
<li class="chapter" data-level="6.9.1" data-path="statistical-models.html"><a href="statistical-models.html#set-up"><i class="fa fa-check"></i><b>6.9.1</b> Set up</a></li>
<li class="chapter" data-level="6.9.2" data-path="statistical-models.html"><a href="statistical-models.html#bayesian-hyperparameter-optimization"><i class="fa fa-check"></i><b>6.9.2</b> Bayesian hyperparameter optimization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html"><i class="fa fa-check"></i><b>7</b> Defining your own functions</a><ul>
<li class="chapter" data-level="7.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#control-flow"><i class="fa fa-check"></i><b>7.1</b> Control flow</a><ul>
<li class="chapter" data-level="7.1.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#if-else"><i class="fa fa-check"></i><b>7.1.1</b> If-else</a></li>
<li class="chapter" data-level="7.1.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#for-loops"><i class="fa fa-check"></i><b>7.1.2</b> For loops</a></li>
<li class="chapter" data-level="7.1.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#while-loops"><i class="fa fa-check"></i><b>7.1.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#writing-your-own-functions"><i class="fa fa-check"></i><b>7.2</b> Writing your own functions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#declaring-functions-in-r"><i class="fa fa-check"></i><b>7.2.1</b> Declaring functions in R</a></li>
<li class="chapter" data-level="7.2.2" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#fibonacci-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Fibonacci numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-4"><i class="fa fa-check"></i><b>7.3</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-functions-as-arguments"><i class="fa fa-check"></i><b>7.4</b> Functions that take functions as arguments</a></li>
<li class="chapter" data-level="7.5" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-take-columns-of-data-as-arguments"><i class="fa fa-check"></i><b>7.5</b> Functions that take columns of data as arguments</a></li>
<li class="chapter" data-level="7.6" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#functions-that-use-loops"><i class="fa fa-check"></i><b>7.6</b> Functions that use loops</a></li>
<li class="chapter" data-level="7.7" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#anonymous-functions"><i class="fa fa-check"></i><b>7.7</b> Anonymous functions</a></li>
<li class="chapter" data-level="7.8" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercises-5"><i class="fa fa-check"></i><b>7.8</b> Exercises</a><ul>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="defining-your-own-functions.html"><a href="defining-your-own-functions.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>8</b> Functional programming</a><ul>
<li class="chapter" data-level="8.1" data-path="functional-programming.html"><a href="functional-programming.html#functions-definition"><i class="fa fa-check"></i><b>8.1</b> Functions definition</a></li>
<li class="chapter" data-level="8.2" data-path="functional-programming.html"><a href="functional-programming.html#properties-of-functions"><i class="fa fa-check"></i><b>8.2</b> Properties of functions</a></li>
<li class="chapter" data-level="8.3" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-with-purrr"><i class="fa fa-check"></i><b>8.3</b> Functional programming with <code>{purrr}</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="functional-programming.html"><a href="functional-programming.html#the-map-family-of-functions"><i class="fa fa-check"></i><b>8.3.1</b> The <code>map*()</code> family of functions</a></li>
<li class="chapter" data-level="8.3.2" data-path="functional-programming.html"><a href="functional-programming.html#reducing-with-purrr"><i class="fa fa-check"></i><b>8.3.2</b> Reducing with <code>purrr</code></a></li>
<li class="chapter" data-level="8.3.3" data-path="functional-programming.html"><a href="functional-programming.html#safely-and-possibly"><i class="fa fa-check"></i><b>8.3.3</b> <code>safely()</code> and <code>possibly()</code></a></li>
<li class="chapter" data-level="8.3.4" data-path="functional-programming.html"><a href="functional-programming.html#is_-and-as_-functions"><i class="fa fa-check"></i><b>8.3.4</b> <code>is_*()</code> and <code>as_*()</code> functions</a></li>
<li class="chapter" data-level="8.3.5" data-path="functional-programming.html"><a href="functional-programming.html#transposing-lists"><i class="fa fa-check"></i><b>8.3.5</b> «Transposing lists»</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming.html"><a href="functional-programming.html#using-your-functions-inside-mutate"><i class="fa fa-check"></i><b>8.4</b> Using your functions inside <code>mutate()</code></a></li>
<li class="chapter" data-level="8.5" data-path="functional-programming.html"><a href="functional-programming.html#working-with-a-list-of-datasets"><i class="fa fa-check"></i><b>8.5</b> Working with a list of datasets</a><ul>
<li class="chapter" data-level="8.5.1" data-path="functional-programming.html"><a href="functional-programming.html#using-map-to-work-on-lists-of-datasets"><i class="fa fa-check"></i><b>8.5.1</b> Using <code>map()</code> to work on lists of datasets</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="functional-programming.html"><a href="functional-programming.html#mapping-your-homebrewed-functions-to-lists-of-datasets"><i class="fa fa-check"></i><b>8.6</b> Mapping your homebrewed functions to lists of datasets</a><ul>
<li class="chapter" data-level="8.6.1" data-path="functional-programming.html"><a href="functional-programming.html#data-frames-and-reduce"><i class="fa fa-check"></i><b>8.6.1</b> Data frames and <code>reduce</code></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="functional-programming.html"><a href="functional-programming.html#functional-programming-and-plotting"><i class="fa fa-check"></i><b>8.7</b> Functional programming and plotting</a></li>
<li class="chapter" data-level="8.8" data-path="functional-programming.html"><a href="functional-programming.html#exercises-6"><i class="fa fa-check"></i><b>8.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>9</b> Package development</a><ul>
<li class="chapter" data-level="9.1" data-path="package-development.html"><a href="package-development.html#why-you-need-to-write-your-own-package"><i class="fa fa-check"></i><b>9.1</b> Why you need to write your own package</a></li>
<li class="chapter" data-level="9.2" data-path="package-development.html"><a href="package-development.html#unit-testing-your-package"><i class="fa fa-check"></i><b>9.2</b> Unit testing your package</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="further-topics.html"><a href="further-topics.html"><i class="fa fa-check"></i><b>10</b> Further topics</a><ul>
<li class="chapter" data-level="10.1" data-path="further-topics.html"><a href="further-topics.html#using-python-from-r-with-reticulate"><i class="fa fa-check"></i><b>10.1</b> Using Python from R with <code>{reticulate}</code></a></li>
<li class="chapter" data-level="10.2" data-path="further-topics.html"><a href="further-topics.html#generating-pdf-or-word-reports-with-r"><i class="fa fa-check"></i><b>10.2</b> Generating Pdf or Word reports with R</a></li>
<li class="chapter" data-level="10.3" data-path="further-topics.html"><a href="further-topics.html#scraping-the-internet"><i class="fa fa-check"></i><b>10.3</b> Scraping the internet</a></li>
<li class="chapter" data-level="10.4" data-path="further-topics.html"><a href="further-topics.html#regular-expressions"><i class="fa fa-check"></i><b>10.4</b> Regular expressions</a></li>
<li class="chapter" data-level="10.5" data-path="further-topics.html"><a href="further-topics.html#setting-up-a-blog-with-blogdown"><i class="fa fa-check"></i><b>10.5</b> Setting up a blog with <code>{blogdown}</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modern R with the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functional-programming" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Functional programming</h1>
<p>By now, you are pretty familiar with functions in R. Now, let’s introduce the functional programming
paradigm, but first, let’s go over some formal definitions.</p>
<div id="functions-definition" class="section level2">
<h2><span class="header-section-number">8.1</span> Functions definition</h2>
<p>You should be familiar with function definitions in R. For example, suppose you want to compute
the square root of a number and want to do so using Newton’s algorithm:</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb822-1" title="1">sqrt_newton &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb822-2" title="2">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb822-3" title="3">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb822-4" title="4">    }</a>
<a class="sourceLine" id="cb822-5" title="5">    <span class="kw">return</span>(init)</a>
<a class="sourceLine" id="cb822-6" title="6">}</a></code></pre></div>
<p>You can then use this function to get the square root of a number:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb823-1" title="1"><span class="kw">sqrt_newton</span>(<span class="dv">16</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>We are using a <code>while</code> loop inside the body. The <em>body</em> of a function are the instructions that
define the function. You can get the body of a function with <code>body(some_func)</code> of the function.
In <em>pure</em> functional programming languages, like Haskell, you don’t have loops. How can you
program without loops, you may ask? In functional programming, loops are replaced by recursion,
which we already discussed in the previous chapter. Let’s rewrite our little example above
with recursion:</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb825-1" title="1">sqrt_newton_recur &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb825-2" title="2">    <span class="cf">if</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&lt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb825-3" title="3">        result &lt;-<span class="st"> </span>init</a>
<a class="sourceLine" id="cb825-4" title="4">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb825-5" title="5">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb825-6" title="6">        result &lt;-<span class="st"> </span><span class="kw">sqrt_newton_recur</span>(a, init, eps)</a>
<a class="sourceLine" id="cb825-7" title="7">    }</a>
<a class="sourceLine" id="cb825-8" title="8">    <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb825-9" title="9">}</a></code></pre></div>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb826-1" title="1"><span class="kw">sqrt_newton_recur</span>(<span class="dv">16</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 4.00122</code></pre>
<p>R is not a pure functional programming language though, so we can still use loops (be it <code>while</code> or
<code>for</code> loops) in the bodies of our functions. As discussed in the previous chapter, it is actually
better, performance-wise, to use loops instead of recursion, because R is not tail-call optimized.
I won’t got into the details of what tail-call optimization is but just remember that if
performance is important a loop will be faster. However, sometimes, it is easier to write a
function using recursion. I personally tend to avoid loops if performance is not important,
because I find that code that avoids loops is easier to read and debug. However, knowing that
you can use loops is reassuring. In the coming sections I will show you some built-in functions
that make it possible to avoid writing loops and that don’t rely on recursion, so performance
won’t be penalized.</p>
</div>
<div id="properties-of-functions" class="section level2">
<h2><span class="header-section-number">8.2</span> Properties of functions</h2>
<p>Mathematical functions have a nice property: we always get the same output for a given input. This
is called referential transparency and we should aim to write our R functions in such a way.</p>
<p>For example, the following function:</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb828-1" title="1">increment &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb828-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb828-3" title="3">}</a></code></pre></div>
<p>Is a referential transparent function. We always get the same result for any <code>x</code> that we give to
this function.</p>
<p>This:</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb829-1" title="1"><span class="kw">increment</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will always produce <code>11</code>.</p>
<p>However, this one:</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb831-1" title="1">increment_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb831-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span>spam)</a>
<a class="sourceLine" id="cb831-3" title="3">}</a></code></pre></div>
<p>is not a referential transparent function, because its value depends on the global variable <code>spam</code>.</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb832-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb832-2" title="2"></a>
<a class="sourceLine" id="cb832-3" title="3"><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>will only produce <code>11</code> if <code>spam = 1</code>. But what if <code>spam = 19</code>?</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb834-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">19</span></a>
<a class="sourceLine" id="cb834-2" title="2"></a>
<a class="sourceLine" id="cb834-3" title="3"><span class="kw">increment_opaque</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 29</code></pre>
<p>To make <code>increment_opaque()</code> a referential transparent function, it is enough to make <code>spam</code> an
argument:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb836-1" title="1">increment_not_opaque &lt;-<span class="st"> </span><span class="cf">function</span>(x, spam){</a>
<a class="sourceLine" id="cb836-2" title="2">    <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span>spam)</a>
<a class="sourceLine" id="cb836-3" title="3">}</a></code></pre></div>
<p>Now even if there is a global variable called <code>spam</code>, this will not influence our function:</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb837-1" title="1">spam &lt;-<span class="st"> </span><span class="dv">19</span></a>
<a class="sourceLine" id="cb837-2" title="2"></a>
<a class="sourceLine" id="cb837-3" title="3"><span class="kw">increment_not_opaque</span>(<span class="dv">10</span>, <span class="dv">34</span>)</a></code></pre></div>
<pre><code>## [1] 44</code></pre>
<p>This is because the variable <code>spam</code> defined in the body of the function is a local variable. It
could have been called anything else, really. Avoiding opaque functions makes our life easier.</p>
<p>Another property that adepts of functional programming value is that functions should have no, or
very limited, side-effects. This means that functions should not change the state of your program.</p>
<p>For example this function (which is not a referential transparent function):</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb839-1" title="1">count_iter &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb839-2" title="2"></a>
<a class="sourceLine" id="cb839-3" title="3">sqrt_newton_side_effect &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb839-4" title="4">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb839-5" title="5">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb839-6" title="6">        count_iter &lt;&lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="co"># The &quot;&lt;&lt;-&quot; symbol means that we assign the</span></a>
<a class="sourceLine" id="cb839-7" title="7">    }                                 <span class="co"># RHS value in a variable in the global environment</span></a>
<a class="sourceLine" id="cb839-8" title="8">    <span class="kw">return</span>(init)</a>
<a class="sourceLine" id="cb839-9" title="9">}</a></code></pre></div>
<p>If you look in the environment pane, you will see that <code>count_iter</code> equals 0. Now call this
function with the following arguments:</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb840-1" title="1"><span class="kw">sqrt_newton_side_effect</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 126.4911</code></pre>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb842-1" title="1"><span class="kw">print</span>(count_iter)</a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>If you check the value of <code>count_iter</code> now, you will see that it increased! This is a side effect,
because the function changed something outside of its scope. It changed a value in the global
environment. In general, it is good practice to avoid side-effects. For example, we could make the
above function not have any side effects like this:</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb844-1" title="1">sqrt_newton_count &lt;-<span class="st"> </span><span class="cf">function</span>(a, init, <span class="dt">count_iter =</span> <span class="dv">0</span>, <span class="dt">eps =</span> <span class="fl">0.01</span>){</a>
<a class="sourceLine" id="cb844-2" title="2">    <span class="cf">while</span>(<span class="kw">abs</span>(init<span class="op">**</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>a) <span class="op">&gt;</span><span class="st"> </span>eps){</a>
<a class="sourceLine" id="cb844-3" title="3">        init &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span>(init <span class="op">+</span><span class="st"> </span>a<span class="op">/</span>init)</a>
<a class="sourceLine" id="cb844-4" title="4">        count_iter &lt;-<span class="st"> </span>count_iter <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb844-5" title="5">    }</a>
<a class="sourceLine" id="cb844-6" title="6">    <span class="kw">return</span>(<span class="kw">c</span>(init, count_iter))</a>
<a class="sourceLine" id="cb844-7" title="7">}</a></code></pre></div>
<p>Now, this function returns a list with two elements, the result, and the number of iterations it
took to get the result:</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb845-1" title="1"><span class="kw">sqrt_newton_count</span>(<span class="dv">16000</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 126.4911   9.0000</code></pre>
<p>Writing to disk is also considered a side effect, because the function changes something (a file)
outside its scope. But this cannot be avoided since you <em>want</em> to write to disk.
Just remember: try to avoid having functions changing variables in the global environment unless
you have a very good reason of doing so.</p>
<p>Finally, another property of mathematical functions, is that they do one single thing. Functional
programming purists also program their functions to do one single task. This has benefits, but
can complicate things. The function we wrote previously does two things: it computes the square
root of a number and also returns the number of iterations it took to compute the result. However,
this is not a bad thing; the function is doing two tasks, but these tasks are related to each other
and it makes sense to have them together. My piece of advice: avoid having functions that do
many <em>unrelated</em> things. This makes debugging harder.</p>
<p>In conclusion: you should strive for referential transparency, try to avoid side effects unless you
have a good reason to have them and try to keep your functions short and do as little tasks as
possible. This makes testing and debugging easier, as you will see.</p>
</div>
<div id="functional-programming-with-purrr" class="section level2">
<h2><span class="header-section-number">8.3</span> Functional programming with <code>{purrr}</code></h2>
<p>Hadley Wickham developed a package called <code>purrr</code> which contains a lot of very useful functions.</p>
<div id="the-map-family-of-functions" class="section level3">
<h3><span class="header-section-number">8.3.1</span> The <code>map*()</code> family of functions</h3>
<p>In the previous section we saw how to map a function to each element of a list. Each version of an
<code>*apply()</code> function has a different purpose, but it is not very easy to remember which one returns
a list, which other one returns an atomic vector and so on. If you’re working on data frames you
can use <code>apply()</code> to sum (for example) over columns or rows, because you can specify which <code>MARGIN</code>
you want to sum over. But you do not get a data frame back. In the <code>purrr</code> package, each of the
functions that do mapping have a similar name. The first part of these functions’ names all start
with <code>map_</code> and the second part tells you what this function is going to output. For example, if
you want <code>double</code>s out, you would use <code>map_dbl()</code>. If you are working on data frames want a data
frame back, you would use <code>map_df()</code>. These are much more intuitive and easier to remember and we’re
going to learn how to use them in the chapter about <a href="#tidyverse">The Tidyverse</a>. For now, let’s just focus on
the basic functions, <code>map()</code> and <code>reduce()</code> (and some variants of <code>reduce()</code>). To map a function
to every element of a list, simply use <code>map()</code>:</p>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb847-1" title="1"><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</a>
<a class="sourceLine" id="cb847-2" title="2">numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">19</span>, <span class="dv">64</span>)</a>
<a class="sourceLine" id="cb847-3" title="3"></a>
<a class="sourceLine" id="cb847-4" title="4"><span class="kw">map</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 2.645767
## 
## [[2]]
## [1] 2.828469
## 
## [[3]]
## [1] 4.358902
## 
## [[4]]
## [1] 8.000002</code></pre>
<p>If you want print “hello” using a function from <code>purrr</code> you would need to use <code>rerun()</code>:</p>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb849-1" title="1"><span class="kw">rerun</span>(<span class="dv">10</span>, <span class="st">&quot;hello&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rerun()</code> simply runs an expression (which can be arbitrarily complex) <code>n</code> times, whereas <code>map()</code>
maps a function to a list of inputs, so to achieve the same with <code>map()</code>, you need to map the <code>print()</code>
function to a vector of characters:</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb851-1" title="1"><span class="kw">map</span>(<span class="kw">rep</span>(<span class="st">&quot;hello&quot;</span>, <span class="dv">10</span>), print)</a></code></pre></div>
<pre><code>## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;
## [1] &quot;hello&quot;</code></pre>
<pre><code>## [[1]]
## [1] &quot;hello&quot;
## 
## [[2]]
## [1] &quot;hello&quot;
## 
## [[3]]
## [1] &quot;hello&quot;
## 
## [[4]]
## [1] &quot;hello&quot;
## 
## [[5]]
## [1] &quot;hello&quot;
## 
## [[6]]
## [1] &quot;hello&quot;
## 
## [[7]]
## [1] &quot;hello&quot;
## 
## [[8]]
## [1] &quot;hello&quot;
## 
## [[9]]
## [1] &quot;hello&quot;
## 
## [[10]]
## [1] &quot;hello&quot;</code></pre>
<p><code>rep()</code> is a function that creates a vector by repeating something, in this case the string “hello”,
as many times as needed, here 10. The output here is a bit different that before though, because first
you will see “hello” printed 10 times, but <code>map()</code> always returns a list, this means that you
will also get a list where each element is the string “hello”.</p>
<p>We know the standard <code>map()</code> function, which returns a list, but there are a number of
variants of this function. <code>map_dbl()</code> returns an atomic vector of doubles:</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb854-1" title="1"><span class="kw">map_dbl</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 2.645767 2.828469 4.358902 8.000002</code></pre>
<p><code>map_chr()</code> returns an atomic vector of strings:</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb856-1" title="1"><span class="kw">map_chr</span>(numbers, sqrt_newton, <span class="dt">init =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2.645767&quot; &quot;2.828469&quot; &quot;4.358902&quot; &quot;8.000002&quot;</code></pre>
<p><code>map_lgl()</code> returns an atomic vector of <code>TRUE</code> or <code>FALSE</code>:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb858-1" title="1">divisible &lt;-<span class="st"> </span><span class="cf">function</span>(x, y){</a>
<a class="sourceLine" id="cb858-2" title="2">  <span class="kw">if_else</span>(x <span class="op">%%</span><span class="st"> </span>y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb858-3" title="3">}</a>
<a class="sourceLine" id="cb858-4" title="4"></a>
<a class="sourceLine" id="cb858-5" title="5"><span class="kw">map_lgl</span>(<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>), divisible, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE
##  [12]  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
##  [23] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [34] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE
##  [45]  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
##  [56] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
##  [67] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE
##  [78]  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
##  [89] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE
## [100] FALSE</code></pre>
<p>There are also other interesting variants, such as <code>map_if()</code>:</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb860-2" title="2"></a>
<a class="sourceLine" id="cb860-3" title="3"><span class="kw">map_if</span>(a, (<span class="cf">function</span>(x) <span class="kw">divisible</span>(x, <span class="dv">2</span>)), sqrt)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 1.414214
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 2
## 
## [[5]]
## [1] 5
## 
## [[6]]
## [1] 2.44949
## 
## [[7]]
## [1] 7
## 
## [[8]]
## [1] 2.828427
## 
## [[9]]
## [1] 9
## 
## [[10]]
## [1] 3.162278</code></pre>
<p>I used <code>map_if()</code> to take the square root of only those numbers in vector <code>a</code> that are divisble by 2,
by using an anonymous function that checks if a number is divisible by 2 (by wrapping <code>divisible()</code>).</p>
<p><code>map_at()</code> is similar to <code>map_if()</code> but maps the function at a position specified by the user:</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb862-1" title="1"><span class="kw">map_at</span>(numbers, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), sqrt)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 2.645751
## 
## [[2]]
## [1] 8
## 
## [[3]]
## [1] 4.358899
## 
## [[4]]
## [1] 64</code></pre>
<p>or if you have a named list:</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb864-1" title="1">recipe &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;spam&quot;</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;eggs&quot;</span> =<span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;bacon&quot;</span> =<span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb864-2" title="2"></a>
<a class="sourceLine" id="cb864-3" title="3"><span class="kw">map_at</span>(recipe, <span class="st">&quot;bacon&quot;</span>, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## $spam
## [1] 1
## 
## $eggs
## [1] 3
## 
## $bacon
## [1] 20</code></pre>
<p>I used <code>map_at()</code> to double the quantity of bacon in the recipe (by using the <code>*</code> function, and specifying
its second argument, <code>2</code>. Try the following in the command prompt: <code>`*`(3, 4)</code>).</p>
<p><code>map2()</code> is the equivalent of <code>mapply()</code> and <code>pmap()</code> is the generalisation of <code>map2()</code> for more
than 2 arguments:</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb866-1" title="1"><span class="kw">print</span>(a)</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb868-1" title="1">b &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">length.out =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb868-2" title="2"></a>
<a class="sourceLine" id="cb868-3" title="3"><span class="kw">print</span>(b)</a></code></pre></div>
<pre><code>##  [1] 1.000000 1.111111 1.222222 1.333333 1.444444 1.555556 1.666667
##  [8] 1.777778 1.888889 2.000000</code></pre>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb870-1" title="1"><span class="kw">map2</span>(a, b, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2.222222
## 
## [[3]]
## [1] 3.666667
## 
## [[4]]
## [1] 5.333333
## 
## [[5]]
## [1] 7.222222
## 
## [[6]]
## [1] 9.333333
## 
## [[7]]
## [1] 11.66667
## 
## [[8]]
## [1] 14.22222
## 
## [[9]]
## [1] 17
## 
## [[10]]
## [1] 20</code></pre>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb872-1" title="1">n &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb872-2" title="2"></a>
<a class="sourceLine" id="cb872-3" title="3"><span class="kw">pmap</span>(<span class="kw">list</span>(a, b, n), rnorm)</a></code></pre></div>
<pre><code>## [[1]]
## [1] -0.3390433
## 
## [[2]]
## [1] 2.9112815 0.6336281
## 
## [[3]]
## [1] -0.3468364 -5.0780178  4.8137809
## 
## [[4]]
## [1]  2.8895890 -0.6554886 -3.3664595  1.7246887
## 
## [[5]]
## [1] 13.510076 11.967669  5.364994 -1.626470  2.279362
## 
## [[6]]
## [1]  1.9960271 -5.9273471 10.2248510  6.4238841 -0.9296016 -0.6230772
## 
## [[7]]
## [1] -3.56441591  9.36087823 -2.18931874 11.29486286 -7.70610720 12.14668245
## [7]  0.05655167
## 
## [[8]]
## [1]  -9.0300679 -15.5087408  -0.5029011  -6.7685115  -0.8930143   8.6610726
## [7]   4.3739079  -1.5743869
## 
## [[9]]
## [1] -2.953657  9.719432 -5.994068 -3.860638 -4.197553  4.104475  3.926871
## [8] 11.128557  3.842179
## 
## [[10]]
##  [1]   5.099272  -5.734222  -5.000404   8.345451   9.945886  20.915801
##  [7]  13.787797 -13.270184  15.504936  16.635813</code></pre>
</div>
<div id="reducing-with-purrr" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Reducing with <code>purrr</code></h3>
<p>In the <code>purrr</code> package, you can find two more functions for folding: <code>reduce()</code> and
<code>reduce_right()</code>. The difference between <code>reduce()</code> and <code>reduce_right()</code> is pretty obvious:
<code>reduce_right()</code> starts from the right!</p>
<p>For operations that are not commutative, this makes a difference. Other interesting folding
functions are <code>accumulate()</code> and <code>accumulate_right()</code>:</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb874-1" title="1">a &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb874-2" title="2"></a>
<a class="sourceLine" id="cb874-3" title="3"><span class="kw">accumulate</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb874-4" title="4"><span class="kw">accumulate_right</span>(a, <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a></code></pre></div>
<p>These two functions keep the intermediary results.</p>
<p>In the previous chapter, we wrote a loop to compute the sum of the 100 first integers. We can do
the same with <code>purrr::reduce()</code>:</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" title="1">result =<span class="st"> </span><span class="kw">reduce</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb875-2" title="2"></a>
<a class="sourceLine" id="cb875-3" title="3"><span class="kw">print</span>(result)</a></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>You certainly agree with me that is simpler to understand. You can even see what happens in more
detail using <code>accumulate</code>:</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb877-1" title="1"><span class="kw">accumulate</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a></code></pre></div>
</div>
<div id="safely-and-possibly" class="section level3">
<h3><span class="header-section-number">8.3.3</span> <code>safely()</code> and <code>possibly()</code></h3>
<p><code>safely()</code> and <code>possibly()</code> are very useful functions. Consider the following situation:</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb878-1" title="1">a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb878-2" title="2"></a>
<a class="sourceLine" id="cb878-3" title="3"><span class="kw">sqrt</span>(a)</a></code></pre></div>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb879-1" title="1">Error <span class="cf">in</span> <span class="kw">sqrt</span>(a) <span class="op">:</span><span class="st"> </span>non<span class="op">-</span>numeric argument to mathematical <span class="cf">function</span></a></code></pre></div>
<p>Using <code>map()</code> or <code>Map()</code> will result in a similar error. <code>safely()</code> is an higher-order function that
takes one function as an argument and executes it… <em>safely</em>, meaning the execution of the function
will not stop if there is an error. The error message gets captured alongside valid results.</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb880-1" title="1">a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb880-2" title="2"></a>
<a class="sourceLine" id="cb880-3" title="3">safe_sqrt &lt;-<span class="st"> </span><span class="kw">safely</span>(sqrt)</a>
<a class="sourceLine" id="cb880-4" title="4"></a>
<a class="sourceLine" id="cb880-5" title="5"><span class="kw">map</span>(a, safe_sqrt)</a></code></pre></div>
<pre><code>## [[1]]
## [[1]]$result
## NULL
## 
## [[1]]$error
## &lt;simpleError in sqrt(x = x): non-numeric argument to mathematical function&gt;
## 
## 
## [[2]]
## [[2]]$result
## [1] 2
## 
## [[2]]$error
## NULL
## 
## 
## [[3]]
## [[3]]$result
## [1] 2.236068
## 
## [[3]]$error
## NULL</code></pre>
<p><code>possibly()</code> works similarly, but also allows you to specify a return value in case of an error:</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb882-1" title="1">possible_sqrt &lt;-<span class="st"> </span><span class="kw">possibly</span>(sqrt, <span class="dt">otherwise =</span> <span class="ot">NA_real_</span>)</a>
<a class="sourceLine" id="cb882-2" title="2"></a>
<a class="sourceLine" id="cb882-3" title="3"><span class="kw">map</span>(a, possible_sqrt)</a></code></pre></div>
<pre><code>## [[1]]
## [1] NA
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 2.236068</code></pre>
<p>Of course, in this particular example, the same effect could be obtained way more easily:</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb884-1" title="1"><span class="kw">sqrt</span>(<span class="kw">as.numeric</span>(a))</a></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1]       NA 2.000000 2.236068</code></pre>
<p>However, in some situations, this trick does not work as intended (or at all), so <code>possibly()</code> and
<code>safely()</code> are the way to go.</p>
</div>
<div id="is_-and-as_-functions" class="section level3">
<h3><span class="header-section-number">8.3.4</span> <code>is_*()</code> and <code>as_*()</code> functions</h3>
<p>Remember in Chapter 3, when I introduced <code>is.*()</code> and <code>as.*()</code> functions? I told you then that we
were going to learn about <code>is_*()</code> and <code>as_*()</code> in Chapter 9. This is it!</p>
</div>
<div id="transposing-lists" class="section level3">
<h3><span class="header-section-number">8.3.5</span> «Transposing lists»</h3>
<p>Another interesting function is <code>transpose()</code>. It is not an alternative to the function <code>t()</code> from
<code>base</code> but, has a similar effect. <code>transpose()</code> works on lists. Let’s take a look at the example
from before:</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" title="1">safe_sqrt &lt;-<span class="st"> </span><span class="kw">safely</span>(sqrt, <span class="dt">otherwise =</span> <span class="ot">NA_real_</span>)</a>
<a class="sourceLine" id="cb887-2" title="2"></a>
<a class="sourceLine" id="cb887-3" title="3"><span class="kw">map</span>(a, safe_sqrt)</a></code></pre></div>
<pre><code>## [[1]]
## [[1]]$result
## [1] NA
## 
## [[1]]$error
## &lt;simpleError in sqrt(x = x): non-numeric argument to mathematical function&gt;
## 
## 
## [[2]]
## [[2]]$result
## [1] 2
## 
## [[2]]$error
## NULL
## 
## 
## [[3]]
## [[3]]$result
## [1] 2.236068
## 
## [[3]]$error
## NULL</code></pre>
<p>The output is a list with the first element being a list with a result and an error message. One
might want to have all the results in a single list, and all the error messages in another list.
This is possible with <code>transpose()</code>:</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb889-1" title="1">purrr<span class="op">::</span><span class="kw">transpose</span>(<span class="kw">map</span>(a, safe_sqrt))</a></code></pre></div>
<pre><code>## $result
## $result[[1]]
## [1] NA
## 
## $result[[2]]
## [1] 2
## 
## $result[[3]]
## [1] 2.236068
## 
## 
## $error
## $error[[1]]
## &lt;simpleError in sqrt(x = x): non-numeric argument to mathematical function&gt;
## 
## $error[[2]]
## NULL
## 
## $error[[3]]
## NULL</code></pre>
<p>I explicitely call <code>purrr::transpose()</code> because there is also a <code>data.table::transpose()</code>, which
is not the same function. You have to be careful about that sort of thing, because it can cause
errors in your programs and debuging this type of error is a nightmare.</p>
</div>
</div>
<div id="using-your-functions-inside-mutate" class="section level2">
<h2><span class="header-section-number">8.4</span> Using your functions inside <code>mutate()</code></h2>
<p>Once you wrote a function, you can easily use it inside a pipe workflow:</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" title="1">double_number &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb891-2" title="2">  x<span class="op">+</span>x</a>
<a class="sourceLine" id="cb891-3" title="3">}</a></code></pre></div>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb892-1" title="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb892-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">double_mpg =</span> <span class="kw">double_number</span>(mpg))</a></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb double_mpg
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4       42.0
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4       42.0
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1       45.6
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1       42.8
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2       37.4
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1       36.2
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4       28.6
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2       48.8
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2       45.6
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4       38.4
## 11 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4       35.6
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3       32.8
## 13 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3       34.6
## 14 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3       30.4
## 15 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4       20.8
## 16 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4       20.8
## 17 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4       29.4
## 18 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1       64.8
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2       60.8
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1       67.8
## 21 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1       43.0
## 22 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2       31.0
## 23 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2       30.4
## 24 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4       26.6
## 25 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2       38.4
## 26 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1       54.6
## 27 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2       52.0
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2       60.8
## 29 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4       31.6
## 30 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6       39.4
## 31 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8       30.0
## 32 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2       42.8</code></pre>
<p>Granted this example is stupid, but it shows you, again, that functions you define are nothing
special. You can use them just as any other.</p>
<p>You can also avoid to define a function altogether, especially if you need an operation only once,
by using the <code>.</code> like this:</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb894-1" title="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb894-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">double_mpg =</span> .<span class="op">$</span>mpg <span class="op">+</span><span class="st"> </span>.<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>##     mpg cyl  disp  hp drat    wt  qsec vs am gear carb double_mpg
## 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4       42.0
## 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4       42.0
## 3  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1       45.6
## 4  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1       42.8
## 5  18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2       37.4
## 6  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1       36.2
## 7  14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4       28.6
## 8  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2       48.8
## 9  22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2       45.6
## 10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4       38.4
## 11 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4       35.6
## 12 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3       32.8
## 13 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3       34.6
## 14 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3       30.4
## 15 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4       20.8
## 16 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4       20.8
## 17 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4       29.4
## 18 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1       64.8
## 19 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2       60.8
## 20 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1       67.8
## 21 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1       43.0
## 22 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2       31.0
## 23 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2       30.4
## 24 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4       26.6
## 25 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2       38.4
## 26 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1       54.6
## 27 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2       52.0
## 28 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2       60.8
## 29 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4       31.6
## 30 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6       39.4
## 31 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8       30.0
## 32 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2       42.8</code></pre>
</div>
<div id="working-with-a-list-of-datasets" class="section level2">
<h2><span class="header-section-number">8.5</span> Working with a list of datasets</h2>
<div id="using-map-to-work-on-lists-of-datasets" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Using <code>map()</code> to work on lists of datasets</h3>
<p>This is our first encouter with a typical functional programming function, <code>map()</code>.</p>
<p>Let’s read the list of datasets from the previous chapter:</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb896-1" title="1">paths &lt;-<span class="st"> </span><span class="kw">Sys.glob</span>(<span class="st">&quot;datasets/unemployment/*.csv&quot;</span>)</a>
<a class="sourceLine" id="cb896-2" title="2"></a>
<a class="sourceLine" id="cb896-3" title="3">all_datasets &lt;-<span class="st"> </span><span class="kw">import_list</span>(paths)</a>
<a class="sourceLine" id="cb896-4" title="4"></a>
<a class="sourceLine" id="cb896-5" title="5"><span class="kw">str</span>(all_datasets)</a></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of which: Wage-earners    : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of which: Non-wage-earners: int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ Unemployed                : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ Active population         : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ Year                      : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of which: Wage-earners    : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ Unemployed                : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ Active population         : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ Year                      : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of which: Wage-earners    : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ Active population         : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ Year                      : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ Commune                   : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ Total employed population : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of which: Wage-earners    : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of which: Non-wage-earners: int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ Unemployed                : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ Active population         : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ Unemployment rate (in %)  : num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ Year                      : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>For working with lists, another package from the <code>tidyverse</code> that is very useful, is called
<code>purrr</code>. <code>purrr</code> will be presented in-depth in Chapter 9.</p>
<p>The first thing we are going to do is use a function to clean the names of the datasets. These
names are not very easy to work with; there are spaces, and it would be better if the names of the
columns would be all lowercase. For this we are going to use the function <code>clean_names()</code> from the
<code>janitor</code> package. For a single dataset, I would write this:</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb898-1" title="1"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb898-2" title="2"></a>
<a class="sourceLine" id="cb898-3" title="3">one_dataset =<span class="st"> </span>one_dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb898-4" title="4"><span class="st">  </span><span class="kw">clean_names</span>()</a></code></pre></div>
<p>and I would get a dataset with column names in lowercase and spaces replaced by <code>_</code> (and other
corrections). How can I apply, or map, this function to each dataset in the list? To do this I need
to use <code>purrr::map()</code>:</p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb899-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb899-2" title="2"></a>
<a class="sourceLine" id="cb899-3" title="3">all_datasets &lt;-<span class="st"> </span>all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb899-4" title="4"><span class="st">  </span><span class="kw">map</span>(clean_names)</a>
<a class="sourceLine" id="cb899-5" title="5"></a>
<a class="sourceLine" id="cb899-6" title="6">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb899-7" title="7"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## List of 4
##  $ unemp_2013:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 223407 17802 1703 844 1431 4094 2146 971 1218 3002 ...
##   ..$ of_which_wage_earners       : int [1:118] 203535 15993 1535 750 1315 3800 1874 858 1029 2664 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 19872 1809 168 94 116 294 272 113 189 338 ...
##   ..$ unemployed                  : int [1:118] 19287 1071 114 25 74 261 98 45 66 207 ...
##   ..$ active_population           : int [1:118] 242694 18873 1817 869 1505 4355 2244 1016 1284 3209 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.95 5.67 6.27 2.88 4.92 ...
##   ..$ year                        : int [1:118] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ unemp_2014:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 228423 18166 1767 845 1505 4129 2172 1007 1268 3124 ...
##   ..$ of_which_wage_earners       : int [1:118] 208238 16366 1606 757 1390 3840 1897 887 1082 2782 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20185 1800 161 88 115 289 275 120 186 342 ...
##   ..$ unemployed                  : int [1:118] 19362 1066 122 19 66 287 91 38 61 202 ...
##   ..$ active_population           : int [1:118] 247785 19232 1889 864 1571 4416 2263 1045 1329 3326 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.81 5.54 6.46 2.2 4.2 ...
##   ..$ year                        : int [1:118] 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...
##  $ unemp_2015:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 233130 18310 1780 870 1470 4130 2170 1050 1300 3140 ...
##   ..$ of_which_wage_earners       : int [1:118] 212530 16430 1620 780 1350 3820 1910 920 1100 2770 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20600 1880 160 90 120 310 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18806 988 106 29 73 260 80 41 72 169 ...
##   ..$ active_population           : int [1:118] 251936 19298 1886 899 1543 4390 2250 1091 1372 3309 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.46 5.12 5.62 3.23 4.73 ...
##   ..$ year                        : int [1:118] 2015 2015 2015 2015 2015 2015 2015 2015 2015 2015 ...
##  $ unemp_2016:&#39;data.frame&#39;:  118 obs. of  8 variables:
##   ..$ commune                     : chr [1:118] &quot;Grand-Duche de Luxembourg&quot; &quot;Canton Capellen&quot; &quot;Dippach&quot; &quot;Garnich&quot; ...
##   ..$ total_employed_population   : int [1:118] 236100 18380 1790 870 1470 4160 2160 1030 1330 3150 ...
##   ..$ of_which_wage_earners       : int [1:118] 215430 16500 1640 780 1350 3840 1900 900 1130 2780 ...
##   ..$ of_which_non_wage_earners   : int [1:118] 20670 1880 150 90 120 320 260 130 200 370 ...
##   ..$ unemployed                  : int [1:118] 18185 975 91 27 66 246 76 35 70 206 ...
##   ..$ active_population           : int [1:118] 254285 19355 1881 897 1536 4406 2236 1065 1400 3356 ...
##   ..$ unemployment_rate_in_percent: num [1:118] 7.15 5.04 4.84 3.01 4.3 ...
##   ..$ year                        : int [1:118] 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...</code></pre>
<p>So now, what if I want to know, for each dataset, which <em>communes</em> have an unemployment rate that is
less than, say, 3%? For a single dataset I would do something like this:</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb901-1" title="1">one_dataset <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb901-2" title="2"><span class="st">  </span><span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
<p>But for a list of datasets, <code>map()</code> is needed (and as you will see, that is not all that is needed):</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb902-1" title="1">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">filter</span>(., unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</a></code></pre></div>
<pre><code>## $unemp_2013
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       844                   750
## 2 Leudelange                      1064                   937
## 3       Bech                       526                   463
##   of_which_non_wage_earners unemployed active_population
## 1                        94         25               869
## 2                       127         32              1096
## 3                        63         16               542
##   unemployment_rate_in_percent year
## 1                     2.876870 2013
## 2                     2.919708 2013
## 3                     2.952030 2013
## 
## $unemp_2014
##      commune total_employed_population of_which_wage_earners
## 1    Garnich                       845                   757
## 2 Leudelange                      1102                   965
## 3       Bech                       543                   476
## 4 Flaxweiler                       879                   789
##   of_which_non_wage_earners unemployed active_population
## 1                        88         19               864
## 2                       137         34              1136
## 3                        67         15               558
## 4                        90         27               906
##   unemployment_rate_in_percent year
## 1                     2.199074 2014
## 2                     2.992958 2014
## 3                     2.688172 2014
## 4                     2.980132 2014
## 
## $unemp_2015
##   commune total_employed_population of_which_wage_earners
## 1    Bech                       520                   450
## 2    Bous                       750                   680
##   of_which_non_wage_earners unemployed active_population
## 1                        70         14               534
## 2                        70         22               772
##   unemployment_rate_in_percent year
## 1                     2.621723 2015
## 2                     2.849741 2015
## 
## $unemp_2016
##             commune total_employed_population of_which_wage_earners
## 1 Reckange-sur-Mess                       980                   850
## 2              Bech                       520                   450
## 3          Betzdorf                      1500                  1350
## 4        Flaxweiler                       910                   820
##   of_which_non_wage_earners unemployed active_population
## 1                       130         30              1010
## 2                        70         11               531
## 3                       150         45              1545
## 4                        90         24               934
##   unemployment_rate_in_percent year
## 1                     2.970297 2016
## 2                     2.071563 2016
## 3                     2.912621 2016
## 4                     2.569593 2016</code></pre>
<p>I know what you’re thinking… <em>what the hell?</em>. Let me explain: <code>map()</code> needs a function to map to
each element of the list. <code>all_datasets</code> is the list to which I want to map the function. But what
function? <code>filter()</code> is the function I need, so why doesn’t:</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" title="1">all_datasets <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb904-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="kw">filter</span>(unemployment_rate_in_percent <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>))</a></code></pre></div>
<p>work? This is a bit complicated, and has to do with what is called environments. If you try to run
the code above, you will get this error message:</p>
<pre><code>Error in filter(unemployment_rate_in_percent &lt; 3) :
  object &#39;unemployment_rate_in_percent&#39; not found</code></pre>
<p>I won’t go into details, but by writing <code>~filter(., unemployment_rate_in_percent &lt; 3)</code>, which is a
formula (<code>~</code> is the symbol to define formulas, more on this in the later chapters), <code>map()</code>
converts it to a function that it can use. If you want to know more about this, you can read it in
<a href="http://adv-r.had.co.nz/Functional-programming.html#closures">Advanced R</a> by Hadley Wickham, but it
is an advanced topic.</p>
</div>
</div>
<div id="mapping-your-homebrewed-functions-to-lists-of-datasets" class="section level2">
<h2><span class="header-section-number">8.6</span> Mapping your homebrewed functions to lists of datasets</h2>
<p>Before merging these datasets together, we would need them to have a <code>year</code> column indicating the
year. It would also be helpful if gave names to these datasets. For this task, we can use
<code>purrr::set_names()</code>:</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" title="1">all_datasets =<span class="st"> </span><span class="kw">set_names</span>(all_datasets, <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">2013</span>, <span class="dv">2016</span>)))</a></code></pre></div>
<p>Let’s take a look at the list now:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb907-1" title="1"><span class="kw">str</span>(all_datasets)</a></code></pre></div>
<p>As you can see, each <code>data.frame</code> object contained in the list has been renamed. You can thus
access them with the <code>$</code> operator:</p>
<p><img src="pics/all_datasets_names.png" width="135" /></p>
<div id="data-frames-and-reduce" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Data frames and <code>reduce</code></h3>
<p>Using <code>map()</code> we now know how to apply a function to each dataset of a list. But maybe it would be
easier to merge all the datasets first, and then manipulate them? Before that though, I am going to
teach you how to use <code>purrr::reduce()</code>, another very powerful function that works on lists. This is
a function that you can find in other programming languages, but sometimes it is called fold.</p>
<p>I think that the following example illustrates the power of <code>reduce()</code> well:</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb908-1" title="1">numbers =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="co"># Create a vector with the numbers 1 to 5</span></a>
<a class="sourceLine" id="cb908-2" title="2"></a>
<a class="sourceLine" id="cb908-3" title="3"><span class="kw">reduce</span>(numbers, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p><code>reduce()</code> takes a function as an argument, here the function <code>+</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> and then does the following
computation:</p>
<pre><code>0 + numbers[1] + numbers[2] + numbers[3]...</code></pre>
<p>It applies the user supplied function successively but has to start with something, so we give it
the argument <code>init</code> also. This argument is actually optional, but I show it here because in some
cases it might be useful to start the computations at another value than <code>0</code>.<code>reduce()</code>
generalizes functions that only take two arguments. If you were to write a function that returns
the minimum between two numbers:</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb911-1" title="1">my_min =<span class="st"> </span><span class="cf">function</span>(a, b){</a>
<a class="sourceLine" id="cb911-2" title="2">    <span class="cf">if</span>(a <span class="op">&lt;</span><span class="st"> </span>b){</a>
<a class="sourceLine" id="cb911-3" title="3">        <span class="kw">return</span>(a)</a>
<a class="sourceLine" id="cb911-4" title="4">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb911-5" title="5">        <span class="kw">return</span>(b)</a>
<a class="sourceLine" id="cb911-6" title="6">    }</a>
<a class="sourceLine" id="cb911-7" title="7">}</a></code></pre></div>
<p>You could use <code>reduce()</code> to get the minimum of a list of numbers:</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" title="1">numbers2 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">-8</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb912-2" title="2"></a>
<a class="sourceLine" id="cb912-3" title="3"><span class="kw">reduce</span>(numbers2, my_min)</a></code></pre></div>
<pre><code>## [1] -8</code></pre>
<p>As long as you provide a function and a list of elements to <code>reduce()</code>, you will get a single
output. So how could <code>reduce()</code> help us with merging all the datasets that are in the list? <code>dplyr</code>
comes with a lot of function to merge <em>two</em> datasets. Remember that I said before that <code>reduce()</code>
allows you to generalize a function of two arguments? Let’s try it with our list of datasets:</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" title="1">unemp_lux =<span class="st"> </span><span class="kw">reduce</span>(all_datasets, full_join)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)
## Joining, by = c(&quot;commune&quot;, &quot;total_employed_population&quot;, &quot;of_which_wage_earners&quot;, &quot;of_which_non_wage_earners&quot;, &quot;unemployed&quot;, &quot;active_population&quot;, &quot;unemployment_rate_in_percent&quot;, &quot;year&quot;)</code></pre>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" title="1"><span class="kw">glimpse</span>(unemp_lux)</a></code></pre></div>
<pre><code>## Observations: 472
## Variables: 8
## $ commune                      &lt;chr&gt; &quot;Grand-Duche de Luxembourg&quot;, &quot;Can...
## $ total_employed_population    &lt;int&gt; 223407, 17802, 1703, 844, 1431, 4...
## $ of_which_wage_earners        &lt;int&gt; 203535, 15993, 1535, 750, 1315, 3...
## $ of_which_non_wage_earners    &lt;int&gt; 19872, 1809, 168, 94, 116, 294, 2...
## $ unemployed                   &lt;int&gt; 19287, 1071, 114, 25, 74, 261, 98...
## $ active_population            &lt;int&gt; 242694, 18873, 1817, 869, 1505, 4...
## $ unemployment_rate_in_percent &lt;dbl&gt; 7.947044, 5.674773, 6.274078, 2.8...
## $ year                         &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 201...</code></pre>
<p><code>full_join()</code> is one of the <code>dplyr</code> function that merges data. There are others that might be
useful depending on the kind of join operation you need. Let’s write this data to disk as we’re
going to keep using it for the next chapters:</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" title="1"><span class="kw">export</span>(unemp_lux, <span class="st">&quot;datasets/unemp_lux.csv&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="functional-programming-and-plotting" class="section level2">
<h2><span class="header-section-number">8.7</span> Functional programming and plotting</h2>
<p>In this section, we are going to learn how to use the possibilities offered by the <code>purrr</code> package
and how it can work together with <code>ggplot2</code> to generate many plots. This is a more advanced topic,
but what comes next is also what makes R, and the functional programming paradigm so powerful.</p>
<p>For example, suppose that instead of wanting a single plot with the unemployment rate of each
commune, you need one unemployment plot, per commune:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb919-1" title="1">unemp_lux_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb919-2" title="2"><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Luxembourg&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb919-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-4" title="4"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb919-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Luxembourg&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb919-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-580-1.png" width="672" /></p>
<p>and then you would write the same for “Esch-sur-Alzette” and also for “Wiltz”. If you only have to
make to make these 3 plots, copy and pasting the above lines is no big deal:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" title="1">unemp_lux_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb920-2" title="2"><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Esch-sur-Alzette&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb920-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></a>
<a class="sourceLine" id="cb920-4" title="4"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb920-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb920-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-581-1.png" width="672" /></p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb921-1" title="1">unemp_lux_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb921-2" title="2"><span class="st">  </span><span class="kw">filter</span>(division <span class="op">==</span><span class="st"> &quot;Wiltz&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb921-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> division)) <span class="op">+</span></a>
<a class="sourceLine" id="cb921-4" title="4"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb921-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Unemployment in Esch-sur-Alzette&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Rate&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb921-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="modern_R_files/figure-html/unnamed-chunk-581-2.png" width="672" /></p>
<p>Put copy and pasting is error prone. Can you spot the copy-paste mistake I made? And what if you
have to create the above plots for all 108 Luxembourguish communes? That’s a lot of copy pasting.
What if, once you are done copy pasting, you have to change something, for example, the theme? You
could use the search and replace function of RStudio, true, but sometimes search and replace can
also introduce bugs and typos. You can avoid all these issues by using <code>purrr::map()</code>. What do you
need to map over? The commune names. So let’s create a vector of commune names:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" title="1">communes &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Esch-sur-Alzette&quot;</span>, <span class="st">&quot;Wiltz&quot;</span>)</a></code></pre></div>
<p>Now we can create the graphs using <code>map()</code>, or <code>map2()</code> to be exact:</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb923-1" title="1">plots_tibble =<span class="st"> </span>unemp_lux_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-2" title="2"><span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-4" title="4"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">plot =</span> <span class="kw">map2</span>(<span class="dt">.x =</span> data, <span class="dt">.y =</span> division, <span class="op">~</span><span class="kw">ggplot</span>(<span class="dt">data =</span> .x) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-6" title="6"><span class="st">       </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb923-7" title="7"><span class="st">       </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(year, unemployment_rate_in_percent, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb923-8" title="8"><span class="st">       </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste</span>(<span class="st">&quot;Unemployment in&quot;</span>, .y))))</a></code></pre></div>
<p>Let’s study this line by line: the first line is easy, we simply use <code>filter()</code> to keep only the
communes we are interested in. Then we group by <code>division</code> and use <code>tidyr::nest()</code>. As a refresher,
let’s take a look at what this does:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" title="1">unemp_lux_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb924-2" title="2"><span class="st">  </span><span class="kw">filter</span>(division <span class="op">%in%</span><span class="st"> </span>communes) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb924-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(division) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb924-4" title="4"><span class="st">  </span><span class="kw">nest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   division         data             
##   &lt;chr&gt;            &lt;list&gt;           
## 1 Esch-sur-Alzette &lt;tibble [15 × 7]&gt;
## 2 Luxembourg       &lt;tibble [15 × 7]&gt;
## 3 Wiltz            &lt;tibble [15 × 7]&gt;</code></pre>
<p>This creates a tibble with two columns, <code>division</code> and <code>data</code>, where each individual (or
commune in this case) is another tibble with all the original variables. This is very useful,
because now we can pass these tibbles to <code>map2()</code>, to generate the plots. But why <code>map2()</code> and
what’s the difference with <code>map()</code>? <code>map2()</code> works the same way as <code>map()</code>, but maps over two
inputs:</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" title="1">numbers1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb926-2" title="2"></a>
<a class="sourceLine" id="cb926-3" title="3">numbers2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb926-4" title="4"></a>
<a class="sourceLine" id="cb926-5" title="5"><span class="kw">map2</span>(numbers1, numbers2, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 9
## 
## [[2]]
## [1] 16
## 
## [[3]]
## [1] 21
## 
## [[4]]
## [1] 24
## 
## [[5]]
## [1] 25</code></pre>
<p>In our example with the graphs, the two inputs are the data, and the names of the communes. This is
useful to create the title with <code>labs(title = paste("Unemployment in", .y))))</code> where <code>.y</code> is the
second input of <code>map2()</code>, the commune names contained in variable <code>division</code>.</p>
<p>So what happened? We now have a tibble called <code>plots_tibble</code> that looks like this:</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" title="1"><span class="kw">print</span>(plots_tibble)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   division         data              plot    
##   &lt;chr&gt;            &lt;list&gt;            &lt;list&gt;  
## 1 Esch-sur-Alzette &lt;tibble [15 × 7]&gt; &lt;S3: gg&gt;
## 2 Luxembourg       &lt;tibble [15 × 7]&gt; &lt;S3: gg&gt;
## 3 Wiltz            &lt;tibble [15 × 7]&gt; &lt;S3: gg&gt;</code></pre>
<p>This tibble contains three columns, <code>division</code>, <code>data</code> and now a new one called <code>plot</code>, that we
created before using the last line <code>mutate(plot = ...)</code> (remember that <code>mutate()</code> adds columns to
tibbles). <code>plot</code> is a list-column, with elements… being plots! Yes you read that right, the
elements of the column <code>plot</code> are literally plots. This is what I meant with list columns.
Let’s see what is inside the <code>data</code> and the <code>plot</code> columns exactly:</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb930-1" title="1">plots_tibble <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb930-2" title="2"><span class="st">  </span><span class="kw">pull</span>(data)</a></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 15 x 7
##     year active_populati… of_which_non_wa… of_which_wage_e…
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             11.3              665             10.1
##  2  2002             11.7              677             10.3
##  3  2003             11.7              674             10.2
##  4  2004             12.2              659             10.6
##  5  2005             11.9              654             10.3
##  6  2006             12.2              657             10.5
##  7  2007             12.6              634             10.9
##  8  2008             12.9              638             11.0
##  9  2009             13.2              652             11.0
## 10  2010             13.6              638             11.2
## 11  2011             13.9              630             11.5
## 12  2012             14.3              684             11.8
## 13  2013             14.8              694             12.0
## 14  2014             15.2              703             12.5
## 15  2015             15.3              710             12.6
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[2]]
## # A tibble: 15 x 7
##     year active_populati… of_which_non_wa… of_which_wage_e…
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             34.4             2.89             30.4
##  2  2002             34.8             2.94             30.3
##  3  2003             35.2             3.03             30.1
##  4  2004             35.6             3.06             30.1
##  5  2005             35.6             3.13             29.8
##  6  2006             35.5             3.12             30.3
##  7  2007             36.1             3.25             31.1
##  8  2008             37.5             3.39             31.9
##  9  2009             37.9             3.49             31.6
## 10  2010             38.6             3.54             32.1
## 11  2011             40.3             3.66             33.6
## 12  2012             41.8             3.81             34.6
## 13  2013             43.4             3.98             35.5
## 14  2014             44.6             4.11             36.7
## 15  2015             45.2             4.14             37.5
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;
## 
## [[3]]
## # A tibble: 15 x 7
##     year active_populati… of_which_non_wa… of_which_wage_e…
##    &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1  2001             2.13              223             1.79
##  2  2002             2.14              220             1.78
##  3  2003             2.18              223             1.79
##  4  2004             2.24              227             1.85
##  5  2005             2.26              229             1.85
##  6  2006             2.20              206             1.82
##  7  2007             2.27              198             1.88
##  8  2008             2.30              200             1.90
##  9  2009             2.36              201             1.94
## 10  2010             2.42              195             1.97
## 11  2011             2.48              190             2.02
## 12  2012             2.59              188             2.10
## 13  2013             2.66              195             2.15
## 14  2014             2.69              185             2.19
## 15  2015             2.77              180             2.27
## # ... with 3 more variables: total_employed_population &lt;dbl&gt;,
## #   unemployed &lt;dbl&gt;, unemployment_rate_in_percent &lt;dbl&gt;</code></pre>
<p>each element of data is a tibble for the specific country with columns <code>year</code>, <code>active_population</code>,
etc, the original columns. But obviously, there is no <code>division</code> column. So to plot the data, and
join all the dots together, we need to add <code>group = 1</code> in the call to <code>ggplot2()</code> (whereas if you
plot multiple lines in the same graph, you need to write <code>group = division</code>).</p>
<p>But more interestingly, how can you actually see the plots? If you want to simply look at them, it
is enough to use <code>pull()</code>:</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb932-1" title="1">plots_tibble <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb932-2" title="2"><span class="st">  </span><span class="kw">pull</span>(plot)</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-588-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-588-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="modern_R_files/figure-html/unnamed-chunk-588-3.png" width="672" /></p>
<p>And if we want to save these plots, we can do so using <code>map2()</code>:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" title="1"><span class="kw">map2</span>(<span class="kw">paste0</span>(plots_tibble<span class="op">$</span>division, <span class="st">&quot;.pdf&quot;</span>), plots_tibble<span class="op">$</span>plot, ggsave)</a></code></pre></div>
<pre><code>Saving 7 x 5 in image
Saving 6.01 x 3.94 in image
Saving 6.01 x 3.94 in image</code></pre>
<p>This was probably the most advanced topic we have studied yet; but you probably agree with me that
it is among the most useful ones. This section is a perfect illustration of the power of functional
programming; you can mix and match functions as long as you give them the correct arguments.
You can pass data to functions that use data and then pass these functions to other functions that
use functions as arguments, such as <code>map()</code>.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <code>map()</code> does not care if the functions you pass to it produces tables,
graphs or even another function. <code>map()</code> will simply map this function to a list of inputs, and as
long as these inputs are correct arguments to the function, <code>map()</code> will do its magic. If you
combine this with list-columns, you can even use <code>map()</code> alongside <code>dplyr</code> functions and map your
function by first grouping, filtering, etc…</p>
</div>
<div id="exercises-6" class="section level2">
<h2><span class="header-section-number">8.8</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>Suppose you have an Excel workbook that contains data on three sheets. Create a function that
reads entire workbooks, and that returns a list of tibbles, where each tibble is the data of one
sheet (download the example Excel workbook, <code>example_workbook.xlsx</code>, from the <code>assets</code> folder on
the books github).</p></li>
<li><p>Use one of the <code>map()</code> functions to combine two lists into one. Consider the following two lists:</p></li>
</ol>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" title="1">mediterranean &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;starters&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;humous&quot;</span>, <span class="st">&quot;lasagna&quot;</span>), <span class="st">&quot;dishes&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;sardines&quot;</span>, <span class="st">&quot;olives&quot;</span>))</a>
<a class="sourceLine" id="cb938-2" title="2"></a>
<a class="sourceLine" id="cb938-3" title="3">continental &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;starters&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;pea soup&quot;</span>, <span class="st">&quot;terrine&quot;</span>), <span class="st">&quot;dishes&quot;</span> =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;frikadelle&quot;</span>, <span class="st">&quot;sauerkraut&quot;</span>))</a></code></pre></div>
<p>The result we’d like to have would look like this:
<!-- map2(mediterranean, continental, append) --></p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb939-1" title="1"><span class="op">$</span>starters</a>
<a class="sourceLine" id="cb939-2" title="2"><span class="op">$</span>starters[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb939-3" title="3">[<span class="dv">1</span>] <span class="st">&quot;humous&quot;</span></a>
<a class="sourceLine" id="cb939-4" title="4"></a>
<a class="sourceLine" id="cb939-5" title="5"><span class="op">$</span>starters[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb939-6" title="6">[<span class="dv">1</span>] <span class="st">&quot;olives&quot;</span></a>
<a class="sourceLine" id="cb939-7" title="7"></a>
<a class="sourceLine" id="cb939-8" title="8"><span class="op">$</span>starters[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb939-9" title="9">[<span class="dv">1</span>] <span class="st">&quot;pea soup&quot;</span></a>
<a class="sourceLine" id="cb939-10" title="10"></a>
<a class="sourceLine" id="cb939-11" title="11"><span class="op">$</span>starters[[<span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb939-12" title="12">[<span class="dv">1</span>] <span class="st">&quot;terrine&quot;</span></a>
<a class="sourceLine" id="cb939-13" title="13"></a>
<a class="sourceLine" id="cb939-14" title="14"></a>
<a class="sourceLine" id="cb939-15" title="15"><span class="op">$</span>dishes</a>
<a class="sourceLine" id="cb939-16" title="16"><span class="op">$</span>dishes[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb939-17" title="17">[<span class="dv">1</span>] <span class="st">&quot;sardines&quot;</span></a>
<a class="sourceLine" id="cb939-18" title="18"></a>
<a class="sourceLine" id="cb939-19" title="19"><span class="op">$</span>dishes[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb939-20" title="20">[<span class="dv">1</span>] <span class="st">&quot;lasagna&quot;</span></a>
<a class="sourceLine" id="cb939-21" title="21"></a>
<a class="sourceLine" id="cb939-22" title="22"><span class="op">$</span>dishes[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb939-23" title="23">[<span class="dv">1</span>] <span class="st">&quot;frikadelle&quot;</span></a>
<a class="sourceLine" id="cb939-24" title="24"></a>
<a class="sourceLine" id="cb939-25" title="25"><span class="op">$</span>dishes[[<span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb939-26" title="26">[<span class="dv">1</span>] <span class="st">&quot;sauerkraut&quot;</span></a></code></pre></div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="7">
<li id="fn7"><p>This is simply the <code>+</code> operator
you’re used to. Try this out: <code>`+`(1, 5)</code> and you’ll see <code>+</code> is a function like any other. You
just have to write backticks around the plus symbol to make it work.<a href="functional-programming.html#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>Functions that have other functions as input are
called <em>higher order functions</em><a href="functional-programming.html#fnref8" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="defining-your-own-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="package-development.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
